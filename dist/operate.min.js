/**
 * Operate / Agent - v0.1.0-alpha.1
 * Operate JavaScript agent used to load and run Bitcoin programs.
 * github.com:operate-bsv/op_agent-js
 * Copyright Â© 2020 Chronos Labs Ltd. MIT License
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Operate=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n,a,r,u,l){try{var s=t[u](l),o=s.value}catch(t){return void n(t)}s.done?e(o):Promise.resolve(o).then(a,r)}function n(t){return function(){var n=this,a=arguments;return new Promise((function(r,u){var l=t.apply(n,a);function s(t){e(l,r,u,s,o,"next",t)}function o(t){e(l,r,u,s,o,"throw",t)}s(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function u(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],a=!0,r=!1,u=void 0;try{for(var l,s=t[Symbol.iterator]();!(a=(l=s.next()).done)&&(n.push(l.value),!e||n.length!==e);a=!0);}catch(t){r=!0,u=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw u}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d=function(){function t(){a(this,t)}return u(t,null,[{key:"fetchTx",value:function(t){throw"".concat(this.constructor.name,"#fetchTx() not implemented")}},{key:"fetchTxBy",value:function(t){throw"".concat(this.constructor.name,"#fetchTxBy() not implemented")}},{key:"fetchOps",value:function(t){throw"".concat(this.constructor.name,"#fetchOps() not implemented")}}]),t}();function L(t,e){return t(e={exports:{}},e.exports),e.exports}var g=L((function(t){const{LUA_VERSION_MAJOR:e,LUA_VERSION_MINOR:n,to_luastring:a}=V;t.exports.LUA_PATH_SEP=";";t.exports.LUA_PATH_MARK="?";t.exports.LUA_EXEC_DIR="!";const r=e+"."+n;t.exports.LUA_VDIR=r;{const e="/";t.exports.LUA_DIRSEP=e;const n="./lua/"+r+"/";t.exports.LUA_LDIR=n;const u=n;t.exports.LUA_JSDIR=u;const l=a(n+"?.lua;"+n+"?/init.lua;./?.lua;./?/init.lua");t.exports.LUA_PATH_DEFAULT=l;const s=a(u+"?.js;"+u+"loadall.js;./?.js");t.exports.LUA_JSPATH_DEFAULT=s}const u=function(t,e){for(var n=Math.min(3,Math.ceil(Math.abs(e)/1023)),a=t,r=0;r<n;r++)a*=Math.pow(2,Math.floor((e+r)/n));return a};t.exports.LUAI_MAXSTACK=1e6,t.exports.LUA_COMPAT_FLOATSTRING=!1,t.exports.LUA_IDSIZE=59,t.exports.LUA_INTEGER_FMT="%d",t.exports.LUA_INTEGER_FRMLEN="",t.exports.LUA_MAXINTEGER=2147483647,t.exports.LUA_MININTEGER=-2147483648,t.exports.LUA_NUMBER_FMT="%.14g",t.exports.LUA_NUMBER_FRMLEN="",t.exports.LUAL_BUFFERSIZE=8192,t.exports.frexp=function(t){if(0===t)return[t,0];var e=new DataView(new ArrayBuffer(8));e.setFloat64(0,t);var n=e.getUint32(0)>>>20&2047;0===n&&(e.setFloat64(0,t*Math.pow(2,64)),n=(e.getUint32(0)>>>20&2047)-64);var a=n-1022;return[u(t,-a),a]},t.exports.ldexp=u,t.exports.lua_getlocaledecpoint=function(){return 46},t.exports.lua_integer2str=function(t){return String(t)},t.exports.lua_number2str=function(t){return String(Number(t.toPrecision(14)))},t.exports.lua_numbertointeger=function(t){return t>=-2147483648&&t<2147483648&&t},t.exports.luai_apicheck=function(t,e){if(!e)throw Error(e)}}));g.LUA_PATH_SEP,g.LUA_PATH_MARK,g.LUA_EXEC_DIR,g.LUA_VDIR,g.LUA_DIRSEP,g.LUA_LDIR,g.LUA_JSDIR,g.LUA_PATH_DEFAULT,g.LUA_JSPATH_DEFAULT,g.LUAI_MAXSTACK,g.LUA_COMPAT_FLOATSTRING,g.LUA_IDSIZE,g.LUA_INTEGER_FMT,g.LUA_INTEGER_FRMLEN,g.LUA_MAXINTEGER,g.LUA_MININTEGER,g.LUA_NUMBER_FMT,g.LUA_NUMBER_FRMLEN,g.LUAL_BUFFERSIZE,g.frexp,g.ldexp,g.lua_getlocaledecpoint,g.lua_integer2str,g.lua_number2str,g.lua_numbertointeger,g.luai_apicheck;let A,T,v;if(A="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(t){let e=0,n=t.length,a=new Uint8Array(n);for(;n>e;)a[e]=t[e++];return a},"function"==typeof(new Uint8Array).indexOf)T=function(t,e,n){return t.indexOf(e,n)};else{let t=[].indexOf;if(0!==t.call(new Uint8Array(1),0))throw Error("missing .indexOf");T=function(e,n,a){return t.call(e,n,a)}}v="function"==typeof Uint8Array.of?Uint8Array.of.bind(Uint8Array):function(){return A(arguments)};const b=function(t){return t instanceof Uint8Array},O="cannot convert invalid utf8 to javascript string",k=";,/?:@&=+$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789,-_.!~*'()#".split("").reduce((function(t,e){return t[e.charCodeAt(0)]=!0,t}),{}),m={},E=function(t,e){if("string"!=typeof t)throw new TypeError("to_luastring expects a javascript string");if(e){let e=m[t];if(b(e))return e}let n=t.length,a=Array(n),r=0;for(let e=0;e<n;++e){let u=t.charCodeAt(e);if(u<=127)a[r++]=u;else if(u<=2047)a[r++]=192|u>>6,a[r++]=128|63&u;else{if(u>=55296&&u<=56319&&e+1<n){let n=t.charCodeAt(e+1);n>=56320&&n<=57343&&(e++,u=1024*(u-55296)+n+9216)}u<=65535?(a[r++]=224|u>>12,a[r++]=128|u>>6&63,a[r++]=128|63&u):(a[r++]=240|u>>18,a[r++]=128|u>>12&63,a[r++]=128|u>>6&63,a[r++]=128|63&u)}}return a=A(a),e&&(m[t]=a),a};var U=A,R=T,N=v,y=b,w=function(t,e){if(t!==e){let n=t.length;if(n!==e.length)return!1;for(let a=0;a<n;a++)if(t[a]!==e[a])return!1}return!0},S=function(t,e,n,a){if(!b(t))throw new TypeError("to_jsstring expects a Uint8Array");n=void 0===n?t.length:Math.min(t.length,n);let r="";for(let u=void 0!==e?e:0;u<n;){let e=t[u++];if(e<128)r+=String.fromCharCode(e);else if(e<194||e>244){if(!a)throw RangeError(O);r+="ï¿½"}else if(e<=223){if(u>=n){if(!a)throw RangeError(O);r+="ï¿½";continue}let l=t[u++];if(128!=(192&l)){if(!a)throw RangeError(O);r+="ï¿½";continue}r+=String.fromCharCode(((31&e)<<6)+(63&l))}else if(e<=239){if(u+1>=n){if(!a)throw RangeError(O);r+="ï¿½";continue}let l=t[u++];if(128!=(192&l)){if(!a)throw RangeError(O);r+="ï¿½";continue}let s=t[u++];if(128!=(192&s)){if(!a)throw RangeError(O);r+="ï¿½";continue}let o=((15&e)<<12)+((63&l)<<6)+(63&s);if(o<=65535)r+=String.fromCharCode(o);else{o-=65536;let t=55296+(o>>10),e=o%1024+56320;r+=String.fromCharCode(t,e)}}else{if(u+2>=n){if(!a)throw RangeError(O);r+="ï¿½";continue}let l=t[u++];if(128!=(192&l)){if(!a)throw RangeError(O);r+="ï¿½";continue}let s=t[u++];if(128!=(192&s)){if(!a)throw RangeError(O);r+="ï¿½";continue}let o=t[u++];if(128!=(192&o)){if(!a)throw RangeError(O);r+="ï¿½";continue}let i=((7&e)<<18)+((63&l)<<12)+((63&s)<<6)+(63&o);i-=65536;let c=55296+(i>>10),f=i%1024+56320;r+=String.fromCharCode(c,f)}}return r},I=function(t){if(!b(t))throw new TypeError("to_uristring expects a Uint8Array");let e="";for(let n=0;n<t.length;n++){let a=t[n];k[a]?e+=String.fromCharCode(a):e+="%"+(a<16?"0":"")+a.toString(16)}return e},M=E,P=function(t){if(!b(t)){if("string"!=typeof t)throw new TypeError("expects an array of bytes or javascript string");t=E(t)}return t};var x=E("Lua");const C={LUA_TNONE:-1,LUA_TNIL:0,LUA_TBOOLEAN:1,LUA_TLIGHTUSERDATA:2,LUA_TNUMBER:3,LUA_TSTRING:4,LUA_TTABLE:5,LUA_TFUNCTION:6,LUA_TUSERDATA:7,LUA_TTHREAD:8,LUA_NUMTAGS:9};C.LUA_TSHRSTR=0|C.LUA_TSTRING,C.LUA_TLNGSTR=16|C.LUA_TSTRING,C.LUA_TNUMFLT=0|C.LUA_TNUMBER,C.LUA_TNUMINT=16|C.LUA_TNUMBER,C.LUA_TLCL=0|C.LUA_TFUNCTION,C.LUA_TLCF=16|C.LUA_TFUNCTION,C.LUA_TCCL=32|C.LUA_TFUNCTION;const{LUAI_MAXSTACK:D}=g,B=-D-1e3;var V={luastring_from:U,luastring_indexOf:R,luastring_of:N,is_luastring:y,luastring_eq:w,to_jsstring:S,to_uristring:I,to_luastring:M,from_userstring:P,LUA_SIGNATURE:x,LUA_VERSION_MAJOR:"5",LUA_VERSION_MINOR:"3",LUA_VERSION_NUM:503,LUA_VERSION_RELEASE:"4",LUA_VERSION:"Lua 5.3",LUA_RELEASE:"Lua 5.3.4",LUA_COPYRIGHT:"Lua 5.3.4  Copyright (C) 1994-2017 Lua.org, PUC-Rio",LUA_AUTHORS:"R. Ierusalimschy, L. H. de Figueiredo, W. Celes",LUA_HOOKCALL:0,LUA_HOOKCOUNT:3,LUA_HOOKLINE:2,LUA_HOOKRET:1,LUA_HOOKTAILCALL:4,LUA_MASKCALL:1,LUA_MASKCOUNT:8,LUA_MASKLINE:4,LUA_MASKRET:2,LUA_MINSTACK:20,LUA_MULTRET:-1,LUA_OPADD:0,LUA_OPBAND:7,LUA_OPBNOT:13,LUA_OPBOR:8,LUA_OPBXOR:9,LUA_OPDIV:5,LUA_OPEQ:0,LUA_OPIDIV:6,LUA_OPLE:2,LUA_OPLT:1,LUA_OPMOD:3,LUA_OPMUL:2,LUA_OPPOW:4,LUA_OPSHL:10,LUA_OPSHR:11,LUA_OPSUB:1,LUA_OPUNM:12,LUA_REGISTRYINDEX:B,LUA_RIDX_GLOBALS:2,LUA_RIDX_LAST:2,LUA_RIDX_MAINTHREAD:1,constant_types:C,lua_Debug:class{constructor(){this.event=NaN,this.name=null,this.namewhat=null,this.what=null,this.source=null,this.currentline=NaN,this.linedefined=NaN,this.lastlinedefined=NaN,this.nups=NaN,this.nparams=NaN,this.isvararg=NaN,this.istailcall=NaN,this.short_src=null,this.i_ci=null}},lua_upvalueindex:function(t){return B-t},thread_status:{LUA_OK:0,LUA_YIELD:1,LUA_ERRRUN:2,LUA_ERRSYNTAX:3,LUA_ERRMEM:4,LUA_ERRGCMM:5,LUA_ERRERR:6}};var G={FENGARI_AUTHORS:"B. Giannangeli, Daurnimator",FENGARI_COPYRIGHT:"Fengari 0.1.4  Copyright (C) 2017-2018 B. Giannangeli, Daurnimator\nBased on: "+V.LUA_COPYRIGHT,FENGARI_RELEASE:"Fengari 0.1.4",FENGARI_VERSION:"Fengari 0.1",FENGARI_VERSION_MAJOR:"0",FENGARI_VERSION_MINOR:"1",FENGARI_VERSION_NUM:1,FENGARI_VERSION_RELEASE:"4",is_luastring:V.is_luastring,luastring_eq:V.luastring_eq,luastring_from:V.luastring_from,luastring_indexOf:V.luastring_indexOf,luastring_of:V.luastring_of,to_jsstring:V.to_jsstring,to_luastring:V.to_luastring,to_uristring:V.to_uristring,from_userstring:V.from_userstring};const{luai_apicheck:K}=g,F=function(t){if(!t)throw Error("assertion failed")};var j={lua_assert:F,luai_apicheck:K||function(t,e){return F(e)},api_check:function(t,e,n){return K(t,e&&n)},LUAI_MAXCCALLS:200,LUA_MINBUFFER:32,luai_nummod:function(t,e,n){let a=e%n;return a*n<0&&(a+=n),a},MAX_INT:2147483647,MIN_INT:-2147483648};const{luastring_of:H}=V,X=H(0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,22,22,22,22,22,22,22,22,22,22,4,4,4,4,4,4,4,21,21,21,21,21,21,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,4,21,21,21,21,21,21,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var z={lisdigit:function(t){return 0!=(2&X[t+1])},lislalnum:function(t){return 0!=(3&X[t+1])},lislalpha:function(t){return 0!=(1&X[t+1])},lisprint:function(t){return 0!=(4&X[t+1])},lisspace:function(t){return 0!=(8&X[t+1])},lisxdigit:function(t){return 0!=(16&X[t+1])}};const{is_luastring:J,luastring_eq:q,luastring_from:Y,to_luastring:W}=V,{lua_assert:Z}=j;class Q{constructor(t,e){this.hash=null,this.realstring=e}getstr(){return this.realstring}tsslen(){return this.realstring.length}}const $=function(t){Z(J(t));let e=t.length,n="|";for(let a=0;a<e;a++)n+=t[a].toString(16);return n},tt=function(t,e){return Z(e instanceof Uint8Array),new Q(t,e)};var et={luaS_eqlngstr:function(t,e){return Z(t instanceof Q),Z(e instanceof Q),t==e||q(t.realstring,e.realstring)},luaS_hash:$,luaS_hashlongstr:function(t){return Z(t instanceof Q),null===t.hash&&(t.hash=$(t.getstr())),t.hash},luaS_bless:tt,luaS_new:function(t,e){return tt(t,Y(e))},luaS_newliteral:function(t,e){return tt(t,W(e))},TString:Q};const{constant_types:{LUA_TBOOLEAN:nt,LUA_TCCL:at,LUA_TLCF:rt,LUA_TLCL:ut,LUA_TLIGHTUSERDATA:lt,LUA_TLNGSTR:st,LUA_TNIL:ot,LUA_TNUMFLT:it,LUA_TNUMINT:ct,LUA_TSHRSTR:ft,LUA_TTABLE:_t,LUA_TTHREAD:pt,LUA_TUSERDATA:ht},to_luastring:dt}=V,{lua_assert:Lt}=j,{luaS_hashlongstr:gt,TString:At}=et;let Tt=new WeakMap;const vt=function(t){let e=Tt.get(t);return e||(e={},Tt.set(t,e)),e},bt=function(t,e){switch(e.type){case ot:return p_.luaG_runerror(t,dt("table index is nil",!0));case it:if(isNaN(e.value))return p_.luaG_runerror(t,dt("table index is NaN",!0));case ct:case nt:case _t:case ut:case rt:case at:case ht:case pt:return e.value;case ft:case st:return gt(e.tsvalue());case lt:{let n=e.value;switch(typeof n){case"string":return"*"+n;case"number":return"#"+n;case"boolean":return n?"?true":"?false";case"function":return vt(n);case"object":if(n instanceof ca.lua_State&&n.l_G===t.l_G||n instanceof Ot||n instanceof Sr.Udata||n instanceof Sr.LClosure||n instanceof Sr.CClosure)return vt(n);default:return n}}default:throw new Error("unknown key type: "+e.type)}};class Ot{constructor(t){this.id=t.l_G.id_counter++,this.strong=new Map,this.dead_strong=new Map,this.dead_weak=void 0,this.f=void 0,this.l=void 0,this.metatable=null,this.flags=-1}}const kt=function(t,e,n,a){t.dead_strong.clear(),t.dead_weak=void 0;let r=null,u={key:n,value:a,p:r=t.l,n:void 0};t.f||(t.f=u),r&&(r.n=u),t.strong.set(e,u),t.l=u},mt=function(t,e){let n=t.strong.get(e);if(n){n.key.setdeadvalue(),n.value=void 0;let r=n.n,u=n.p;n.p=void 0,u&&(u.n=r),r&&(r.p=u),t.f===n&&(t.f=r),t.l===n&&(t.l=u),t.strong.delete(e),("object"==typeof(a=e)?null!==a:"function"==typeof a)?(t.dead_weak||(t.dead_weak=new WeakMap),t.dead_weak.set(e,n)):t.dead_strong.set(e,n)}var a},Et=function(t,e){let n=t.strong.get(e);return n?n.value:Sr.luaO_nilobject},Ut=function(t,e){return Lt("number"==typeof e&&(0|e)===e),Et(t,e)};var Rt={invalidateTMcache:function(t){t.flags=0},luaH_get:function(t,e,n){return Lt(n instanceof Sr.TValue),n.ttisnil()||n.ttisfloat()&&isNaN(n.value)?Sr.luaO_nilobject:Et(e,bt(t,n))},luaH_getint:Ut,luaH_getn:function(t){let e=0,n=t.strong.size+1;for(;n-e>1;){let a=Math.floor((e+n)/2);Ut(t,a).ttisnil()?n=a:e=a}return e},luaH_getstr:function(t,e){return Lt(e instanceof At),Et(t,gt(e))},luaH_setfrom:function(t,e,n,a){Lt(n instanceof Sr.TValue);let r=bt(t,n);if(a.ttisnil())return void mt(e,r);let u=e.strong.get(r);if(u)u.value.setfrom(a);else{let t,u=n.value;t=n.ttisfloat()&&(0|u)===u?new Sr.TValue(ct,u):new Sr.TValue(n.type,u);let l=new Sr.TValue(a.type,a.value);kt(e,r,t,l)}},luaH_setint:function(t,e,n){Lt("number"==typeof e&&(0|e)===e&&n instanceof Sr.TValue);let a=e;if(n.ttisnil())return void mt(t,a);let r=t.strong.get(a);if(r){r.value.setfrom(n)}else{let r=new Sr.TValue(ct,e),u=new Sr.TValue(n.type,n.value);kt(t,a,r,u)}},luaH_new:function(t){return new Ot(t)},luaH_next:function(t,e,n){let a,r=t.stack[n];if(r.type===ot){if(a=e.f,!a)return!1}else{let n=bt(t,r);if(a=e.strong.get(n),a){if(a=a.n,!a)return!1}else{if(a=e.dead_weak&&e.dead_weak.get(n)||e.dead_strong.get(n),!a)return p_.luaG_runerror(t,dt("invalid key to 'next'"));do{if(a=a.n,!a)return!1}while(a.key.ttisdeadkey())}}return Sr.setobj2s(t,n,a.key),Sr.setobj2s(t,n+1,a.value),!0},Table:Ot};const Nt=[96,113,65,84,80,80,92,108,60,16,60,84,108,124,124,124,124,124,124,124,124,124,124,124,124,96,96,96,96,104,34,188,188,188,132,228,84,84,16,98,98,4,98,20,81,80,23],yt=function(t,e){return~(-1<<t)<<e},wt=function(t,e){return~yt(t,e)},St=function(t,e,n,a){return t.code=t.code&wt(a,n)|e<<n&yt(a,n),Mt(t)},It=function(t,e){return St(t,e,14,18)},Mt=function(t){if("number"==typeof t)return{code:t,opcode:t>>0&yt(6,0),A:t>>6&yt(8,0),B:t>>23&yt(9,0),C:t>>14&yt(9,0),Bx:t>>14&yt(18,0),Ax:t>>6&yt(26,0),sBx:(t>>14&yt(18,0))-131071};{let e=t.code;return t.opcode=e>>0&yt(6,0),t.A=e>>6&yt(8,0),t.B=e>>23&yt(9,0),t.C=e>>14&yt(9,0),t.Bx=e>>14&yt(18,0),t.Ax=e>>6&yt(26,0),t.sBx=(e>>14&yt(18,0))-131071,t}};var Pt={BITRK:256,CREATE_ABC:function(t,e,n,a){return Mt(t<<0|e<<6|n<<23|a<<14)},CREATE_ABx:function(t,e,n){return Mt(t<<0|e<<6|n<<14)},CREATE_Ax:function(t,e){return Mt(t<<0|e<<6)},GET_OPCODE:function(t){return t.opcode},GETARG_A:function(t){return t.A},GETARG_B:function(t){return t.B},GETARG_C:function(t){return t.C},GETARG_Bx:function(t){return t.Bx},GETARG_Ax:function(t){return t.Ax},GETARG_sBx:function(t){return t.sBx},INDEXK:function(t){return-257&t},ISK:function(t){return 256&t},LFIELDS_PER_FLUSH:50,MAXARG_A:255,MAXARG_Ax:67108863,MAXARG_B:511,MAXARG_Bx:262143,MAXARG_C:511,MAXARG_sBx:131071,MAXINDEXRK:255,NO_REG:255,OpArgK:3,OpArgN:0,OpArgR:2,OpArgU:1,OpCodes:["MOVE","LOADK","LOADKX","LOADBOOL","LOADNIL","GETUPVAL","GETTABUP","GETTABLE","SETTABUP","SETUPVAL","SETTABLE","NEWTABLE","SELF","ADD","SUB","MUL","MOD","POW","DIV","IDIV","BAND","BOR","BXOR","SHL","SHR","UNM","BNOT","NOT","LEN","CONCAT","JMP","EQ","LT","LE","TEST","TESTSET","CALL","TAILCALL","RETURN","FORLOOP","FORPREP","TFORCALL","TFORLOOP","SETLIST","CLOSURE","VARARG","EXTRAARG"],OpCodesI:{OP_MOVE:0,OP_LOADK:1,OP_LOADKX:2,OP_LOADBOOL:3,OP_LOADNIL:4,OP_GETUPVAL:5,OP_GETTABUP:6,OP_GETTABLE:7,OP_SETTABUP:8,OP_SETUPVAL:9,OP_SETTABLE:10,OP_NEWTABLE:11,OP_SELF:12,OP_ADD:13,OP_SUB:14,OP_MUL:15,OP_MOD:16,OP_POW:17,OP_DIV:18,OP_IDIV:19,OP_BAND:20,OP_BOR:21,OP_BXOR:22,OP_SHL:23,OP_SHR:24,OP_UNM:25,OP_BNOT:26,OP_NOT:27,OP_LEN:28,OP_CONCAT:29,OP_JMP:30,OP_EQ:31,OP_LT:32,OP_LE:33,OP_TEST:34,OP_TESTSET:35,OP_CALL:36,OP_TAILCALL:37,OP_RETURN:38,OP_FORLOOP:39,OP_FORPREP:40,OP_TFORCALL:41,OP_TFORLOOP:42,OP_SETLIST:43,OP_CLOSURE:44,OP_VARARG:45,OP_EXTRAARG:46},POS_A:6,POS_Ax:6,POS_B:23,POS_Bx:14,POS_C:14,POS_OP:0,RKASK:function(t){return 256|t},SETARG_A:function(t,e){return St(t,e,6,8)},SETARG_Ax:function(t,e){return St(t,e,6,26)},SETARG_B:function(t,e){return St(t,e,23,9)},SETARG_Bx:It,SETARG_C:function(t,e){return St(t,e,14,9)},SETARG_sBx:function(t,e){return It(t,e+131071)},SET_OPCODE:function(t,e){return t.code=t.code&wt(6,0)|e<<0&yt(6,0),Mt(t)},SIZE_A:8,SIZE_Ax:26,SIZE_B:9,SIZE_Bx:18,SIZE_C:9,SIZE_OP:6,fullins:Mt,getBMode:function(t){return Nt[t]>>4&3},getCMode:function(t){return Nt[t]>>2&3},getOpMode:function(t){return 3&Nt[t]},iABC:0,iABx:1,iAsBx:2,iAx:3,testAMode:function(t){return 64&Nt[t]},testTMode:function(t){return 128&Nt[t]}};const{LUA_MASKLINE:xt,LUA_MASKCOUNT:Ct,LUA_MULTRET:Dt,constant_types:{LUA_TBOOLEAN:Bt,LUA_TLCF:Vt,LUA_TLIGHTUSERDATA:Gt,LUA_TLNGSTR:Kt,LUA_TNIL:Ft,LUA_TNUMBER:jt,LUA_TNUMFLT:Ht,LUA_TNUMINT:Xt,LUA_TSHRSTR:zt,LUA_TTABLE:Jt,LUA_TUSERDATA:qt},to_luastring:Yt}=V,{INDEXK:Wt,ISK:Zt,LFIELDS_PER_FLUSH:Qt,OpCodesI:{OP_ADD:$t,OP_BAND:te,OP_BNOT:ee,OP_BOR:ne,OP_BXOR:ae,OP_CALL:re,OP_CLOSURE:ue,OP_CONCAT:le,OP_DIV:se,OP_EQ:oe,OP_EXTRAARG:ie,OP_FORLOOP:ce,OP_FORPREP:fe,OP_GETTABLE:_e,OP_GETTABUP:pe,OP_GETUPVAL:he,OP_IDIV:de,OP_JMP:Le,OP_LE:ge,OP_LEN:Ae,OP_LOADBOOL:Te,OP_LOADK:ve,OP_LOADKX:be,OP_LOADNIL:Oe,OP_LT:ke,OP_MOD:me,OP_MOVE:Ee,OP_MUL:Ue,OP_NEWTABLE:Re,OP_NOT:Ne,OP_POW:ye,OP_RETURN:we,OP_SELF:Se,OP_SETLIST:Ie,OP_SETTABLE:Me,OP_SETTABUP:Pe,OP_SETUPVAL:xe,OP_SHL:Ce,OP_SHR:De,OP_SUB:Be,OP_TAILCALL:Ve,OP_TEST:Ge,OP_TESTSET:Ke,OP_TFORCALL:Fe,OP_TFORLOOP:je,OP_UNM:He,OP_VARARG:Xe}}=Pt,{LUA_MAXINTEGER:ze,LUA_MININTEGER:Je,lua_numbertointeger:qe}=g,{lua_assert:Ye,luai_nummod:We}=j,{luaS_bless:Ze,luaS_eqlngstr:Qe,luaS_hashlongstr:$e}=et,tn=function(t,e,n){return e+n.A},en=function(t,e,n){return e+n.B},nn=function(t,e,n,a){return Zt(a.B)?n[Wt(a.B)]:t.stack[e+a.B]},an=function(t,e,n,a){return Zt(a.C)?n[Wt(a.C)]:t.stack[e+a.C]},rn=function(t,e,n,a){let r=n.A;0!==r&&Mr.luaF_close(t,e.l_base+r-1),e.l_savedpc+=n.sBx+a},un=function(t,e){rn(t,e,e.l_code[e.l_savedpc],1)},ln=function(t,e,n){if(e.ttisnumber()&&n.ttisnumber())return hn(e,n)?1:0;if(e.ttisstring()&&n.ttisstring())return Ln(e.tsvalue(),n.tsvalue())<0?1:0;{let a=Jn.luaT_callorderTM(t,e,n,Jn.TMS.TM_LT);return null===a&&p_.luaG_ordererror(t,e,n),a?1:0}},sn=function(t,e,n){let a;return e.ttisnumber()&&n.ttisnumber()?dn(e,n)?1:0:e.ttisstring()&&n.ttisstring()?Ln(e.tsvalue(),n.tsvalue())<=0?1:0:(a=Jn.luaT_callorderTM(t,e,n,Jn.TMS.TM_LE),null!==a?a?1:0:(t.ci.callstatus|=ca.CIST_LEQ,a=Jn.luaT_callorderTM(t,n,e,Jn.TMS.TM_LT),t.ci.callstatus^=ca.CIST_LEQ,null===a&&p_.luaG_ordererror(t,e,n),a?0:1))},on=function(t,e,n){if(e.ttype()!==n.ttype())return e.ttnov()!==n.ttnov()||e.ttnov()!==jt?0:e.value===n.value?1:0;let a;switch(e.ttype()){case Ft:return 1;case Bt:return e.value==n.value?1:0;case Gt:case Xt:case Ht:case Vt:return e.value===n.value?1:0;case zt:case Kt:return Qe(e.tsvalue(),n.tsvalue())?1:0;case qt:case Jt:if(e.value===n.value)return 1;if(null===t)return 0;a=Jn.fasttm(t,e.value.metatable,Jn.TMS.TM_EQ),null===a&&(a=Jn.fasttm(t,n.value.metatable,Jn.TMS.TM_EQ));break;default:return e.value===n.value?1:0}if(null===a)return 0;let r=new Sr.TValue;return Jn.luaT_callTM(t,a,e,n,r,1),r.l_isfalse()?0:1},cn=function(t,e){let n=!1,a=fn(t,e<0?2:1);if(!1===a){let r=pn(t);if(!1===r)return!1;0<r?(a=ze,e<0&&(n=!0)):(a=Je,e>=0&&(n=!0))}return{stopnow:n,ilimit:a}},fn=function(t,e){if(t.ttisfloat()){let n=t.value,a=Math.floor(n);if(n!==a){if(0===e)return!1;e>1&&(a+=1)}return qe(a)}if(t.ttisinteger())return t.value;if(En(t)){let n=new Sr.TValue;if(Sr.luaO_str2num(t.svalue(),n)===t.vslen()+1)return fn(n,e)}return!1},_n=function(t){return t.ttisinteger()?t.value:fn(t,0)},pn=function(t){if(t.ttnov()===jt)return t.value;if(En(t)){let e=new Sr.TValue;if(Sr.luaO_str2num(t.svalue(),e)===t.vslen()+1)return e.value}return!1},hn=function(t,e){return t.value<e.value},dn=function(t,e){return t.value<=e.value},Ln=function(t,e){let n=$e(t),a=$e(e);return n===a?0:n<a?-1:1},gn=function(t,e,n){let a;switch(n.ttype()){case Jt:{let r=n.value;if(a=Jn.fasttm(t,r.metatable,Jn.TMS.TM_LEN),null!==a)break;return void e.setivalue(Rt.luaH_getn(r))}case zt:case Kt:return void e.setivalue(n.vslen());default:a=Jn.luaT_gettmbyobj(t,n,Jn.TMS.TM_LEN),a.ttisnil()&&p_.luaG_typeerror(t,n,Yt("get length of",!0))}Jn.luaT_callTM(t,a,n,n,e,1)},An=Math.imul||function(t,e){let n=65535&t,a=65535&e;return n*a+((t>>>16&65535)*a+n*(e>>>16&65535)<<16>>>0)|0},Tn=function(t,e,n){return 0===n&&p_.luaG_runerror(t,Yt("attempt to divide by zero")),0|Math.floor(e/n)},vn=function(t,e,n){return 0===n&&p_.luaG_runerror(t,Yt("attempt to perform 'n%%0'")),e-Math.floor(e/n)*n|0},bn=function(t,e){return e<0?e<=-32?0:t>>>-e:e>=32?0:t<<e},On=function(t,e,n,a){let r=t.cache;if(null!==r){let u=t.upvalues,l=u.length;for(let t=0;t<l;t++){let l=u[t].instack?n[a+u[t].idx]:e[u[t].idx];if(r.upvals[t]!==l)return null}}return r},kn=function(t,e,n,a,r){let u=e.upvalues.length,l=e.upvalues,s=new Sr.LClosure(t,u);s.p=e,t.stack[r].setclLvalue(s);for(let e=0;e<u;e++)l[e].instack?s.upvals[e]=Mr.luaF_findupval(t,a+l[e].idx):s.upvals[e]=n[l[e].idx];e.cache=s},mn=function(t){return t.ttisnumber()},En=function(t){return t.ttisstring()},Un=function(t,e){let n=t.stack[e];return!!n.ttisstring()||!!mn(n)&&(Sr.luaO_tostring(t,n),!0)},Rn=function(t){return t.ttisstring()&&0===t.vslen()},Nn=function(t,e,n,a){let r=0;do{let u=t.stack[e-n],l=u.vslen(),s=u.svalue();a.set(s,r),r+=l}while(--n>0)},yn=function(t,e){Ye(e>=2);do{let n=t.top,a=2;if((t.stack[n-2].ttisstring()||mn(t.stack[n-2]))&&Un(t,n-1))if(Rn(t.stack[n-1]))Un(t,n-2);else if(Rn(t.stack[n-2]))Sr.setobjs2s(t,n-2,n-1);else{let r=t.stack[n-1].vslen();for(a=1;a<e&&Un(t,n-a-1);a++){r+=t.stack[n-a-1].vslen()}let u=new Uint8Array(r);Nn(t,n,a,u);let l=Ze(t,u);Sr.setsvalue2s(t,n-a,l)}else Jn.luaT_trybinTM(t,t.stack[n-2],t.stack[n-1],t.stack[n-2],Jn.TMS.TM_CONCAT);for(e-=a-1;t.top>n-(a-1);)delete t.stack[--t.top]}while(e>1)},wn=function(t,e,n,a){for(let r=0;r<2e3;r++){let r;if(e.ttistable()){let u=Rt.luaH_get(t,e.value,n);if(!u.ttisnil())return void Sr.setobj2s(t,a,u);if(r=Jn.fasttm(t,e.value.metatable,Jn.TMS.TM_INDEX),null===r)return void t.stack[a].setnilvalue()}else r=Jn.luaT_gettmbyobj(t,e,Jn.TMS.TM_INDEX),r.ttisnil()&&p_.luaG_typeerror(t,e,Yt("index",!0));if(r.ttisfunction())return void Jn.luaT_callTM(t,r,e,n,t.stack[a],1);e=r}p_.luaG_runerror(t,Yt("'__index' chain too long; possible loop",!0))},Sn=function(t,e,n,a){for(let r=0;r<2e3;r++){let r;if(e.ttistable()){let u=e.value;if(!Rt.luaH_get(t,u,n).ttisnil()||null===(r=Jn.fasttm(t,u.metatable,Jn.TMS.TM_NEWINDEX)))return Rt.luaH_setfrom(t,u,n,a),void Rt.invalidateTMcache(u)}else(r=Jn.luaT_gettmbyobj(t,e,Jn.TMS.TM_NEWINDEX)).ttisnil()&&p_.luaG_typeerror(t,e,Yt("index",!0));if(r.ttisfunction())return void Jn.luaT_callTM(t,r,e,n,a,0);e=r}p_.luaG_runerror(t,Yt("'__newindex' chain too long; possible loop",!0))};var In={cvt2str:mn,cvt2num:En,luaV_gettable:wn,luaV_concat:yn,luaV_div:Tn,luaV_equalobj:on,luaV_execute:function(t){let e=t.ci;e.callstatus|=ca.CIST_FRESH;t:for(;;){Ye(e===t.ci);let n=e.func.value,a=n.p.k,r=e.l_base,u=e.l_code[e.l_savedpc++];t.hookmask&(xt|Ct)&&p_.luaG_traceexec(t);let l=tn(0,r,u);switch(u.opcode){case Ee:Sr.setobjs2s(t,l,en(0,r,u));break;case ve:{let e=a[u.Bx];Sr.setobj2s(t,l,e);break}case be:{Ye(e.l_code[e.l_savedpc].opcode===ie);let n=a[e.l_code[e.l_savedpc++].Ax];Sr.setobj2s(t,l,n);break}case Te:t.stack[l].setbvalue(0!==u.B),0!==u.C&&e.l_savedpc++;break;case Oe:for(let e=0;e<=u.B;e++)t.stack[l+e].setnilvalue();break;case he:{let e=u.B;Sr.setobj2s(t,l,n.upvals[e]);break}case pe:{let e=n.upvals[u.B],s=an(t,r,a,u);wn(t,e,s,l);break}case _e:{let e=t.stack[en(0,r,u)],n=an(t,r,a,u);wn(t,e,n,l);break}case Pe:{let e=n.upvals[u.A],l=nn(t,r,a,u),s=an(t,r,a,u);Sn(t,e,l,s);break}case xe:n.upvals[u.B].setfrom(t.stack[l]);break;case Me:{let e=t.stack[l],n=nn(t,r,a,u),s=an(t,r,a,u);Sn(t,e,n,s);break}case Re:t.stack[l].sethvalue(Rt.luaH_new(t));break;case Se:{let e=en(0,r,u),n=an(t,r,a,u);Sr.setobjs2s(t,l+1,e),wn(t,t.stack[e],n,l);break}case $t:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);s.ttisinteger()&&o.ttisinteger()?t.stack[l].setivalue(s.value+o.value|0):!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(e+n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_ADD);break}case Be:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);s.ttisinteger()&&o.ttisinteger()?t.stack[l].setivalue(s.value-o.value|0):!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(e-n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_SUB);break}case Ue:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);s.ttisinteger()&&o.ttisinteger()?t.stack[l].setivalue(An(s.value,o.value)):!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(e*n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_MUL);break}case me:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);s.ttisinteger()&&o.ttisinteger()?t.stack[l].setivalue(vn(t,s.value,o.value)):!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(We(t,e,n)):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_MOD);break}case ye:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(Math.pow(e,n)):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_POW);break}case se:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(e/n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_DIV);break}case de:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);s.ttisinteger()&&o.ttisinteger()?t.stack[l].setivalue(Tn(t,s.value,o.value)):!1!==(e=pn(s))&&!1!==(n=pn(o))?t.stack[l].setfltvalue(Math.floor(e/n)):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_IDIV);break}case te:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=_n(s))&&!1!==(n=_n(o))?t.stack[l].setivalue(e&n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_BAND);break}case ne:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=_n(s))&&!1!==(n=_n(o))?t.stack[l].setivalue(e|n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_BOR);break}case ae:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=_n(s))&&!1!==(n=_n(o))?t.stack[l].setivalue(e^n):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_BXOR);break}case Ce:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=_n(s))&&!1!==(n=_n(o))?t.stack[l].setivalue(bn(e,n)):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_SHL);break}case De:{let e,n,s=nn(t,r,a,u),o=an(t,r,a,u);!1!==(e=_n(s))&&!1!==(n=_n(o))?t.stack[l].setivalue(bn(e,-n)):Jn.luaT_trybinTM(t,s,o,t.stack[l],Jn.TMS.TM_SHR);break}case He:{let e,n=t.stack[en(0,r,u)];n.ttisinteger()?t.stack[l].setivalue(0|-n.value):!1!==(e=pn(n))?t.stack[l].setfltvalue(-e):Jn.luaT_trybinTM(t,n,n,t.stack[l],Jn.TMS.TM_UNM);break}case ee:{let e=t.stack[en(0,r,u)];e.ttisinteger()?t.stack[l].setivalue(~e.value):Jn.luaT_trybinTM(t,e,e,t.stack[l],Jn.TMS.TM_BNOT);break}case Ne:{let e=t.stack[en(0,r,u)];t.stack[l].setbvalue(e.l_isfalse());break}case Ae:gn(t,t.stack[l],t.stack[en(0,r,u)]);break;case le:{let n=u.B,a=u.C;t.top=r+a+1,yn(t,a-n+1);let s=r+n;Sr.setobjs2s(t,l,s),Pf.adjust_top(t,e.top);break}case Le:rn(t,e,u,0);break;case oe:on(t,nn(t,r,a,u),an(t,r,a,u))!==u.A?e.l_savedpc++:un(t,e);break;case ke:ln(t,nn(t,r,a,u),an(t,r,a,u))!==u.A?e.l_savedpc++:un(t,e);break;case ge:sn(t,nn(t,r,a,u),an(t,r,a,u))!==u.A?e.l_savedpc++:un(t,e);break;case Ge:(u.C?t.stack[l].l_isfalse():!t.stack[l].l_isfalse())?e.l_savedpc++:un(t,e);break;case Ke:{let n=en(0,r,u),a=t.stack[n];(u.C?a.l_isfalse():!a.l_isfalse())?e.l_savedpc++:(Sr.setobjs2s(t,l,n),un(t,e));break}case re:{let n=u.B,a=u.C-1;if(0!==n&&Pf.adjust_top(t,l+n),!Pf.luaD_precall(t,l,a)){e=t.ci;continue t}a>=0&&Pf.adjust_top(t,e.top);break}case Ve:{let a=u.B;if(0!==a&&Pf.adjust_top(t,l+a),!Pf.luaD_precall(t,l,Dt)){let a=t.ci,r=a.previous,u=a.func,l=a.funcOff,s=r.funcOff,o=a.l_base+u.value.p.numparams;n.p.p.length>0&&Mr.luaF_close(t,r.l_base);for(let e=0;l+e<o;e++)Sr.setobjs2s(t,s+e,l+e);r.l_base=s+(a.l_base-l),r.top=s+(t.top-l),Pf.adjust_top(t,r.top),r.l_code=a.l_code,r.l_savedpc=a.l_savedpc,r.callstatus|=ca.CIST_TAIL,r.next=null,e=t.ci=r,Ye(t.top===r.l_base+t.stack[s].value.p.maxstacksize);continue t}break}case we:{n.p.p.length>0&&Mr.luaF_close(t,r);let a=Pf.luaD_poscall(t,e,l,0!==u.B?u.B-1:t.top-l);if(e.callstatus&ca.CIST_FRESH)return;e=t.ci,a&&Pf.adjust_top(t,e.top),Ye(e.callstatus&ca.CIST_LUA),Ye(e.l_code[e.l_savedpc-1].opcode===re);continue t}case ce:if(t.stack[l].ttisinteger()){let n=t.stack[l+2].value,a=t.stack[l].value+n|0,r=t.stack[l+1].value;(0<n?a<=r:r<=a)&&(e.l_savedpc+=u.sBx,t.stack[l].chgivalue(a),t.stack[l+3].setivalue(a))}else{let n=t.stack[l+2].value,a=t.stack[l].value+n,r=t.stack[l+1].value;(0<n?a<=r:r<=a)&&(e.l_savedpc+=u.sBx,t.stack[l].chgfltvalue(a),t.stack[l+3].setfltvalue(a))}break;case fe:{let n,a=t.stack[l],r=t.stack[l+1],s=t.stack[l+2];if(a.ttisinteger()&&s.ttisinteger()&&(n=cn(r,s.value))){let t=n.stopnow?0:a.value;r.value=n.ilimit,a.value=t-s.value|0}else{let e,n,u;!1===(e=pn(r))&&p_.luaG_runerror(t,Yt("'for' limit must be a number",!0)),t.stack[l+1].setfltvalue(e),!1===(n=pn(s))&&p_.luaG_runerror(t,Yt("'for' step must be a number",!0)),t.stack[l+2].setfltvalue(n),!1===(u=pn(a))&&p_.luaG_runerror(t,Yt("'for' initial value must be a number",!0)),t.stack[l].setfltvalue(u-n)}e.l_savedpc+=u.sBx;break}case Fe:{let n=l+3;Sr.setobjs2s(t,n+2,l+2),Sr.setobjs2s(t,n+1,l+1),Sr.setobjs2s(t,n,l),Pf.adjust_top(t,n+3),Pf.luaD_call(t,n,u.C),Pf.adjust_top(t,e.top),u=e.l_code[e.l_savedpc++],l=tn(0,r,u),Ye(u.opcode===je)}case je:t.stack[l+1].ttisnil()||(Sr.setobjs2s(t,l,l+1),e.l_savedpc+=u.sBx);break;case Ie:{let n=u.B,a=u.C;0===n&&(n=t.top-l-1),0===a&&(Ye(e.l_code[e.l_savedpc].opcode===ie),a=e.l_code[e.l_savedpc++].Ax);let r=t.stack[l].value,s=(a-1)*Qt+n;for(;n>0;n--)Rt.luaH_setint(r,s--,t.stack[l+n]);Pf.adjust_top(t,e.top);break}case ue:{let e=n.p.p[u.Bx],a=On(e,n.upvals,t.stack,r);null===a?kn(t,e,n.upvals,r,l):t.stack[l].setclLvalue(a);break}case Xe:{let a,s=u.B-1,o=r-e.funcOff-n.p.numparams-1;for(o<0&&(o=0),s<0&&(s=o,Pf.luaD_checkstack(t,o),Pf.adjust_top(t,l+o)),a=0;a<s&&a<o;a++)Sr.setobjs2s(t,l+a,r-o+a);for(;a<s;a++)t.stack[l+a].setnilvalue();break}case ie:throw Error("invalid opcode")}}},luaV_finishOp:function(t){let e=t.ci,n=e.l_base,a=e.l_code[e.l_savedpc-1],r=a.opcode;switch(r){case $t:case Be:case Ue:case se:case de:case te:case ne:case ae:case Ce:case De:case me:case ye:case He:case ee:case Ae:case pe:case _e:case Se:Sr.setobjs2s(t,n+a.A,t.top-1),delete t.stack[--t.top];break;case ge:case ke:case oe:{let n=!t.stack[t.top-1].l_isfalse();delete t.stack[--t.top],e.callstatus&ca.CIST_LEQ&&(Ye(r===ge),e.callstatus^=ca.CIST_LEQ,n=!n),Ye(e.l_code[e.l_savedpc].opcode===Le),n!==!!a.A&&e.l_savedpc++;break}case le:{let r=t.top-1,u=r-1-(n+a.B);Sr.setobjs2s(t,r-2,r),u>1&&(t.top=r-1,yn(t,u)),Sr.setobjs2s(t,e.l_base+a.A,t.top-1),Pf.adjust_top(t,e.top);break}case Fe:Ye(e.l_code[e.l_savedpc].opcode===je),Pf.adjust_top(t,e.top);break;case re:a.C-1>=0&&Pf.adjust_top(t,e.top)}},luaV_imul:An,luaV_lessequal:sn,luaV_lessthan:ln,luaV_mod:vn,luaV_objlen:gn,luaV_rawequalobj:function(t,e){return on(null,t,e)},luaV_shiftl:bn,luaV_tointeger:fn,settable:Sn,tointeger:_n,tonumber:pn};const{constant_types:{LUA_TTABLE:Mn,LUA_TUSERDATA:Pn},to_luastring:xn}=V,{lua_assert:Cn}=j,{luaS_bless:Dn,luaS_new:Bn}=et,Vn=["no value","nil","boolean","userdata","number","string","table","function","userdata","thread","proto"].map(t=>xn(t)),Gn=function(t){return Vn[t+1]},Kn={TM_INDEX:0,TM_NEWINDEX:1,TM_GC:2,TM_MODE:3,TM_LEN:4,TM_EQ:5,TM_ADD:6,TM_SUB:7,TM_MUL:8,TM_MOD:9,TM_POW:10,TM_DIV:11,TM_IDIV:12,TM_BAND:13,TM_BOR:14,TM_BXOR:15,TM_SHL:16,TM_SHR:17,TM_UNM:18,TM_BNOT:19,TM_LT:20,TM_LE:21,TM_CONCAT:22,TM_CALL:23,TM_N:24},Fn=xn("__name",!0),jn=function(t,e,n,a,r,u){let l=t.top;if(Sr.pushobj2s(t,e),Sr.pushobj2s(t,n),Sr.pushobj2s(t,a),u||Sr.pushobj2s(t,r),t.ci.callstatus&ca.CIST_LUA?Pf.luaD_call(t,l,u):Pf.luaD_callnoyield(t,l,u),u){let e=t.stack[t.top-1];delete t.stack[--t.top],r.setfrom(e)}},Hn=function(t,e,n,a,r){let u=zn(t,e,r);return u.ttisnil()&&(u=zn(t,n,r)),!u.ttisnil()&&(jn(t,u,e,n,a,1),!0)},Xn=function(t,e,n){const a=Rt.luaH_getstr(t,n);return Cn(e<=Kn.TM_EQ),a.ttisnil()?(t.flags|=1<<e,null):a},zn=function(t,e,n){let a;switch(e.ttnov()){case Mn:case Pn:a=e.value.metatable;break;default:a=t.l_G.mt[e.ttnov()]}return a?Rt.luaH_getstr(a,t.l_G.tmname[n]):Sr.luaO_nilobject};var Jn={fasttm:function(t,e,n){return null===e?null:e.flags&1<<n?null:Xn(e,n,t.l_G.tmname[n])},TMS:Kn,luaT_callTM:jn,luaT_callbinTM:Hn,luaT_trybinTM:function(t,e,n,a,r){if(!Hn(t,e,n,a,r))switch(r){case Kn.TM_CONCAT:return p_.luaG_concaterror(t,e,n);case Kn.TM_BAND:case Kn.TM_BOR:case Kn.TM_BXOR:case Kn.TM_SHL:case Kn.TM_SHR:case Kn.TM_BNOT:{let a=In.tonumber(e),r=In.tonumber(n);return!1!==a&&!1!==r?p_.luaG_tointerror(t,e,n):p_.luaG_opinterror(t,e,n,xn("perform bitwise operation on",!0))}default:return p_.luaG_opinterror(t,e,n,xn("perform arithmetic on",!0))}},luaT_callorderTM:function(t,e,n,a){let r=new Sr.TValue;return Hn(t,e,n,r,a)?!r.l_isfalse():null},luaT_gettm:Xn,luaT_gettmbyobj:zn,luaT_init:function(t){t.l_G.tmname[Kn.TM_INDEX]=new Bn(t,xn("__index",!0)),t.l_G.tmname[Kn.TM_NEWINDEX]=new Bn(t,xn("__newindex",!0)),t.l_G.tmname[Kn.TM_GC]=new Bn(t,xn("__gc",!0)),t.l_G.tmname[Kn.TM_MODE]=new Bn(t,xn("__mode",!0)),t.l_G.tmname[Kn.TM_LEN]=new Bn(t,xn("__len",!0)),t.l_G.tmname[Kn.TM_EQ]=new Bn(t,xn("__eq",!0)),t.l_G.tmname[Kn.TM_ADD]=new Bn(t,xn("__add",!0)),t.l_G.tmname[Kn.TM_SUB]=new Bn(t,xn("__sub",!0)),t.l_G.tmname[Kn.TM_MUL]=new Bn(t,xn("__mul",!0)),t.l_G.tmname[Kn.TM_MOD]=new Bn(t,xn("__mod",!0)),t.l_G.tmname[Kn.TM_POW]=new Bn(t,xn("__pow",!0)),t.l_G.tmname[Kn.TM_DIV]=new Bn(t,xn("__div",!0)),t.l_G.tmname[Kn.TM_IDIV]=new Bn(t,xn("__idiv",!0)),t.l_G.tmname[Kn.TM_BAND]=new Bn(t,xn("__band",!0)),t.l_G.tmname[Kn.TM_BOR]=new Bn(t,xn("__bor",!0)),t.l_G.tmname[Kn.TM_BXOR]=new Bn(t,xn("__bxor",!0)),t.l_G.tmname[Kn.TM_SHL]=new Bn(t,xn("__shl",!0)),t.l_G.tmname[Kn.TM_SHR]=new Bn(t,xn("__shr",!0)),t.l_G.tmname[Kn.TM_UNM]=new Bn(t,xn("__unm",!0)),t.l_G.tmname[Kn.TM_BNOT]=new Bn(t,xn("__bnot",!0)),t.l_G.tmname[Kn.TM_LT]=new Bn(t,xn("__lt",!0)),t.l_G.tmname[Kn.TM_LE]=new Bn(t,xn("__le",!0)),t.l_G.tmname[Kn.TM_CONCAT]=new Bn(t,xn("__concat",!0)),t.l_G.tmname[Kn.TM_CALL]=new Bn(t,xn("__call",!0))},luaT_objtypename:function(t,e){let n;if(e.ttistable()&&null!==(n=e.value.metatable)||e.ttisfulluserdata()&&null!==(n=e.value.metatable)){let e=Rt.luaH_getstr(n,Dn(t,Fn));if(e.ttisstring())return e.svalue()}return Gn(e.ttnov())},ttypename:Gn};const{LUA_MINSTACK:qn,LUA_RIDX_GLOBALS:Yn,LUA_RIDX_MAINTHREAD:Wn,constant_types:{LUA_NUMTAGS:Zn,LUA_TNIL:Qn,LUA_TTABLE:$n,LUA_TTHREAD:ta},thread_status:{LUA_OK:ea}}=V,na=2*qn;class aa{constructor(){this.func=null,this.funcOff=NaN,this.top=NaN,this.previous=null,this.next=null,this.l_base=NaN,this.l_code=null,this.l_savedpc=NaN,this.c_k=null,this.c_old_errfunc=null,this.c_ctx=null,this.nresults=NaN,this.callstatus=NaN}}class ra{constructor(t){this.id=t.id_counter++,this.base_ci=new aa,this.top=NaN,this.stack_last=NaN,this.oldpc=NaN,this.l_G=t,this.stack=null,this.ci=null,this.errorJmp=null,this.nCcalls=0,this.hook=null,this.hookmask=0,this.basehookcount=0,this.allowhook=1,this.hookcount=this.basehookcount,this.nny=1,this.status=ea,this.errfunc=0}}class ua{constructor(){this.id_counter=1,this.ids=new WeakMap,this.mainthread=null,this.l_registry=new Sr.TValue(Qn,null),this.panic=null,this.atnativeerror=null,this.version=null,this.tmname=new Array(Jn.TMS.TM_N),this.mt=new Array(Zn)}}const la=function(t){t.ci.next=null},sa=function(t,e){t.stack=new Array(na),t.top=0,t.stack_last=na-5;let n=t.base_ci;n.next=n.previous=null,n.callstatus=0,n.funcOff=t.top,n.func=t.stack[t.top],t.stack[t.top++]=new Sr.TValue(Qn,null),n.top=t.top+qn,t.ci=n},oa=function(t){t.ci=t.base_ci,la(t),t.stack=null},ia=function(t){let e=t.l_G;sa(t),function(t,e){let n=Rt.luaH_new(t);e.l_registry.sethvalue(n),Rt.luaH_setint(n,Wn,new Sr.TValue(ta,t)),Rt.luaH_setint(n,Yn,new Sr.TValue($n,Rt.luaH_new(t)))}(t,e),Jn.luaT_init(t),e.version=Bd.lua_version(null)};var ca={lua_State:ra,CallInfo:aa,CIST_OAH:1,CIST_LUA:2,CIST_HOOKED:4,CIST_FRESH:8,CIST_YPCALL:16,CIST_TAIL:32,CIST_HOOKYIELD:64,CIST_LEQ:128,CIST_FIN:256,EXTRA_STACK:5,lua_close:function(t){!function(t){oa(t)}(t=t.l_G.mainthread)},lua_newstate:function(){let t=new ua,e=new ra(t);return t.mainthread=e,Pf.luaD_rawrunprotected(e,ia,null)!==ea&&(e=null),e},lua_newthread:function(t){let e=t.l_G,n=new ra(e);return t.stack[t.top]=new Sr.TValue(ta,n),Bd.api_incr_top(t),n.hookmask=t.hookmask,n.basehookcount=t.basehookcount,n.hook=t.hook,n.hookcount=n.basehookcount,sa(n),n},luaE_extendCI:function(t){let e=new aa;return t.ci.next=e,e.previous=t.ci,e.next=null,t.ci=e,e},luaE_freeCI:la,luaE_freethread:function(t,e){oa(e)}};const{LUA_OPADD:fa,LUA_OPBAND:_a,LUA_OPBNOT:pa,LUA_OPBOR:ha,LUA_OPBXOR:da,LUA_OPDIV:La,LUA_OPIDIV:ga,LUA_OPMOD:Aa,LUA_OPMUL:Ta,LUA_OPPOW:va,LUA_OPSHL:ba,LUA_OPSHR:Oa,LUA_OPSUB:ka,LUA_OPUNM:ma,constant_types:{LUA_NUMTAGS:Ea,LUA_TBOOLEAN:Ua,LUA_TCCL:Ra,LUA_TFUNCTION:Na,LUA_TLCF:ya,LUA_TLCL:wa,LUA_TLIGHTUSERDATA:Sa,LUA_TLNGSTR:Ia,LUA_TNIL:Ma,LUA_TNUMBER:Pa,LUA_TNUMFLT:xa,LUA_TNUMINT:Ca,LUA_TSHRSTR:Da,LUA_TSTRING:Ba,LUA_TTABLE:Va,LUA_TTHREAD:Ga,LUA_TUSERDATA:Ka},from_userstring:Fa,luastring_indexOf:ja,luastring_of:Ha,to_jsstring:Xa,to_luastring:za}=V,{lisdigit:Ja,lisprint:qa,lisspace:Ya,lisxdigit:Wa}=z,{luaS_bless:Za,luaS_new:Qa}=et,{LUA_COMPAT_FLOATSTRING:$a,ldexp:tr,lua_integer2str:er,lua_number2str:nr}=g,{MAX_INT:ar,luai_nummod:rr,lua_assert:ur}=j,lr=Ea,sr=Ea+1;class or{constructor(t,e){this.type=t,this.value=e}ttype(){return 63&this.type}ttnov(){return 15&this.type}checktag(t){return this.type===t}checktype(t){return this.ttnov()===t}ttisnumber(){return this.checktype(Pa)}ttisfloat(){return this.checktag(xa)}ttisinteger(){return this.checktag(Ca)}ttisnil(){return this.checktag(Ma)}ttisboolean(){return this.checktag(Ua)}ttislightuserdata(){return this.checktag(Sa)}ttisstring(){return this.checktype(Ba)}ttisshrstring(){return this.checktag(Da)}ttislngstring(){return this.checktag(Ia)}ttistable(){return this.checktag(Va)}ttisfunction(){return this.checktype(Na)}ttisclosure(){return(31&this.type)===Na}ttisCclosure(){return this.checktag(Ra)}ttisLclosure(){return this.checktag(wa)}ttislcf(){return this.checktag(ya)}ttisfulluserdata(){return this.checktag(Ka)}ttisthread(){return this.checktag(Ga)}ttisdeadkey(){return this.checktag(sr)}l_isfalse(){return this.ttisnil()||this.ttisboolean()&&!1===this.value}setfltvalue(t){this.type=xa,this.value=t}chgfltvalue(t){ur(this.type==xa),this.value=t}setivalue(t){this.type=Ca,this.value=t}chgivalue(t){ur(this.type==Ca),this.value=t}setnilvalue(){this.type=Ma,this.value=null}setfvalue(t){this.type=ya,this.value=t}setpvalue(t){this.type=Sa,this.value=t}setbvalue(t){this.type=Ua,this.value=t}setsvalue(t){this.type=Ia,this.value=t}setuvalue(t){this.type=Ka,this.value=t}setthvalue(t){this.type=Ga,this.value=t}setclLvalue(t){this.type=wa,this.value=t}setclCvalue(t){this.type=Ra,this.value=t}sethvalue(t){this.type=Va,this.value=t}setdeadvalue(){this.type=sr,this.value=null}setfrom(t){this.type=t.type,this.value=t.value}tsvalue(){return ur(this.ttisstring()),this.value}svalue(){return this.tsvalue().getstr()}vslen(){return this.tsvalue().tsslen()}jsstring(t,e){return Xa(this.svalue(),t,e,!0)}}const ir=function(t,e,n){t.stack[e].setsvalue(n)},cr=new or(Ma,null);Object.freeze(cr);var fr=cr;class _r{constructor(t,e){this.id=t.l_G.id_counter++,this.p=null,this.nupvalues=e,this.upvals=new Array(e)}}class pr{constructor(t,e,n){for(this.id=t.l_G.id_counter++,this.f=e,this.nupvalues=n,this.upvalue=new Array(n);n--;)this.upvalue[n]=new or(Ma,null)}}class hr{constructor(t,e){this.id=t.l_G.id_counter++,this.metatable=null,this.uservalue=new or(Ma,null),this.len=e,this.data=Object.create(null)}}const dr=za("..."),Lr=za('[string "'),gr=za('"]'),Ar=function(t){return Ja(t)?t-48:(223&t)-55},Tr=function(t,e){let n=1;if(ur(e<=1114111),e<128)t[7]=e;else{let a=63;do{t[8-n++]=128|63&e,e>>=6,a>>=1}while(e>a);t[8-n]=~a<<1|e}return n},vr=function(t,e){let n="x"===e?function(t){let e,n=0,a=0,r=0,u=0,l=0,s=!1;for(;Ya(t[n]);)n++;if((e=45===t[n])?n++:43===t[n]&&n++,48!==t[n]||120!==t[n+1]&&88!==t[n+1])return null;for(n+=2;;n++)if(46===t[n]){if(s)break;s=!0}else{if(!Wa(t[n]))break;0===r&&48===t[n]?u++:++r<=30?a=16*a+Ar(t[n]):l++,s&&l--}if(u+r===0)return null;if(l*=4,112===t[n]||80===t[n]){let e,a=0;if(n++,(e=45===t[n])?n++:43===t[n]&&n++,!Ja(t[n]))return null;for(;Ja(t[n]);)a=10*a+t[n++]-48;e&&(a=-a),l+=a}return e&&(a=-a),{n:tr(a,l),i:n}}(t):function(t){try{t=Xa(t)}catch(t){return null}let e=/^[\t\v\f \n\r]*[+-]?(?:[0-9]+\.?[0-9]*|\.[0-9]*)(?:[eE][+-]?[0-9]+)?/.exec(t);if(!e)return null;let n=parseFloat(e[0]);return isNaN(n)?null:{n:n,i:e[0].length}}(t);if(null===n)return null;for(;Ya(t[n.i]);)n.i++;return n.i===t.length||0===t[n.i]?n:null},br=[46,120,88,110,78],Or={46:".",120:"x",88:"x",110:"n",78:"n"},kr=Math.floor(ar/10),mr=ar%10,Er=function(t,e){let n;if(e.ttisinteger())n=za(er(e.value));else{let t=nr(e.value);!$a&&/^[-0123456789]+$/.test(t)&&(t+=".0"),n=za(t)}e.setsvalue(Za(t,n))},Ur=function(t,e){Pf.luaD_inctop(t),ir(t,t.top-1,Qa(t,e))},Rr=function(t,e,n){let a,r=0,u=0,l=0;for(;a=ja(e,37,u),-1!=a;){switch(Ur(t,e.subarray(u,a)),e[a+1]){case 115:{let e=n[l++];if(null===e)e=za("(null)",!0);else{e=Fa(e);let t=ja(e,0);-1!==t&&(e=e.subarray(0,t))}Ur(t,e);break}case 99:{let e=n[l++];qa(e)?Ur(t,Ha(e)):Nr(t,za("<\\%d>",!0),e);break}case 100:case 73:Pf.luaD_inctop(t),t.stack[t.top-1].setivalue(n[l++]),Er(t,t.stack[t.top-1]);break;case 102:Pf.luaD_inctop(t),t.stack[t.top-1].setfltvalue(n[l++]),Er(t,t.stack[t.top-1]);break;case 112:{let e=n[l++];if(e instanceof ca.lua_State||e instanceof Rt.Table||e instanceof hr||e instanceof _r||e instanceof pr)Ur(t,za("0x"+e.id.toString(16)));else switch(typeof e){case"undefined":Ur(t,za("undefined"));break;case"number":Ur(t,za("Number("+e+")"));break;case"string":Ur(t,za("String("+JSON.stringify(e)+")"));break;case"boolean":Ur(t,za(e?"Boolean(true)":"Boolean(false)"));break;case"object":if(null===e){Ur(t,za("null"));break}case"function":{let n=t.l_G.ids.get(e);n||(n=t.l_G.id_counter++,t.l_G.ids.set(e,n)),Ur(t,za("0x"+n.toString(16)));break}default:Ur(t,za("<id NYI>"))}break}case 85:{let e=new Uint8Array(8),a=Tr(e,n[l++]);Ur(t,e.subarray(8-a));break}case 37:Ur(t,za("%",!0));break;default:p_.luaG_runerror(t,za("invalid option '%%%c' to 'lua_pushfstring'"),e[a+1])}r+=2,u=a+2}return Pf.luaD_checkstack(t,1),Ur(t,e.subarray(u)),r>0&&In.luaV_concat(t,r+1),t.stack[t.top-1].svalue()},Nr=function(t,e,...n){return Rr(t,e,n)},yr=function(t,e,n,a){switch(e){case fa:return n+a|0;case ka:return n-a|0;case Ta:return In.luaV_imul(n,a);case Aa:return In.luaV_mod(t,n,a);case ga:return In.luaV_div(t,n,a);case _a:return n&a;case ha:return n|a;case da:return n^a;case ba:return In.luaV_shiftl(n,a);case Oa:return In.luaV_shiftl(n,-a);case ma:return 0-n|0;case pa:return-1^n;default:ur(0)}},wr=function(t,e,n,a){switch(e){case fa:return n+a;case ka:return n-a;case Ta:return n*a;case La:return n/a;case va:return Math.pow(n,a);case ga:return Math.floor(n/a);case ma:return-n;case Aa:return rr(t,n,a);default:ur(0)}};var Sr={luaO_nilobject:fr,CClosure:pr,LClosure:_r,LUA_TDEADKEY:sr,LUA_TPROTO:lr,LocVar:class{constructor(){this.varname=null,this.startpc=NaN,this.endpc=NaN}},TValue:or,Udata:hr,UTF8BUFFSZ:8,luaO_arith:function(t,e,n,a,r){let u="number"==typeof r?t.stack[r]:r;switch(e){case _a:case ha:case da:case ba:case Oa:case pa:{let r,l;if(!1!==(r=In.tointeger(n))&&!1!==(l=In.tointeger(a)))return void u.setivalue(yr(t,e,r,l));break}case La:case va:{let r,l;if(!1!==(r=In.tonumber(n))&&!1!==(l=In.tonumber(a)))return void u.setfltvalue(wr(t,e,r,l));break}default:{let r,l;if(n.ttisinteger()&&a.ttisinteger())return void u.setivalue(yr(t,e,n.value,a.value));if(!1!==(r=In.tonumber(n))&&!1!==(l=In.tonumber(a)))return void u.setfltvalue(wr(t,e,r,l));break}}ur(null!==t),Jn.luaT_trybinTM(t,n,a,r,e-fa+Jn.TMS.TM_ADD)},luaO_chunkid:function(t,e){let n,a=t.length;if(61===t[0])a<e?(n=new Uint8Array(a-1),n.set(t.subarray(1))):(n=new Uint8Array(e),n.set(t.subarray(1,e+1)));else if(64===t[0])a<=e?(n=new Uint8Array(a-1),n.set(t.subarray(1))):(n=new Uint8Array(e),n.set(dr),e-=dr.length,n.set(t.subarray(a-e),dr.length));else{n=new Uint8Array(e);let r=ja(t,10);n.set(Lr);let u=Lr.length;a<(e-=Lr.length+dr.length+gr.length)&&-1===r?(n.set(t,u),u+=t.length):(-1!==r&&(a=r),a>e&&(a=e),n.set(t.subarray(0,a),u),u+=a,n.set(dr,u),u+=dr.length),n.set(gr,u),u+=gr.length,n=n.subarray(0,u)}return n},luaO_hexavalue:Ar,luaO_int2fb:function(t){let e=0;if(t<8)return t;for(;t>=128;)t=t+15>>4,e+=4;for(;t>=16;)t=t+1>>1,e++;return e+1<<3|t-8},luaO_pushfstring:Nr,luaO_pushvfstring:Rr,luaO_str2num:function(t,e){let n=function(t){let e,n=0,a=0,r=!0;for(;Ya(t[n]);)n++;if((e=45===t[n])?n++:43===t[n]&&n++,48!==t[n]||120!==t[n+1]&&88!==t[n+1])for(;n<t.length&&Ja(t[n]);n++){let u=t[n]-48;if(a>=kr&&(a>kr||u>mr+e))return null;a=10*a+u|0,r=!1}else for(n+=2;n<t.length&&Wa(t[n]);n++)a=16*a+Ar(t[n])|0,r=!1;for(;n<t.length&&Ya(t[n]);)n++;return r||n!==t.length&&0!==t[n]?null:{n:0|(e?-a:a),i:n}}(t);return null!==n?(e.setivalue(n.n),n.i+1):(n=function(t){let e=t.length,n=0;for(let a=0;a<e;a++){let e=t[a];if(-1!==br.indexOf(e)){n=e;break}}let a=Or[n];return"n"===a?null:vr(t,a)}(t),null!==n?(e.setfltvalue(n.n),n.i+1):0)},luaO_tostring:Er,luaO_utf8esc:Tr,numarith:wr,pushobj2s:function(t,e){t.stack[t.top++]=new or(e.type,e.value)},pushsvalue2s:function(t,e){t.stack[t.top++]=new or(Ia,e)},setobjs2s:function(t,e,n){t.stack[e].setfrom(t.stack[n])},setobj2s:function(t,e,n){t.stack[e].setfrom(n)},setsvalue2s:ir};const{constant_types:{LUA_TNIL:Ir}}=V;var Mr={MAXUPVAL:255,Proto:class{constructor(t){this.id=t.l_G.id_counter++,this.k=[],this.p=[],this.code=[],this.cache=null,this.lineinfo=[],this.upvalues=[],this.numparams=0,this.is_vararg=!1,this.maxstacksize=0,this.locvars=[],this.linedefined=0,this.lastlinedefined=0,this.source=null}},luaF_findupval:function(t,e){return t.stack[e]},luaF_close:function(t,e){for(let n=e;n<t.top;n++){let e=t.stack[n];t.stack[n]=new Sr.TValue(e.type,e.value)}},luaF_getlocalname:function(t,e,n){for(let a=0;a<t.locvars.length&&t.locvars[a].startpc<=n;a++)if(n<t.locvars[a].endpc&&0===--e)return t.locvars[a].varname.getstr();return null},luaF_initupvals:function(t,e){for(let t=0;t<e.nupvalues;t++)e.upvals[t]=new Sr.TValue(Ir,null)},luaF_newLclosure:function(t,e){return new Sr.LClosure(t,e)}};const{lua_assert:Pr}=j;const xr=function(t){let e=t.reader(t.L,t.data);if(null===e)return-1;Pr(e instanceof Uint8Array,"Should only load binary of array of bytes");let n=e.length;return 0===n?-1:(t.buffer=e,t.off=0,t.n=n-1,t.buffer[t.off++])};var Cr={EOZ:-1,luaZ_buffer:function(t){return t.buffer.subarray(0,t.n)},luaZ_buffremove:function(t,e){t.n-=e},luaZ_fill:xr,luaZ_read:function(t,e,n,a){for(;a;){if(0===t.n){if(-1===xr(t))return a;t.n++,t.off--}let r=a<=t.n?a:t.n;for(let a=0;a<r;a++)e[n++]=t.buffer[t.off++];t.n-=r,0===t.n&&(t.buffer=null),a-=r}return 0},luaZ_resetbuffer:function(t){t.n=0},luaZ_resizebuffer:function(t,e,n){let a=new Uint8Array(n);e.buffer&&a.set(e.buffer),e.buffer=a},MBuffer:class{constructor(){this.buffer=null,this.n=0}},ZIO:class{constructor(t,e,n){this.L=t,Pr("function"==typeof e,"ZIO requires a reader"),this.reader=e,this.data=n,this.n=0,this.buffer=null,this.off=0}zgetc(){return this.n-- >0?this.buffer[this.off++]:xr(this)}}};const{constant_types:{LUA_TBOOLEAN:Dr,LUA_TLNGSTR:Br},thread_status:{LUA_ERRSYNTAX:Vr},to_luastring:Gr}=V,{LUA_MINBUFFER:Kr,MAX_INT:Fr,lua_assert:jr}=j,{lisdigit:Hr,lislalnum:Xr,lislalpha:zr,lisspace:Jr,lisxdigit:qr}=z,{luaS_bless:Yr,luaS_hash:Wr,luaS_hashlongstr:Zr,luaS_new:Qr}=et,{EOZ:$r,luaZ_buffer:tu,luaZ_buffremove:eu,luaZ_resetbuffer:nu,luaZ_resizebuffer:au}=Cr,ru=Gr("_ENV",!0),uu={TK_AND:257,TK_BREAK:258,TK_DO:259,TK_ELSE:260,TK_ELSEIF:261,TK_END:262,TK_FALSE:263,TK_FOR:264,TK_FUNCTION:265,TK_GOTO:266,TK_IF:267,TK_IN:268,TK_LOCAL:269,TK_NIL:270,TK_NOT:271,TK_OR:272,TK_REPEAT:273,TK_RETURN:274,TK_THEN:275,TK_TRUE:276,TK_UNTIL:277,TK_WHILE:278,TK_IDIV:279,TK_CONCAT:280,TK_DOTS:281,TK_EQ:282,TK_GE:283,TK_LE:284,TK_NE:285,TK_SHL:286,TK_SHR:287,TK_DBCOLON:288,TK_EOS:289,TK_FLT:290,TK_INT:291,TK_NAME:292,TK_STRING:293},lu=["and","break","do","else","elseif","end","false","for","function","goto","if","in","local","nil","not","or","repeat","return","then","true","until","while","//","..","...","==",">=","<=","~=","<<",">>","::","<eof>","<number>","<integer>","<name>","<string>"].map((t,e)=>Gr(t));class su{constructor(){this.r=NaN,this.i=NaN,this.ts=null}}class ou{constructor(){this.token=NaN,this.seminfo=new su}}const iu=function(t,e){let n=t.buff;if(n.n+1>n.buffer.length){n.buffer.length>=Fr/2&&vu(t,Gr("lexical element too long",!0),0);let e=2*n.buffer.length;au(t.L,n,e)}n.buffer[n.n++]=e<0?255+e+1:e},cu=function(t,e){if(e<257)return Sr.luaO_pushfstring(t.L,Gr("'%c'",!0),e);{let n=lu[e-257];return e<289?Sr.luaO_pushfstring(t.L,Gr("'%s'",!0),n):n}},fu=function(t){return 10===t.current||13===t.current},_u=function(t){t.current=t.z.zgetc()},pu=function(t){iu(t,t.current),_u(t)},hu=new Sr.TValue(Dr,!0),du=function(t,e){let n=t.L,a=Qr(n,e),r=t.h.strong.get(Zr(a));if(r)a=r.key.tsvalue();else{let e=new Sr.TValue(Br,a);Rt.luaH_setfrom(n,t.h,e,hu)}return a},Lu=function(t){let e=t.current;jr(fu(t)),_u(t),fu(t)&&t.current!==e&&_u(t),++t.linenumber>=Fr&&vu(t,Gr("chunk has too many lines",!0),0)},gu=function(t,e){return t.current===e&&(_u(t),!0)},Au=function(t,e){return(t.current===e[0].charCodeAt(0)||t.current===e[1].charCodeAt(0))&&(pu(t),!0)},Tu=function(t,e){let n="Ee",a=t.current;for(jr(Hr(t.current)),pu(t),48===a&&Au(t,"xX")&&(n="Pp");;)if(Au(t,n)&&Au(t,"-+"),qr(t.current))pu(t);else{if(46!==t.current)break;pu(t)}let r=new Sr.TValue;return 0===Sr.luaO_str2num(tu(t.buff),r)&&vu(t,Gr("malformed number",!0),290),r.ttisinteger()?(e.i=r.value,291):(jr(r.ttisfloat()),e.r=r.value,290)},vu=function(t,e,n){e=p_.luaG_addinfo(t.L,e,t.source,t.linenumber),n&&Sr.luaO_pushfstring(t.L,Gr("%s near %s"),e,function(t,e){switch(e){case 292:case 293:case 290:case 291:return Sr.luaO_pushfstring(t.L,Gr("'%s'",!0),tu(t.buff));default:return cu(t,e)}}(t,n)),Pf.luaD_throw(t.L,Vr)},bu=function(t){let e=0,n=t.current;for(jr(91===n||93===n),pu(t);61===t.current;)pu(t),e++;return t.current===n?e:-e-1},Ou=function(t,e,n){let a=t.linenumber;pu(t),fu(t)&&Lu(t);let r=!1;for(;!r;)switch(t.current){case $r:vu(t,Gr(`unfinished long ${e?"string":"comment"} (starting at line ${a})`),289);break;case 93:bu(t)===n&&(pu(t),r=!0);break;case 10:case 13:iu(t,10),Lu(t),e||nu(t.buff);break;default:e?pu(t):_u(t)}e&&(e.ts=du(t,t.buff.buffer.subarray(2+n,t.buff.n-(2+n))))},ku=function(t,e,n){e||(t.current!==$r&&pu(t),vu(t,n,293))},mu=function(t){return pu(t),ku(t,qr(t.current),Gr("hexadecimal digit expected",!0)),Sr.luaO_hexavalue(t.current)},Eu=function(t){let e=mu(t);return e=(e<<4)+mu(t),eu(t.buff,2),e},Uu=function(t){let e=new Uint8Array(Sr.UTF8BUFFSZ),n=Sr.luaO_utf8esc(e,function(t){let e=4;pu(t),ku(t,123===t.current,Gr("missing '{'",!0));let n=mu(t);for(pu(t);qr(t.current);)e++,n=(n<<4)+Sr.luaO_hexavalue(t.current),ku(t,n<=1114111,Gr("UTF-8 value too large",!0)),pu(t);return ku(t,125===t.current,Gr("missing '}'",!0)),_u(t),eu(t.buff,e),n}(t));for(;n>0;n--)iu(t,e[Sr.UTF8BUFFSZ-n])},Ru=function(t){let e,n=0;for(e=0;e<3&&Hr(t.current);e++)n=10*n+t.current-48,pu(t);return ku(t,n<=255,Gr("decimal escape too large",!0)),eu(t.buff,e),n},Nu=function(t,e,n){for(pu(t);t.current!==e;)switch(t.current){case $r:vu(t,Gr("unfinished string",!0),289);break;case 10:case 13:vu(t,Gr("unfinished string",!0),293);break;case 92:{let e,n;switch(pu(t),t.current){case 97:n=7,e="read_save";break;case 98:n=8,e="read_save";break;case 102:n=12,e="read_save";break;case 110:n=10,e="read_save";break;case 114:n=13,e="read_save";break;case 116:n=9,e="read_save";break;case 118:n=11,e="read_save";break;case 120:n=Eu(t),e="read_save";break;case 117:Uu(t),e="no_save";break;case 10:case 13:Lu(t),n=10,e="only_save";break;case 92:case 34:case 39:n=t.current,e="read_save";break;case $r:e="no_save";break;case 122:for(eu(t.buff,1),_u(t);Jr(t.current);)fu(t)?Lu(t):_u(t);e="no_save";break;default:ku(t,Hr(t.current),Gr("invalid escape sequence",!0)),n=Ru(t),e="only_save"}"read_save"===e&&_u(t),"read_save"!==e&&"only_save"!==e||(eu(t.buff,1),iu(t,n));break}default:pu(t)}pu(t),n.ts=du(t,t.buff.buffer.subarray(1,t.buff.n-1))},yu=Object.create(null);lu.forEach((t,e)=>yu[Wr(t)]=e);const wu=function(t,e){for(nu(t.buff);;)switch(jr("number"==typeof t.current),t.current){case 10:case 13:Lu(t);break;case 32:case 12:case 9:case 11:_u(t);break;case 45:if(_u(t),45!==t.current)return 45;if(_u(t),91===t.current){let e=bu(t);if(nu(t.buff),e>=0){Ou(t,null,e),nu(t.buff);break}}for(;!fu(t)&&t.current!==$r;)_u(t);break;case 91:{let n=bu(t);return n>=0?(Ou(t,e,n),293):(-1!==n&&vu(t,Gr("invalid long string delimiter",!0),293),91)}case 61:return _u(t),gu(t,61)?282:61;case 60:return _u(t),gu(t,61)?284:gu(t,60)?286:60;case 62:return _u(t),gu(t,61)?283:gu(t,62)?287:62;case 47:return _u(t),gu(t,47)?279:47;case 126:return _u(t),gu(t,61)?285:126;case 58:return _u(t),gu(t,58)?288:58;case 34:case 39:return Nu(t,t.current,e),293;case 46:return pu(t),gu(t,46)?gu(t,46)?281:280:Hr(t.current)?Tu(t,e):46;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return Tu(t,e);case $r:return 289;default:if(zr(t.current)){do{pu(t)}while(Xr(t.current));let n=du(t,tu(t.buff));e.ts=n;let a=yu[Zr(n)];return void 0!==a&&a<=22?a+257:292}{let e=t.current;return _u(t),e}}};var Su={FIRST_RESERVED:257,LUA_ENV:ru,LexState:class{constructor(){this.current=NaN,this.linenumber=NaN,this.lastline=NaN,this.t=new ou,this.lookahead=new ou,this.fs=null,this.L=null,this.z=null,this.buff=null,this.h=null,this.dyd=null,this.source=null,this.envn=null}},RESERVED:uu,isreserved:function(t){let e=yu[Zr(t)];return void 0!==e&&e<=22},luaX_lookahead:function(t){return jr(289===t.lookahead.token),t.lookahead.token=wu(t,t.lookahead.seminfo),t.lookahead.token},luaX_newstring:du,luaX_next:function(t){t.lastline=t.linenumber,289!==t.lookahead.token?(t.t.token=t.lookahead.token,t.t.seminfo.i=t.lookahead.seminfo.i,t.t.seminfo.r=t.lookahead.seminfo.r,t.t.seminfo.ts=t.lookahead.seminfo.ts,t.lookahead.token=289):t.t.token=wu(t,t.t.seminfo)},luaX_setinput:function(t,e,n,a,r){e.t={token:0,seminfo:new su},e.L=t,e.current=r,e.lookahead={token:289,seminfo:new su},e.z=n,e.fs=null,e.linenumber=1,e.lastline=1,e.source=a,e.envn=Yr(t,ru),au(t,e.buff,Kr)},luaX_syntaxerror:function(t,e){vu(t,e,t.t.token)},luaX_token2str:cu,luaX_tokens:lu};const{LUA_MULTRET:Iu,LUA_OPADD:Mu,LUA_OPBAND:Pu,LUA_OPBNOT:xu,LUA_OPBOR:Cu,LUA_OPBXOR:Du,LUA_OPDIV:Bu,LUA_OPIDIV:Vu,LUA_OPMOD:Gu,LUA_OPSHL:Ku,LUA_OPSHR:Fu,LUA_OPUNM:ju,constant_types:{LUA_TBOOLEAN:Hu,LUA_TLIGHTUSERDATA:Xu,LUA_TLNGSTR:zu,LUA_TNIL:Ju,LUA_TNUMFLT:qu,LUA_TNUMINT:Yu,LUA_TTABLE:Wu},to_luastring:Zu}=V,{lua_assert:Qu}=j,$u=Pt.OpCodesI,tl=Sr.TValue,el={OPR_ADD:0,OPR_SUB:1,OPR_MUL:2,OPR_MOD:3,OPR_POW:4,OPR_DIV:5,OPR_IDIV:6,OPR_BAND:7,OPR_BOR:8,OPR_BXOR:9,OPR_SHL:10,OPR_SHR:11,OPR_CONCAT:12,OPR_EQ:13,OPR_LT:14,OPR_LE:15,OPR_NE:16,OPR_GT:17,OPR_GE:18,OPR_AND:19,OPR_OR:20,OPR_NOBINOPR:21},nl={OPR_MINUS:0,OPR_BNOT:1,OPR_NOT:2,OPR_LEN:3,OPR_NOUNOPR:4},al=function(t){return t.t!==t.f},rl=function(t,e){let n=$i.expkind;if(al(t))return!1;switch(t.k){case n.VKINT:return!e||new tl(Yu,t.u.ival);case n.VKFLT:return!e||new tl(qu,t.u.nval);default:return!1}},ul=function(t,e,n){let a,r=e+n-1;if(t.pc>t.lasttarget&&(a=t.f.code[t.pc-1],a.opcode===$u.OP_LOADNIL)){let t=a.A,n=t+a.B;if(t<=e&&e<=n+1||e<=t&&t<=r+1)return t<e&&(e=t),n>r&&(r=n),Pt.SETARG_A(a,e),void Pt.SETARG_B(a,r-e)}bl(t,$u.OP_LOADNIL,e,n-1,0)},ll=function(t,e){return t.f.code[e.u.info]},sl=function(t,e){let n=t.f.code[e].sBx;return-1===n?-1:e+1+n},ol=function(t,e,n){let a=t.f.code[e],r=n-(e+1);Qu(-1!==n),Math.abs(r)>Pt.MAXARG_sBx&&Su.luaX_syntaxerror(t.ls,Zu("control structure too long",!0)),Pt.SETARG_sBx(a,r)},il=function(t,e,n){if(-1===n)return e;if(-1===e)e=n;else{let a=e,r=sl(t,a);for(;-1!==r;)a=r,r=sl(t,a);ol(t,a,n)}return e},cl=function(t){let e=t.jpc;t.jpc=-1;let n=kl(t,$u.OP_JMP,0,-1);return n=il(t,n,e),n},fl=function(t,e,n,a,r){return bl(t,e,n,a,r),cl(t)},_l=function(t){return t.lasttarget=t.pc,t.pc},pl=function(t,e){return e>=1&&Pt.testTMode(t.f.code[e-1].opcode)?e-1:e},hl=function(t,e){return t.f.code[pl(t,e)]},dl=function(t,e,n){let a=pl(t,e),r=t.f.code[a];return r.opcode===$u.OP_TESTSET&&(n!==Pt.NO_REG&&n!==r.B?Pt.SETARG_A(r,n):t.f.code[a]=Pt.CREATE_ABC($u.OP_TEST,r.B,0,r.C),!0)},Ll=function(t,e){for(;-1!==e;e=sl(t,e))dl(t,e,Pt.NO_REG)},gl=function(t,e,n,a,r){for(;-1!==e;){let u=sl(t,e);dl(t,e,a)?ol(t,e,n):ol(t,e,r),e=u}},Al=function(t,e){_l(t),t.jpc=il(t,t.jpc,e)},Tl=function(t,e,n){n===t.pc?Al(t,e):(Qu(n<t.pc),gl(t,e,n,Pt.NO_REG,n))},vl=function(t,e){let n=t.f;return function(t){gl(t,t.jpc,t.pc,Pt.NO_REG,t.pc),t.jpc=-1}(t),n.code[t.pc]=e,n.lineinfo[t.pc]=t.ls.lastline,t.pc++},bl=function(t,e,n,a,r){return Qu(Pt.getOpMode(e)===Pt.iABC),Qu(Pt.getBMode(e)!==Pt.OpArgN||0===a),Qu(Pt.getCMode(e)!==Pt.OpArgN||0===r),Qu(n<=Pt.MAXARG_A&&a<=Pt.MAXARG_B&&r<=Pt.MAXARG_C),vl(t,Pt.CREATE_ABC(e,n,a,r))},Ol=function(t,e,n,a){return Qu(Pt.getOpMode(e)===Pt.iABx||Pt.getOpMode(e)===Pt.iAsBx),Qu(Pt.getCMode(e)===Pt.OpArgN),Qu(n<=Pt.MAXARG_A&&a<=Pt.MAXARG_Bx),vl(t,Pt.CREATE_ABx(e,n,a))},kl=function(t,e,n,a){return Ol(t,e,n,a+Pt.MAXARG_sBx)},ml=function(t,e){return Qu(e<=Pt.MAXARG_Ax),vl(t,Pt.CREATE_Ax($u.OP_EXTRAARG,e))},El=function(t,e,n){if(n<=Pt.MAXARG_Bx)return Ol(t,$u.OP_LOADK,e,n);{let a=Ol(t,$u.OP_LOADKX,e,0);return ml(t,n),a}},Ul=function(t,e){let n=t.freereg+e;n>t.f.maxstacksize&&(n>=255&&Su.luaX_syntaxerror(t.ls,Zu("function or expression needs too many registers",!0)),t.f.maxstacksize=n)},Rl=function(t,e){Ul(t,e),t.freereg+=e},Nl=function(t,e){!Pt.ISK(e)&&e>=t.nactvar&&(t.freereg--,Qu(e===t.freereg))},yl=function(t,e){e.k===$i.expkind.VNONRELOC&&Nl(t,e.u.info)},wl=function(t,e,n){let a=e.k===$i.expkind.VNONRELOC?e.u.info:-1,r=n.k===$i.expkind.VNONRELOC?n.u.info:-1;a>r?(Nl(t,a),Nl(t,r)):(Nl(t,r),Nl(t,a))},Sl=function(t,e,n){let a=t.f,r=Rt.luaH_get(t.L,t.ls.h,e);if(r.ttisinteger()){let e=r.value;if(e<t.nk&&a.k[e].ttype()===n.ttype()&&a.k[e].value===n.value)return e}let u=t.nk;return Rt.luaH_setfrom(t.L,t.ls.h,e,new Sr.TValue(Yu,u)),a.k[u]=n,t.nk++,u},Il=function(t,e){let n=new tl(Xu,e),a=new tl(Yu,e);return Sl(t,n,a)},Ml=function(t,e){let n=new tl(qu,e);return Sl(t,n,n)},Pl=function(t,e){let n=new tl(Hu,e);return Sl(t,n,n)},xl=function(t,e,n){let a=$i.expkind;if(e.k===a.VCALL)Pt.SETARG_C(ll(t,e),n+1);else if(e.k===a.VVARARG){let a=ll(t,e);Pt.SETARG_B(a,n+1),Pt.SETARG_A(a,t.freereg),Rl(t,1)}else Qu(n===Iu)},Cl=function(t,e){let n=$i.expkind;e.k===n.VCALL?(Qu(2===ll(t,e).C),e.k=n.VNONRELOC,e.u.info=ll(t,e).A):e.k===n.VVARARG&&(Pt.SETARG_B(ll(t,e),2),e.k=n.VRELOCABLE)},Dl=function(t,e){let n=$i.expkind;switch(e.k){case n.VLOCAL:e.k=n.VNONRELOC;break;case n.VUPVAL:e.u.info=bl(t,$u.OP_GETUPVAL,0,e.u.info,0),e.k=n.VRELOCABLE;break;case n.VINDEXED:{let a;Nl(t,e.u.ind.idx),e.u.ind.vt===n.VLOCAL?(Nl(t,e.u.ind.t),a=$u.OP_GETTABLE):(Qu(e.u.ind.vt===n.VUPVAL),a=$u.OP_GETTABUP),e.u.info=bl(t,a,0,e.u.ind.t,e.u.ind.idx),e.k=n.VRELOCABLE;break}case n.VVARARG:case n.VCALL:Cl(t,e)}},Bl=function(t,e,n,a){return _l(t),bl(t,$u.OP_LOADBOOL,e,n,a)},Vl=function(t,e,n){let a=$i.expkind;switch(Dl(t,e),e.k){case a.VNIL:ul(t,n,1);break;case a.VFALSE:case a.VTRUE:bl(t,$u.OP_LOADBOOL,n,e.k===a.VTRUE,0);break;case a.VK:El(t,n,e.u.info);break;case a.VKFLT:El(t,n,Ml(t,e.u.nval));break;case a.VKINT:El(t,n,Il(t,e.u.ival));break;case a.VRELOCABLE:{let a=ll(t,e);Pt.SETARG_A(a,n);break}case a.VNONRELOC:n!==e.u.info&&bl(t,$u.OP_MOVE,n,e.u.info,0);break;default:return void Qu(e.k===a.VJMP)}e.u.info=n,e.k=a.VNONRELOC},Gl=function(t,e){e.k!==$i.expkind.VNONRELOC&&(Rl(t,1),Vl(t,e,t.freereg-1))},Kl=function(t,e){for(;-1!==e;e=sl(t,e)){if(hl(t,e).opcode!==$u.OP_TESTSET)return!0}return!1},Fl=function(t,e,n){let a=$i.expkind;if(Vl(t,e,n),e.k===a.VJMP&&(e.t=il(t,e.t,e.u.info)),al(e)){let r,u=-1,l=-1;if(Kl(t,e.t)||Kl(t,e.f)){let r=e.k===a.VJMP?-1:cl(t);u=Bl(t,n,0,1),l=Bl(t,n,1,0),Al(t,r)}r=_l(t),gl(t,e.f,r,n,u),gl(t,e.t,r,n,l)}e.f=e.t=-1,e.u.info=n,e.k=a.VNONRELOC},jl=function(t,e){Dl(t,e),yl(t,e),Rl(t,1),Fl(t,e,t.freereg-1)},Hl=function(t,e){if(Dl(t,e),e.k===$i.expkind.VNONRELOC){if(!al(e))return e.u.info;if(e.u.info>=t.nactvar)return Fl(t,e,e.u.info),e.u.info}return jl(t,e),e.u.info},Xl=function(t,e){al(e)?Hl(t,e):Dl(t,e)},zl=function(t,e){let n=$i.expkind,a=!1;switch(Xl(t,e),e.k){case n.VTRUE:e.u.info=Pl(t,!0),a=!0;break;case n.VFALSE:e.u.info=Pl(t,!1),a=!0;break;case n.VNIL:e.u.info=function(t){let e=new tl(Ju,null),n=new tl(Wu,t.ls.h);return Sl(t,n,e)}(t),a=!0;break;case n.VKINT:e.u.info=Il(t,e.u.ival),a=!0;break;case n.VKFLT:e.u.info=Ml(t,e.u.nval),a=!0;break;case n.VK:a=!0}return a&&(e.k=n.VK,e.u.info<=Pt.MAXINDEXRK)?Pt.RKASK(e.u.info):Hl(t,e)},Jl=function(t,e){let n=hl(t,e.u.info);Qu(Pt.testTMode(n.opcode)&&n.opcode!==$u.OP_TESTSET&&n.opcode!==$u.OP_TEST),Pt.SETARG_A(n,!n.A)},ql=function(t,e,n){if(e.k===$i.expkind.VRELOCABLE){let a=ll(t,e);if(a.opcode===$u.OP_NOT)return t.pc--,fl(t,$u.OP_TEST,a.B,0,!n)}return Gl(t,e),yl(t,e),fl(t,$u.OP_TESTSET,Pt.NO_REG,e.u.info,n)},Yl=function(t,e){let n,a=$i.expkind;switch(Dl(t,e),e.k){case a.VJMP:Jl(t,e),n=e.u.info;break;case a.VK:case a.VKFLT:case a.VKINT:case a.VTRUE:n=-1;break;default:n=ql(t,e,0)}e.f=il(t,e.f,n),Al(t,e.t),e.t=-1},Wl=function(t,e){let n,a=$i.expkind;switch(Dl(t,e),e.k){case a.VJMP:n=e.u.info;break;case a.VNIL:case a.VFALSE:n=-1;break;default:n=ql(t,e,1)}e.t=il(t,e.t,n),Al(t,e.f),e.f=-1},Zl=function(t,e,n){let a,r,u=$i.expkind;if(!(a=rl(e,!0))||!(r=rl(n,!0))||!function(t,e,n){switch(t){case Pu:case Cu:case Du:case Ku:case Fu:case xu:return!1!==In.tointeger(e)&&!1!==In.tointeger(n);case Bu:case Vu:case Gu:return 0!==n.value;default:return 1}}(t,a,r))return 0;let l=new tl;if(Sr.luaO_arith(null,t,a,r,l),l.ttisinteger())e.k=u.VKINT,e.u.ival=l.value;else{let t=l.value;if(isNaN(t)||0===t)return!1;e.k=u.VKFLT,e.u.nval=t}return!0},Ql=function(t,e,n,a,r){let u=zl(t,a),l=zl(t,n);wl(t,n,a),n.u.info=bl(t,e,0,l,u),n.k=$i.expkind.VRELOCABLE,$l(t,r)},$l=function(t,e){t.f.lineinfo[t.pc-1]=e};var ts={BinOpr:el,NO_JUMP:-1,UnOpr:nl,getinstruction:ll,luaK_checkstack:Ul,luaK_code:vl,luaK_codeABC:bl,luaK_codeABx:Ol,luaK_codeAsBx:kl,luaK_codek:El,luaK_concat:il,luaK_dischargevars:Dl,luaK_exp2RK:zl,luaK_exp2anyreg:Hl,luaK_exp2anyregup:function(t,e){(e.k!==$i.expkind.VUPVAL||al(e))&&Hl(t,e)},luaK_exp2nextreg:jl,luaK_exp2val:Xl,luaK_fixline:$l,luaK_getlabel:_l,luaK_goiffalse:Wl,luaK_goiftrue:Yl,luaK_indexed:function(t,e,n){let a=$i.expkind;Qu(!al(e)&&($i.vkisinreg(e.k)||e.k===a.VUPVAL)),e.u.ind.t=e.u.info,e.u.ind.idx=zl(t,n),e.u.ind.vt=e.k===a.VUPVAL?a.VUPVAL:a.VLOCAL,e.k=a.VINDEXED},luaK_infix:function(t,e,n){switch(e){case el.OPR_AND:Yl(t,n);break;case el.OPR_OR:Wl(t,n);break;case el.OPR_CONCAT:jl(t,n);break;case el.OPR_ADD:case el.OPR_SUB:case el.OPR_MUL:case el.OPR_DIV:case el.OPR_IDIV:case el.OPR_MOD:case el.OPR_POW:case el.OPR_BAND:case el.OPR_BOR:case el.OPR_BXOR:case el.OPR_SHL:case el.OPR_SHR:rl(n,!1)||zl(t,n);break;default:zl(t,n)}},luaK_intK:Il,luaK_jump:cl,luaK_jumpto:function(t,e){return Tl(t,cl(t),e)},luaK_nil:ul,luaK_numberK:Ml,luaK_patchclose:function(t,e,n){for(n++;-1!==e;e=sl(t,e)){let a=t.f.code[e];Qu(a.opcode===$u.OP_JMP&&(0===a.A||a.A>=n)),Pt.SETARG_A(a,n)}},luaK_patchlist:Tl,luaK_patchtohere:Al,luaK_posfix:function(t,e,n,a,r){let u=$i.expkind;switch(e){case el.OPR_AND:Qu(-1===n.t),Dl(t,a),a.f=il(t,a.f,n.f),n.to(a);break;case el.OPR_OR:Qu(-1===n.f),Dl(t,a),a.t=il(t,a.t,n.t),n.to(a);break;case el.OPR_CONCAT:{Xl(t,a);let e=ll(t,a);a.k===u.VRELOCABLE&&e.opcode===$u.OP_CONCAT?(Qu(n.u.info===e.B-1),yl(t,n),Pt.SETARG_B(e,n.u.info),n.k=u.VRELOCABLE,n.u.info=a.u.info):(jl(t,a),Ql(t,$u.OP_CONCAT,n,a,r));break}case el.OPR_ADD:case el.OPR_SUB:case el.OPR_MUL:case el.OPR_DIV:case el.OPR_IDIV:case el.OPR_MOD:case el.OPR_POW:case el.OPR_BAND:case el.OPR_BOR:case el.OPR_BXOR:case el.OPR_SHL:case el.OPR_SHR:Zl(e+Mu,n,a)||Ql(t,e+$u.OP_ADD,n,a,r);break;case el.OPR_EQ:case el.OPR_LT:case el.OPR_LE:case el.OPR_NE:case el.OPR_GT:case el.OPR_GE:!function(t,e,n,a){let r,u=$i.expkind;n.k===u.VK?r=Pt.RKASK(n.u.info):(Qu(n.k===u.VNONRELOC),r=n.u.info);let l=zl(t,a);switch(wl(t,n,a),e){case el.OPR_NE:n.u.info=fl(t,$u.OP_EQ,0,r,l);break;case el.OPR_GT:case el.OPR_GE:{let a=e-el.OPR_NE+$u.OP_EQ;n.u.info=fl(t,a,1,l,r);break}default:{let a=e-el.OPR_EQ+$u.OP_EQ;n.u.info=fl(t,a,1,r,l);break}}n.k=u.VJMP}(t,e,n,a)}return n},luaK_prefix:function(t,e,n,a){let r=new $i.expdesc;switch(r.k=$i.expkind.VKINT,r.u.ival=r.u.nval=r.u.info=0,r.t=-1,r.f=-1,e){case nl.OPR_MINUS:case nl.OPR_BNOT:if(Zl(e+ju,n,r))break;case nl.OPR_LEN:!function(t,e,n,a){let r=Hl(t,n);yl(t,n),n.u.info=bl(t,e,0,r,0),n.k=$i.expkind.VRELOCABLE,$l(t,a)}(t,e+$u.OP_UNM,n,a);break;case nl.OPR_NOT:!function(t,e){let n=$i.expkind;switch(Dl(t,e),e.k){case n.VNIL:case n.VFALSE:e.k=n.VTRUE;break;case n.VK:case n.VKFLT:case n.VKINT:case n.VTRUE:e.k=n.VFALSE;break;case n.VJMP:Jl(t,e);break;case n.VRELOCABLE:case n.VNONRELOC:Gl(t,e),yl(t,e),e.u.info=bl(t,$u.OP_NOT,0,e.u.info,0),e.k=n.VRELOCABLE}{let t=e.f;e.f=e.t,e.t=t}Ll(t,e.f),Ll(t,e.t)}(t,n)}},luaK_reserveregs:Rl,luaK_ret:function(t,e,n){bl(t,$u.OP_RETURN,e,n+1,0)},luaK_self:function(t,e,n){Hl(t,e);let a=e.u.info;yl(t,e),e.u.info=t.freereg,e.k=$i.expkind.VNONRELOC,Rl(t,2),bl(t,$u.OP_SELF,e.u.info,a,zl(t,n)),yl(t,n)},luaK_setlist:function(t,e,n,a){let r=(n-1)/Pt.LFIELDS_PER_FLUSH+1,u=a===Iu?0:a;Qu(0!==a&&a<=Pt.LFIELDS_PER_FLUSH),r<=Pt.MAXARG_C?bl(t,$u.OP_SETLIST,e,u,r):r<=Pt.MAXARG_Ax?(bl(t,$u.OP_SETLIST,e,u,0),ml(t,r)):Su.luaX_syntaxerror(t.ls,Zu("constructor too long",!0)),t.freereg=e+1},luaK_setmultret:function(t,e){xl(t,e,Iu)},luaK_setoneret:Cl,luaK_setreturns:xl,luaK_storevar:function(t,e,n){let a=$i.expkind;switch(e.k){case a.VLOCAL:return yl(t,n),void Fl(t,n,e.u.info);case a.VUPVAL:{let a=Hl(t,n);bl(t,$u.OP_SETUPVAL,a,e.u.info,0);break}case a.VINDEXED:{let r=e.u.ind.vt===a.VLOCAL?$u.OP_SETTABLE:$u.OP_SETTABUP,u=zl(t,n);bl(t,r,e.u.ind.t,e.u.ind.idx,u);break}}yl(t,n)},luaK_stringK:function(t,e){let n=new tl(zu,e);return Sl(t,n,n)}};const{LUA_MULTRET:es,to_luastring:ns}=V,{BinOpr:{OPR_ADD:as,OPR_AND:rs,OPR_BAND:us,OPR_BOR:ls,OPR_BXOR:ss,OPR_CONCAT:os,OPR_DIV:is,OPR_EQ:cs,OPR_GE:fs,OPR_GT:_s,OPR_IDIV:ps,OPR_LE:hs,OPR_LT:ds,OPR_MOD:Ls,OPR_MUL:gs,OPR_NE:As,OPR_NOBINOPR:Ts,OPR_OR:vs,OPR_POW:bs,OPR_SHL:Os,OPR_SHR:ks,OPR_SUB:ms},UnOpr:{OPR_BNOT:Es,OPR_LEN:Us,OPR_MINUS:Rs,OPR_NOT:Ns,OPR_NOUNOPR:ys},NO_JUMP:ws,getinstruction:Ss,luaK_checkstack:Is,luaK_codeABC:Ms,luaK_codeABx:Ps,luaK_codeAsBx:xs,luaK_codek:Cs,luaK_concat:Ds,luaK_dischargevars:Bs,luaK_exp2RK:Vs,luaK_exp2anyreg:Gs,luaK_exp2anyregup:Ks,luaK_exp2nextreg:Fs,luaK_exp2val:js,luaK_fixline:Hs,luaK_getlabel:Xs,luaK_goiffalse:zs,luaK_goiftrue:Js,luaK_indexed:qs,luaK_infix:Ys,luaK_intK:Ws,luaK_jump:Zs,luaK_jumpto:Qs,luaK_nil:$s,luaK_patchclose:to,luaK_patchlist:eo,luaK_patchtohere:no,luaK_posfix:ao,luaK_prefix:ro,luaK_reserveregs:uo,luaK_ret:lo,luaK_self:so,luaK_setlist:oo,luaK_setmultret:io,luaK_setoneret:co,luaK_setreturns:fo,luaK_storevar:_o,luaK_stringK:po}=ts,{LUAI_MAXCCALLS:ho,MAX_INT:Lo,lua_assert:go}=j,{OpCodesI:{OP_CALL:Ao,OP_CLOSURE:To,OP_FORLOOP:vo,OP_FORPREP:bo,OP_GETUPVAL:Oo,OP_MOVE:ko,OP_NEWTABLE:mo,OP_SETTABLE:Eo,OP_TAILCALL:Uo,OP_TFORCALL:Ro,OP_TFORLOOP:No,OP_VARARG:yo},LFIELDS_PER_FLUSH:wo,SETARG_B:So,SETARG_C:Io,SET_OPCODE:Mo}=Pt,{luaS_eqlngstr:Po,luaS_new:xo,luaS_newliteral:Co}=et,Do=Mr.Proto,Bo=Su.RESERVED,Vo=function(t){return t===Fo.VCALL||t===Fo.VVARARG},Go=function(t,e){return Po(t,e)};class Ko{constructor(){this.previous=null,this.firstlabel=NaN,this.firstgoto=NaN,this.nactvar=NaN,this.upval=NaN,this.isloop=NaN}}const Fo={VVOID:0,VNIL:1,VTRUE:2,VFALSE:3,VK:4,VKFLT:5,VKINT:6,VNONRELOC:7,VLOCAL:8,VUPVAL:9,VINDEXED:10,VJMP:11,VRELOCABLE:12,VCALL:13,VVARARG:14};class jo{constructor(){this.k=NaN,this.u={ival:NaN,nval:NaN,info:NaN,ind:{idx:NaN,t:NaN,vt:NaN}},this.t=NaN,this.f=NaN}to(t){this.k=t.k,this.u=t.u,this.t=t.t,this.f=t.f}}class Ho{constructor(){this.f=null,this.prev=null,this.ls=null,this.bl=null,this.pc=NaN,this.lasttarget=NaN,this.jpc=NaN,this.nk=NaN,this.np=NaN,this.firstlocal=NaN,this.nlocvars=NaN,this.nactvar=NaN,this.nups=NaN,this.freereg=NaN}}class Xo{constructor(){this.idx=NaN}}class zo{constructor(){this.name=null,this.pc=NaN,this.line=NaN,this.nactvar=NaN}}class Jo{constructor(){this.arr=[],this.n=NaN,this.size=NaN}}const qo=function(t,e){t.t.token=0,Su.luaX_syntaxerror(t,e)},Yo=function(t,e){Su.luaX_syntaxerror(t,Sr.luaO_pushfstring(t.L,ns("%s expected",!0),Su.luaX_token2str(t,e)))},Wo=function(t,e,n,a){e>n&&function(t,e,n){let a=t.ls.L,r=t.f.linedefined,u=0===r?ns("main function",!0):Sr.luaO_pushfstring(a,ns("function at line %d",!0),r),l=Sr.luaO_pushfstring(a,ns("too many %s (limit is %d) in %s",!0),n,e,u);Su.luaX_syntaxerror(t.ls,l)}(t,n,a)},Zo=function(t,e){return t.t.token===e&&(Su.luaX_next(t),!0)},Qo=function(t,e){t.t.token!==e&&Yo(t,e)},$o=function(t,e){Qo(t,e),Su.luaX_next(t)},ti=function(t,e,n){e||Su.luaX_syntaxerror(t,n)},ei=function(t,e,n,a){Zo(t,e)||(a===t.linenumber?Yo(t,e):Su.luaX_syntaxerror(t,Sr.luaO_pushfstring(t.L,ns("%s expected (to close %s at line %d)"),Su.luaX_token2str(t,e),Su.luaX_token2str(t,n),a)))},ni=function(t){Qo(t,Bo.TK_NAME);let e=t.t.seminfo.ts;return Su.luaX_next(t),e},ai=function(t,e,n){t.f=t.t=ws,t.k=e,t.u.info=n},ri=function(t,e,n){ai(e,Fo.VK,po(t.fs,n))},ui=function(t,e){ri(t,e,ni(t))},li=function(t,e){let n=t.fs,a=t.dyd,r=function(t,e){let n=t.fs,a=n.f;return a.locvars[n.nlocvars]=new Sr.LocVar,a.locvars[n.nlocvars].varname=e,n.nlocvars++}(t,e);Wo(n,a.actvar.n+1-n.firstlocal,200,ns("local variables",!0)),a.actvar.arr[a.actvar.n]=new Xo,a.actvar.arr[a.actvar.n].idx=r,a.actvar.n++},si=function(t,e){li(t,Su.luaX_newstring(t,ns(e,!0)))},oi=function(t,e){let n=t.ls.dyd.actvar.arr[t.firstlocal+e].idx;return go(n<t.nlocvars),t.f.locvars[n]},ii=function(t,e){let n=t.fs;for(n.nactvar=n.nactvar+e;e;e--)oi(n,n.nactvar-e).startpc=n.pc},ci=function(t,e,n){let a=t.f;return Wo(t,t.nups+1,Mr.MAXUPVAL,ns("upvalues",!0)),a.upvalues[t.nups]={instack:n.k===Fo.VLOCAL,idx:n.u.info,name:e},t.nups++},fi=function(t,e,n,a){if(null===t)ai(n,Fo.VVOID,0);else{let r=function(t,e){for(let n=t.nactvar-1;n>=0;n--)if(Go(e,oi(t,n).varname))return n;return-1}(t,e);if(r>=0)ai(n,Fo.VLOCAL,r),a||function(t,e){let n=t.bl;for(;n.nactvar>e;)n=n.previous;n.upval=1}(t,r);else{let a=function(t,e){let n=t.f.upvalues;for(let a=0;a<t.nups;a++)if(Go(n[a].name,e))return a;return-1}(t,e);if(a<0){if(fi(t.prev,e,n,0),n.k===Fo.VVOID)return;a=ci(t,e,n)}ai(n,Fo.VUPVAL,a)}}},_i=function(t,e){let n=ni(t),a=t.fs;if(fi(a,n,e,1),e.k===Fo.VVOID){let r=new jo;fi(a,t.envn,e,1),go(e.k!==Fo.VVOID),ri(t,r,n),qs(a,e,r)}},pi=function(t,e,n,a){let r=t.fs,u=e-n;if(Vo(a.k))u++,u<0&&(u=0),fo(r,a,u),u>1&&uo(r,u-1);else if(a.k!==Fo.VVOID&&Fs(r,a),u>0){let t=r.freereg;uo(r,u),$s(r,t,u)}n>e&&(t.fs.freereg-=n-e)},hi=function(t){let e=t.L;++e.nCcalls,Wo(t.fs,e.nCcalls,ho,ns("JS levels",!0))},di=function(t){return t.L.nCcalls--},Li=function(t,e,n){let a=t.fs,r=t.dyd.gt,u=r.arr[e];if(go(Go(u.name,n.name)),u.nactvar<n.nactvar){let e=oi(a,u.nactvar).varname,n=Sr.luaO_pushfstring(t.L,ns("<goto %s> at line %d jumps into the scope of local '%s'"),u.name.getstr(),u.line,e.getstr());qo(t,n)}eo(a,u.pc,n.pc);for(let t=e;t<r.n-1;t++)r.arr[t]=r.arr[t+1];r.n--},gi=function(t,e){let n=t.fs.bl,a=t.dyd,r=a.gt.arr[e];for(let u=n.firstlabel;u<a.label.n;u++){let l=a.label.arr[u];if(Go(l.name,r.name))return r.nactvar>l.nactvar&&(n.upval||a.label.n>n.firstlabel)&&to(t.fs,r.pc,l.nactvar),Li(t,e,l),!0}return!1},Ai=function(t,e,n,a,r){let u=e.n;return e.arr[u]=new zo,e.arr[u].name=n,e.arr[u].line=a,e.arr[u].nactvar=t.fs.nactvar,e.arr[u].pc=r,e.n=u+1,u},Ti=function(t,e){let n=t.dyd.gt,a=t.fs.bl.firstgoto;for(;a<n.n;)Go(n.arr[a].name,e.name)?Li(t,a,e):a++},vi=function(t,e,n){e.isloop=n,e.nactvar=t.nactvar,e.firstlabel=t.ls.dyd.label.n,e.firstgoto=t.ls.dyd.gt.n,e.upval=0,e.previous=t.bl,t.bl=e,go(t.freereg===t.nactvar)},bi=function(t,e,n){e.prev=t.fs,e.ls=t,t.fs=e,e.pc=0,e.lasttarget=0,e.jpc=ws,e.freereg=0,e.nk=0,e.np=0,e.nups=0,e.nlocvars=0,e.nactvar=0,e.firstlocal=t.dyd.actvar.n,e.bl=null;let a=e.f;a.source=t.source,a.maxstacksize=2,vi(e,n,!1)},Oi=function(t){let e=t.bl,n=t.ls;if(e.previous&&e.upval){let n=Zs(t);to(t,n,e.nactvar),no(t,n)}e.isloop&&function(t){let e=Co(t.L,"break"),n=Ai(t,t.dyd.label,e,0,t.fs.pc);Ti(t,t.dyd.label.arr[n])}(n),t.bl=e.previous,function(t,e){for(t.ls.dyd.actvar.n-=t.nactvar-e;t.nactvar>e;)oi(t,--t.nactvar).endpc=t.pc}(t,e.nactvar),go(e.nactvar===t.nactvar),t.freereg=t.nactvar,n.dyd.label.n=e.firstlabel,e.previous?function(t,e){let n=e.firstgoto,a=t.ls.dyd.gt;for(;n<a.n;){let r=a.arr[n];r.nactvar>e.nactvar&&(e.upval&&to(t,r.pc,e.nactvar),r.nactvar=e.nactvar),gi(t.ls,n)||n++}}(t,e):e.firstgoto<n.dyd.gt.n&&function(t,e){let n=Su.isreserved(e.name)?"<%s> at line %d not inside a loop":"no visible label '%s' for <goto> at line %d";n=Sr.luaO_pushfstring(t.L,ns(n),e.name.getstr(),e.line),qo(t,n)}(n,n.dyd.gt.arr[e.firstgoto])},ki=function(t){let e=t.fs;lo(e,0,0),Oi(e),go(null===e.bl),t.fs=e.prev},mi=function(t,e){switch(t.t.token){case Bo.TK_ELSE:case Bo.TK_ELSEIF:case Bo.TK_END:case Bo.TK_EOS:return!0;case Bo.TK_UNTIL:return e;default:return!1}},Ei=function(t){for(;!mi(t,1);){if(t.t.token===Bo.TK_RETURN)return void Qi(t);Qi(t)}},Ui=function(t,e){let n=t.fs,a=new jo;Ks(n,e),Su.luaX_next(t),ui(t,a),qs(n,e,a)},Ri=function(t,e){Su.luaX_next(t),Gi(t,e),js(t.fs,e),$o(t,93)};class Ni{constructor(){this.v=new jo,this.t=new jo,this.nh=NaN,this.na=NaN,this.tostore=NaN}}const yi=function(t,e){let n=t.fs,a=t.fs.freereg,r=new jo,u=new jo;t.t.token===Bo.TK_NAME?(Wo(n,e.nh,Lo,ns("items in a constructor",!0)),ui(t,r)):Ri(t,r),e.nh++,$o(t,61);let l=Vs(n,r);Gi(t,u),Ms(n,Eo,e.t.u.info,l,Vs(n,u)),n.freereg=a},wi=function(t,e){e.v.k!==Fo.VVOID&&(Fs(t,e.v),e.v.k=Fo.VVOID,e.tostore===wo&&(oo(t,e.t.u.info,e.na,e.tostore),e.tostore=0))},Si=function(t,e){Gi(t,e.v),Wo(t.fs,e.na,Lo,ns("items in a constructor",!0)),e.na++,e.tostore++},Ii=function(t,e){switch(t.t.token){case Bo.TK_NAME:61!==Su.luaX_lookahead(t)?Si(t,e):yi(t,e);break;case 91:yi(t,e);break;default:Si(t,e)}},Mi=function(t,e){let n=t.fs,a=t.linenumber,r=Ms(n,mo,0,0,0),u=new Ni;u.na=u.nh=u.tostore=0,u.t=e,ai(e,Fo.VRELOCABLE,r),ai(u.v,Fo.VVOID,0),Fs(t.fs,e),$o(t,123);do{if(go(u.v.k===Fo.VVOID||u.tostore>0),125===t.t.token)break;wi(n,u),Ii(t,u)}while(Zo(t,44)||Zo(t,59));ei(t,125,123,a),function(t,e){0!==e.tostore&&(Vo(e.v.k)?(io(t,e.v),oo(t,e.t.u.info,e.na,es),e.na--):(e.v.k!==Fo.VVOID&&Fs(t,e.v),oo(t,e.t.u.info,e.na,e.tostore)))}(n,u),So(n.f.code[r],Sr.luaO_int2fb(u.na)),Io(n.f.code[r],Sr.luaO_int2fb(u.nh))},Pi=function(t,e,n,a){let r=new Ho,u=new Ko;r.f=function(t){let e=t.L,n=new Do(e),a=t.fs;return a.f.p[a.np++]=n,n}(t),r.f.linedefined=a,bi(t,r,u),$o(t,40),n&&(si(t,"self"),ii(t,1)),function(t){let e=t.fs,n=e.f,a=0;if(n.is_vararg=!1,41!==t.t.token)do{switch(t.t.token){case Bo.TK_NAME:li(t,ni(t)),a++;break;case Bo.TK_DOTS:Su.luaX_next(t),n.is_vararg=!0;break;default:Su.luaX_syntaxerror(t,ns("<name> or '...' expected",!0))}}while(!n.is_vararg&&Zo(t,44));ii(t,a),n.numparams=e.nactvar,uo(e,e.nactvar)}(t),$o(t,41),Ei(t),r.f.lastlinedefined=t.linenumber,ei(t,Bo.TK_END,Bo.TK_FUNCTION,a),function(t,e){let n=t.fs.prev;ai(e,Fo.VRELOCABLE,Ps(n,To,0,n.np-1)),Fs(n,e)}(t,e),ki(t)},xi=function(t,e){let n=1;for(Gi(t,e);Zo(t,44);)Fs(t.fs,e),Gi(t,e),n++;return n},Ci=function(t,e,n){let a,r=t.fs,u=new jo;switch(t.t.token){case 40:Su.luaX_next(t),41===t.t.token?u.k=Fo.VVOID:(xi(t,u),io(r,u)),ei(t,41,40,n);break;case 123:Mi(t,u);break;case Bo.TK_STRING:ri(t,u,t.t.seminfo.ts),Su.luaX_next(t);break;default:Su.luaX_syntaxerror(t,ns("function arguments expected",!0))}go(e.k===Fo.VNONRELOC);let l=e.u.info;Vo(u.k)?a=es:(u.k!==Fo.VVOID&&Fs(r,u),a=r.freereg-(l+1)),ai(e,Fo.VCALL,Ms(r,Ao,l,a+1,2)),Hs(r,n),r.freereg=l+1},Di=function(t,e){let n=t.fs,a=t.linenumber;for(!function(t,e){switch(t.t.token){case 40:{let n=t.linenumber;return Su.luaX_next(t),Gi(t,e),ei(t,41,40,n),void Bs(t.fs,e)}case Bo.TK_NAME:return void _i(t,e);default:Su.luaX_syntaxerror(t,ns("unexpected symbol",!0))}}(t,e);;)switch(t.t.token){case 46:Ui(t,e);break;case 91:{let a=new jo;Ks(n,e),Ri(t,a),qs(n,e,a);break}case 58:{let r=new jo;Su.luaX_next(t),ui(t,r),so(n,e,r),Ci(t,e,a);break}case 40:case Bo.TK_STRING:case 123:Fs(n,e),Ci(t,e,a);break;default:return}},Bi=[{left:10,right:10},{left:10,right:10},{left:11,right:11},{left:11,right:11},{left:14,right:13},{left:11,right:11},{left:11,right:11},{left:6,right:6},{left:4,right:4},{left:5,right:5},{left:7,right:7},{left:7,right:7},{left:9,right:8},{left:3,right:3},{left:3,right:3},{left:3,right:3},{left:3,right:3},{left:3,right:3},{left:3,right:3},{left:2,right:2},{left:1,right:1}],Vi=function(t,e,n){hi(t);let a=function(t){switch(t){case Bo.TK_NOT:return Ns;case 45:return Rs;case 126:return Es;case 35:return Us;default:return ys}}(t.t.token);if(a!==ys){let n=t.linenumber;Su.luaX_next(t),Vi(t,e,12),ro(t.fs,a,e,n)}else!function(t,e){switch(t.t.token){case Bo.TK_FLT:ai(e,Fo.VKFLT,0),e.u.nval=t.t.seminfo.r;break;case Bo.TK_INT:ai(e,Fo.VKINT,0),e.u.ival=t.t.seminfo.i;break;case Bo.TK_STRING:ri(t,e,t.t.seminfo.ts);break;case Bo.TK_NIL:ai(e,Fo.VNIL,0);break;case Bo.TK_TRUE:ai(e,Fo.VTRUE,0);break;case Bo.TK_FALSE:ai(e,Fo.VFALSE,0);break;case Bo.TK_DOTS:{let n=t.fs;ti(t,n.f.is_vararg,ns("cannot use '...' outside a vararg function",!0)),ai(e,Fo.VVARARG,Ms(n,yo,0,1,0));break}case 123:return void Mi(t,e);case Bo.TK_FUNCTION:return Su.luaX_next(t),void Pi(t,e,0,t.linenumber);default:return void Di(t,e)}Su.luaX_next(t)}(t,e);let r=function(t){switch(t){case 43:return as;case 45:return ms;case 42:return gs;case 37:return Ls;case 94:return bs;case 47:return is;case Bo.TK_IDIV:return ps;case 38:return us;case 124:return ls;case 126:return ss;case Bo.TK_SHL:return Os;case Bo.TK_SHR:return ks;case Bo.TK_CONCAT:return os;case Bo.TK_NE:return As;case Bo.TK_EQ:return cs;case 60:return ds;case Bo.TK_LE:return hs;case 62:return _s;case Bo.TK_GE:return fs;case Bo.TK_AND:return rs;case Bo.TK_OR:return vs;default:return Ts}}(t.t.token);for(;r!==Ts&&Bi[r].left>n;){let n=new jo,a=t.linenumber;Su.luaX_next(t),Ys(t.fs,r,e);let u=Vi(t,n,Bi[r].right);ao(t.fs,r,e,n,a),r=u}return di(t),r},Gi=function(t,e){Vi(t,e,0)},Ki=function(t){let e=t.fs,n=new Ko;vi(e,n,0),Ei(t),Oi(e)};class Fi{constructor(){this.prev=null,this.v=new jo}}const ji=function(t,e,n){let a=new jo;var r;if(ti(t,(r=e.v.k,Fo.VLOCAL<=r&&r<=Fo.VINDEXED),ns("syntax error",!0)),Zo(t,44)){let a=new Fi;a.prev=e,Di(t,a.v),a.v.k!==Fo.VINDEXED&&function(t,e,n){let a=t.fs,r=a.freereg,u=!1;for(;e;e=e.prev)e.v.k===Fo.VINDEXED&&(e.v.u.ind.vt===n.k&&e.v.u.ind.t===n.u.info&&(u=!0,e.v.u.ind.vt=Fo.VLOCAL,e.v.u.ind.t=r),n.k===Fo.VLOCAL&&e.v.u.ind.idx===n.u.info&&(u=!0,e.v.u.ind.idx=r));if(u){let t=n.k===Fo.VLOCAL?ko:Oo;Ms(a,t,r,n.u.info,0),uo(a,1)}}(t,e,a.v),Wo(t.fs,n+t.L.nCcalls,ho,ns("JS levels",!0)),ji(t,a,n+1)}else{$o(t,61);let r=xi(t,a);if(r===n)return co(t.fs,a),void _o(t.fs,e.v,a);pi(t,n,r,a)}ai(a,Fo.VNONRELOC,t.fs.freereg-1),_o(t.fs,e.v,a)},Hi=function(t){let e=new jo;return Gi(t,e),e.k===Fo.VNIL&&(e.k=Fo.VFALSE),Js(t.fs,e),e.f},Xi=function(t,e){let n,a=t.linenumber;Zo(t,Bo.TK_GOTO)?n=ni(t):(Su.luaX_next(t),n=Co(t.L,"break"));let r=Ai(t,t.dyd.gt,n,a,e);gi(t,r)},zi=function(t,e,n){let a,r=t.fs,u=t.dyd.label;!function(t,e,n){for(let a=t.bl.firstlabel;a<e.n;a++)if(Go(n,e.arr[a].name)){let r=Sr.luaO_pushfstring(t.ls.L,ns("label '%s' already defined on line %d",!0),n.getstr(),e.arr[a].line);qo(t.ls,r)}}(r,u,e),$o(t,Bo.TK_DBCOLON),a=Ai(t,u,e,n,Xs(r)),function(t){for(;59===t.t.token||t.t.token===Bo.TK_DBCOLON;)Qi(t)}(t),mi(t,0)&&(u.arr[a].nactvar=r.bl.nactvar),Ti(t,u.arr[a])},Ji=function(t){let e=new jo;return Gi(t,e),Fs(t.fs,e),go(e.k===Fo.VNONRELOC),e.u.info},qi=function(t,e,n,a,r){let u,l=new Ko,s=t.fs;ii(t,3),$o(t,Bo.TK_DO);let o=r?xs(s,bo,e,ws):Zs(s);vi(s,l,0),ii(t,a),uo(s,a),Ki(t),Oi(s),no(s,o),r?u=xs(s,vo,e,ws):(Ms(s,Ro,e,0,a),Hs(s,n),u=xs(s,No,e+2,ws)),eo(s,u,o+1),Hs(s,n)},Yi=function(t,e){let n=t.fs,a=new Ko;vi(n,a,1),Su.luaX_next(t);let r=ni(t);switch(t.t.token){case 61:!function(t,e,n){let a=t.fs,r=a.freereg;si(t,"(for index)"),si(t,"(for limit)"),si(t,"(for step)"),li(t,e),$o(t,61),Ji(t),$o(t,44),Ji(t),Zo(t,44)?Ji(t):(Cs(a,a.freereg,Ws(a,1)),uo(a,1)),qi(t,r,n,1,1)}(t,r,e);break;case 44:case Bo.TK_IN:!function(t,e){let n=t.fs,a=new jo,r=4,u=n.freereg;for(si(t,"(for generator)"),si(t,"(for state)"),si(t,"(for control)"),li(t,e);Zo(t,44);)li(t,ni(t)),r++;$o(t,Bo.TK_IN);let l=t.linenumber;pi(t,3,xi(t,a),a),Is(n,3),qi(t,u,l,r-3,0)}(t,r);break;default:Su.luaX_syntaxerror(t,ns("'=' or 'in' expected",!0))}ei(t,Bo.TK_END,Bo.TK_FOR,e),Oi(n)},Wi=function(t,e){let n,a=new Ko,r=t.fs,u=new jo;if(Su.luaX_next(t),Gi(t,u),$o(t,Bo.TK_THEN),t.t.token===Bo.TK_GOTO||t.t.token===Bo.TK_BREAK){for(zs(t.fs,u),vi(r,a,!1),Xi(t,u.t);Zo(t,59););if(mi(t,0))return Oi(r),e;n=Zs(r)}else Js(t.fs,u),vi(r,a,!1),n=u.f;return Ei(t),Oi(r),t.t.token!==Bo.TK_ELSE&&t.t.token!==Bo.TK_ELSEIF||(e=Ds(r,e,Zs(r))),no(r,n),e},Zi=function(t,e){let n=new jo,a=new jo;Su.luaX_next(t);let r=function(t,e){let n=0;for(_i(t,e);46===t.t.token;)Ui(t,e);return 58===t.t.token&&(n=1,Ui(t,e)),n}(t,n);Pi(t,a,r,e),_o(t.fs,n,a),Hs(t.fs,e)},Qi=function(t){let e=t.linenumber;switch(hi(t),t.t.token){case 59:Su.luaX_next(t);break;case Bo.TK_IF:!function(t,e){let n=t.fs,a=ws;for(a=Wi(t,a);t.t.token===Bo.TK_ELSEIF;)a=Wi(t,a);Zo(t,Bo.TK_ELSE)&&Ki(t),ei(t,Bo.TK_END,Bo.TK_IF,e),no(n,a)}(t,e);break;case Bo.TK_WHILE:!function(t,e){let n=t.fs,a=new Ko;Su.luaX_next(t);let r=Xs(n),u=Hi(t);vi(n,a,1),$o(t,Bo.TK_DO),Ki(t),Qs(n,r),ei(t,Bo.TK_END,Bo.TK_WHILE,e),Oi(n),no(n,u)}(t,e);break;case Bo.TK_DO:Su.luaX_next(t),Ki(t),ei(t,Bo.TK_END,Bo.TK_DO,e);break;case Bo.TK_FOR:Yi(t,e);break;case Bo.TK_REPEAT:!function(t,e){let n=t.fs,a=Xs(n),r=new Ko,u=new Ko;vi(n,r,1),vi(n,u,0),Su.luaX_next(t),Ei(t),ei(t,Bo.TK_UNTIL,Bo.TK_REPEAT,e);let l=Hi(t);u.upval&&to(n,l,u.nactvar),Oi(n),eo(n,l,a),Oi(n)}(t,e);break;case Bo.TK_FUNCTION:Zi(t,e);break;case Bo.TK_LOCAL:Su.luaX_next(t),Zo(t,Bo.TK_FUNCTION)?function(t){let e=new jo,n=t.fs;li(t,ni(t)),ii(t,1),Pi(t,e,0,t.linenumber),oi(n,e.u.info).startpc=n.pc}(t):function(t){let e,n=0,a=new jo;do{li(t,ni(t)),n++}while(Zo(t,44));Zo(t,61)?e=xi(t,a):(a.k=Fo.VVOID,e=0),pi(t,n,e,a),ii(t,n)}(t);break;case Bo.TK_DBCOLON:Su.luaX_next(t),zi(t,ni(t),e);break;case Bo.TK_RETURN:Su.luaX_next(t),function(t){let e,n,a=t.fs,r=new jo;mi(t,1)||59===t.t.token?e=n=0:(n=xi(t,r),Vo(r.k)?(io(a,r),r.k===Fo.VCALL&&1===n&&(Mo(Ss(a,r),Uo),go(Ss(a,r).A===a.nactvar)),e=a.nactvar,n=es):1===n?e=Gs(a,r):(Fs(a,r),e=a.nactvar,go(n===a.freereg-e))),lo(a,e,n),Zo(t,59)}(t);break;case Bo.TK_BREAK:case Bo.TK_GOTO:Xi(t,Zs(t.fs));break;default:!function(t){let e=t.fs,n=new Fi;Di(t,n.v),61===t.t.token||44===t.t.token?(n.prev=null,ji(t,n,1)):(ti(t,n.v.k===Fo.VCALL,ns("syntax error",!0)),Io(Ss(e,n.v),1))}(t)}go(t.fs.f.maxstacksize>=t.fs.freereg&&t.fs.freereg>=t.fs.nactvar),t.fs.freereg=t.fs.nactvar,di(t)};var $i={Dyndata:class{constructor(){this.actvar={arr:[],n:NaN,size:NaN},this.gt=new Jo,this.label=new Jo}},expkind:Fo,expdesc:jo,luaY_parser:function(t,e,n,a,r,u){let l=new Su.LexState,s=new Ho,o=Mr.luaF_newLclosure(t,1);return Pf.luaD_inctop(t),t.stack[t.top-1].setclLvalue(o),l.h=Rt.luaH_new(t),Pf.luaD_inctop(t),t.stack[t.top-1].sethvalue(l.h),s.f=o.p=new Do(t),s.f.source=xo(t,r),l.buff=n,l.dyd=a,a.actvar.n=a.gt.n=a.label.n=0,Su.luaX_setinput(t,l,e,s.f.source,u),function(t,e){let n=new Ko,a=new jo;bi(t,e,n),e.f.is_vararg=!0,ai(a,Fo.VLOCAL,0),ci(e,t.envn,a),Su.luaX_next(t),Ei(t),Qo(t,Bo.TK_EOS),ki(t)}(l,s),go(!s.prev&&1===s.nups&&!l.fs),go(0===a.actvar.n&&0===a.gt.n&&0===a.label.n),delete t.stack[--t.top],o},vkisinreg:function(t){return t===Fo.VNONRELOC||t===Fo.VLOCAL}};const{LUA_SIGNATURE:tc,constant_types:{LUA_TBOOLEAN:ec,LUA_TLNGSTR:nc,LUA_TNIL:ac,LUA_TNUMFLT:rc,LUA_TNUMINT:uc,LUA_TSHRSTR:lc},thread_status:{LUA_ERRSYNTAX:sc},is_luastring:oc,luastring_eq:ic,to_luastring:cc}=V,{MAXARG_sBx:fc,POS_A:_c,POS_Ax:pc,POS_B:hc,POS_Bx:dc,POS_C:Lc,POS_OP:gc,SIZE_A:Ac,SIZE_Ax:Tc,SIZE_B:vc,SIZE_Bx:bc,SIZE_C:Oc,SIZE_OP:kc}=Pt,{lua_assert:mc}=j,{luaS_bless:Ec}=et,{luaZ_read:Uc,ZIO:Rc}=Cr;let Nc=[25,147,13,10,26,10];class yc{constructor(t,e,n){this.intSize=4,this.size_tSize=4,this.instructionSize=4,this.integerSize=4,this.numberSize=8,mc(e instanceof Rc,"BytecodeParser only operates on a ZIO"),mc(oc(n)),64===n[0]||61===n[0]?this.name=n.subarray(1):n[0]==tc[0]?this.name=cc("binary string",!0):this.name=n,this.L=t,this.Z=e,this.arraybuffer=new ArrayBuffer(Math.max(this.intSize,this.size_tSize,this.instructionSize,this.integerSize,this.numberSize)),this.dv=new DataView(this.arraybuffer),this.u8=new Uint8Array(this.arraybuffer)}read(t){let e=new Uint8Array(t);return 0!==Uc(this.Z,e,0,t)&&this.error("truncated"),e}LoadByte(){return 0!==Uc(this.Z,this.u8,0,1)&&this.error("truncated"),this.u8[0]}LoadInt(){return 0!==Uc(this.Z,this.u8,0,this.intSize)&&this.error("truncated"),this.dv.getInt32(0,!0)}LoadNumber(){return 0!==Uc(this.Z,this.u8,0,this.numberSize)&&this.error("truncated"),this.dv.getFloat64(0,!0)}LoadInteger(){return 0!==Uc(this.Z,this.u8,0,this.integerSize)&&this.error("truncated"),this.dv.getInt32(0,!0)}LoadSize_t(){return this.LoadInteger()}LoadString(){let t=this.LoadByte();return 255===t&&(t=this.LoadSize_t()),0===t?null:Ec(this.L,this.read(t-1))}static MASK1(t,e){return~(-1<<t)<<e}LoadCode(t){let e=this.LoadInt(),n=yc;for(let a=0;a<e;a++){0!==Uc(this.Z,this.u8,0,this.instructionSize)&&this.error("truncated");let e=this.dv.getUint32(0,!0);t.code[a]={code:e,opcode:e>>gc&n.MASK1(kc,0),A:e>>_c&n.MASK1(Ac,0),B:e>>hc&n.MASK1(vc,0),C:e>>Lc&n.MASK1(Oc,0),Bx:e>>dc&n.MASK1(bc,0),Ax:e>>pc&n.MASK1(Tc,0),sBx:(e>>dc&n.MASK1(bc,0))-fc}}}LoadConstants(t){let e=this.LoadInt();for(let n=0;n<e;n++){let e=this.LoadByte();switch(e){case ac:t.k.push(new Sr.TValue(ac,null));break;case ec:t.k.push(new Sr.TValue(ec,0!==this.LoadByte()));break;case rc:t.k.push(new Sr.TValue(rc,this.LoadNumber()));break;case uc:t.k.push(new Sr.TValue(uc,this.LoadInteger()));break;case lc:case nc:t.k.push(new Sr.TValue(nc,this.LoadString()));break;default:this.error(`unrecognized constant '${e}'`)}}}LoadProtos(t){let e=this.LoadInt();for(let n=0;n<e;n++)t.p[n]=new Mr.Proto(this.L),this.LoadFunction(t.p[n],t.source)}LoadUpvalues(t){let e=this.LoadInt();for(let n=0;n<e;n++)t.upvalues[n]={name:null,instack:this.LoadByte(),idx:this.LoadByte()}}LoadDebug(t){let e=this.LoadInt();for(let n=0;n<e;n++)t.lineinfo[n]=this.LoadInt();e=this.LoadInt();for(let n=0;n<e;n++)t.locvars[n]={varname:this.LoadString(),startpc:this.LoadInt(),endpc:this.LoadInt()};e=this.LoadInt();for(let n=0;n<e;n++)t.upvalues[n].name=this.LoadString()}LoadFunction(t,e){t.source=this.LoadString(),null===t.source&&(t.source=e),t.linedefined=this.LoadInt(),t.lastlinedefined=this.LoadInt(),t.numparams=this.LoadByte(),t.is_vararg=0!==this.LoadByte(),t.maxstacksize=this.LoadByte(),this.LoadCode(t),this.LoadConstants(t),this.LoadUpvalues(t),this.LoadProtos(t),this.LoadDebug(t)}checkliteral(t,e){let n=this.read(t.length);ic(n,t)||this.error(e)}checkHeader(){this.checkliteral(tc.subarray(1),"not a"),83!==this.LoadByte()&&this.error("version mismatch in"),0!==this.LoadByte()&&this.error("format mismatch in"),this.checkliteral(Nc,"corrupted"),this.intSize=this.LoadByte(),this.size_tSize=this.LoadByte(),this.instructionSize=this.LoadByte(),this.integerSize=this.LoadByte(),this.numberSize=this.LoadByte(),this.checksize(this.intSize,4,"int"),this.checksize(this.size_tSize,4,"size_t"),this.checksize(this.instructionSize,4,"instruction"),this.checksize(this.integerSize,4,"integer"),this.checksize(this.numberSize,8,"number"),22136!==this.LoadInteger()&&this.error("endianness mismatch in"),370.5!==this.LoadNumber()&&this.error("float format mismatch in")}error(t){Sr.luaO_pushfstring(this.L,cc("%s: %s precompiled chunk"),this.name,cc(t)),Pf.luaD_throw(this.L,sc)}checksize(t,e,n){t!==e&&this.error(`${n} size mismatch in`)}}var wc={luaU_undump:function(t,e,n){let a=new yc(t,e,n);a.checkHeader();let r=Mr.luaF_newLclosure(t,a.LoadByte());return Pf.luaD_inctop(t),t.stack[t.top-1].setclLvalue(r),r.p=new Mr.Proto(t),a.LoadFunction(r.p,null),mc(r.nupvalues===r.p.upvalues.length),r}};const{LUA_HOOKCALL:Sc,LUA_HOOKRET:Ic,LUA_HOOKTAILCALL:Mc,LUA_MASKCALL:Pc,LUA_MASKLINE:xc,LUA_MASKRET:Cc,LUA_MINSTACK:Dc,LUA_MULTRET:Bc,LUA_SIGNATURE:Vc,constant_types:{LUA_TCCL:Gc,LUA_TLCF:Kc,LUA_TLCL:Fc,LUA_TNIL:jc},thread_status:{LUA_ERRMEM:Hc,LUA_ERRERR:Xc,LUA_ERRRUN:zc,LUA_ERRSYNTAX:Jc,LUA_OK:qc,LUA_YIELD:Yc},lua_Debug:Wc,luastring_indexOf:Zc,to_luastring:Qc}=V,{api_check:$c,lua_assert:tf,LUAI_MAXCCALLS:ef}=j,{luaS_newliteral:nf}=et,{LUAI_MAXSTACK:af}=g,{MBuffer:rf}=Cr,uf=function(t,e){if(t.top<e)for(;t.top<e;)t.stack[t.top++]=new Sr.TValue(jc,null);else for(;t.top>e;)delete t.stack[--t.top]},lf=function(t,e,n){let a=t.top;for(;t.top<n+1;)t.stack[t.top++]=new Sr.TValue(jc,null);switch(e){case Hc:Sr.setsvalue2s(t,n,nf(t,"not enough memory"));break;case Xc:Sr.setsvalue2s(t,n,nf(t,"error in error handling"));break;default:Sr.setobjs2s(t,n,a-1)}for(;t.top>n+1;)delete t.stack[--t.top]},sf=af+200,of=function(t,e){tf(e<=af||e==sf),tf(t.stack_last==t.stack.length-ca.EXTRA_STACK),t.stack.length=e,t.stack_last=e-ca.EXTRA_STACK},cf=function(t,e){let n=t.stack.length;if(n>af)bf(t,Xc);else{let a=t.top+e+ca.EXTRA_STACK,r=2*n;r>af&&(r=af),r<a&&(r=a),r>af?(of(t,sf),p_.luaG_runerror(t,Qc("stack overflow",!0))):of(t,r)}},ff=function(t,e){t.stack_last-t.top<=e&&cf(t,e)},_f=function(t){let e=function(t){let e=t.top;for(let n=t.ci;null!==n;n=n.previous)e<n.top&&(e=n.top);return tf(e<=t.stack_last),e+1}(t),n=e+Math.floor(e/8)+2*ca.EXTRA_STACK;n>af&&(n=af),t.stack.length>af&&ca.luaE_freeCI(t),e<=af-ca.EXTRA_STACK&&n<t.stack.length&&of(t,n)},pf=function(t,e,n){let a=t.stack[e];switch(a.type){case Gc:case Kc:{let r=a.type===Gc?a.value.f:a.value;ff(t,Dc);let u=ca.luaE_extendCI(t);u.funcOff=e,u.nresults=n,u.func=a,u.top=t.top+Dc,tf(u.top<=t.stack_last),u.callstatus=0,t.hookmask&Pc&&Lf(t,Sc,-1);let l=r(t);if("number"!=typeof l||l<0||(0|l)!==l)throw Error("invalid return value from JS function (expected integer)");return Bd.api_checknelems(t,l),hf(t,u,t.top-l,l),!0}case Fc:{let r,u=a.value.p,l=t.top-e-1,s=u.maxstacksize;if(ff(t,s),u.is_vararg)r=Af(t,u,l);else{for(;l<u.numparams;l++)t.stack[t.top++]=new Sr.TValue(jc,null);r=e+1}let o=ca.luaE_extendCI(t);return o.funcOff=e,o.nresults=n,o.func=a,o.l_base=r,o.top=r+s,uf(t,o.top),o.l_code=u.code,o.l_savedpc=0,o.callstatus=ca.CIST_LUA,t.hookmask&Pc&&gf(t,o),!1}default:return ff(t,1),Tf(t,e,a),pf(t,e,n)}},hf=function(t,e,n,a){let r=e.nresults;t.hookmask&(Cc|xc)&&(t.hookmask&Cc&&Lf(t,Ic,-1),t.oldpc=e.previous.l_savedpc);let u=e.funcOff;return t.ci=e.previous,t.ci.next=null,df(t,n,u,a,r)},df=function(t,e,n,a,r){switch(r){case 0:break;case 1:0===a?t.stack[n].setnilvalue():Sr.setobjs2s(t,n,e);break;case Bc:for(let r=0;r<a;r++)Sr.setobjs2s(t,n+r,e+r);for(let e=t.top;e>=n+a;e--)delete t.stack[e];return t.top=n+a,!1;default:{let u;if(r<=a)for(u=0;u<r;u++)Sr.setobjs2s(t,n+u,e+u);else{for(u=0;u<a;u++)Sr.setobjs2s(t,n+u,e+u);for(;u<r;u++)n+u>=t.top?t.stack[n+u]=new Sr.TValue(jc,null):t.stack[n+u].setnilvalue()}break}}let u=n+r;for(let e=t.top;e>=u;e--)delete t.stack[e];return t.top=u,!0},Lf=function(t,e,n){let a=t.hook;if(a&&t.allowhook){let r=t.ci,u=t.top,l=r.top,s=new Wc;s.event=e,s.currentline=n,s.i_ci=r,ff(t,Dc),r.top=t.top+Dc,tf(r.top<=t.stack_last),t.allowhook=0,r.callstatus|=ca.CIST_HOOKED,a(t,s),tf(!t.allowhook),t.allowhook=1,r.top=l,uf(t,u),r.callstatus&=~ca.CIST_HOOKED}},gf=function(t,e){let n=Sc;e.l_savedpc++,e.previous.callstatus&ca.CIST_LUA&&e.previous.l_code[e.previous.l_savedpc-1].opcode==Pt.OpCodesI.OP_TAILCALL&&(e.callstatus|=ca.CIST_TAIL,n=Mc),Lf(t,n,-1),e.l_savedpc--},Af=function(t,e,n){let a,r=e.numparams,u=t.top-n,l=t.top;for(a=0;a<r&&a<n;a++)Sr.pushobj2s(t,t.stack[u+a]),t.stack[u+a].setnilvalue();for(;a<r;a++)t.stack[t.top++]=new Sr.TValue(jc,null);return l},Tf=function(t,e,n){let a=Jn.luaT_gettmbyobj(t,n,Jn.TMS.TM_CALL);a.ttisfunction(a)||p_.luaG_typeerror(t,n,Qc("call",!0)),Sr.pushobj2s(t,t.stack[t.top-1]);for(let n=t.top-2;n>e;n--)Sr.setobjs2s(t,n,n-1);Sr.setobj2s(t,e,a)},vf=function(t,e,n){++t.nCcalls>=ef&&function(t){t.nCcalls===ef?p_.luaG_runerror(t,Qc("JS stack overflow",!0)):t.nCcalls>=ef+(ef>>3)&&bf(t,Xc)}(t),pf(t,e,n)||In.luaV_execute(t),t.nCcalls--},bf=function(t,e){if(t.errorJmp)throw t.errorJmp.status=e,t.errorJmp;{let n=t.l_G;if(t.status=e,!n.mainthread.errorJmp){let a=n.panic;throw a&&(lf(t,e,t.top),t.ci.top<t.top&&(t.ci.top=t.top),a(t)),new Error(`Aborted ${e}`)}n.mainthread.stack[n.mainthread.top++]=t.stack[t.top-1],bf(n.mainthread,e)}},Of=function(t,e,n){let a=t.nCcalls,r={status:qc,previous:t.errorJmp};t.errorJmp=r;try{e(t,n)}catch(e){if(r.status===qc){let n=t.l_G.atnativeerror;if(n)try{if(r.status=qc,Bd.lua_pushcfunction(t,n),Bd.lua_pushlightuserdata(t,e),wf(t,t.top-2,1),0!==t.errfunc){let e=t.errfunc;Sr.pushobj2s(t,t.stack[t.top-1]),Sr.setobjs2s(t,t.top-2,e),wf(t,t.top-2,1)}r.status=zc}catch(t){r.status===qc&&(r.status=-1)}else r.status=-1}}return t.errorJmp=r.previous,t.nCcalls=a,r.status},kf=function(t,e){let n=t.ci;tf(null!==n.c_k&&0===t.nny),tf(n.callstatus&ca.CIST_YPCALL||e===Yc),n.callstatus&ca.CIST_YPCALL&&(n.callstatus&=~ca.CIST_YPCALL,t.errfunc=n.c_old_errfunc),n.nresults===Bc&&t.ci.top<t.top&&(t.ci.top=t.top);let a=(0,n.c_k)(t,e,n.c_ctx);Bd.api_checknelems(t,a),hf(t,n,t.top-a,a)},mf=function(t,e){for(null!==e&&kf(t,e);t.ci!==t.base_ci;)t.ci.callstatus&ca.CIST_LUA?(In.luaV_finishOp(t),In.luaV_execute(t)):kf(t,Yc)},Ef=function(t,e){let n=function(t){for(let e=t.ci;null!==e;e=e.previous)if(e.callstatus&ca.CIST_YPCALL)return e;return null}(t);if(null===n)return 0;let a=n.extra;return Mr.luaF_close(t,a),lf(t,e,a),t.ci=n,t.allowhook=n.callstatus&ca.CIST_OAH,t.nny=0,_f(t),t.errfunc=n.c_old_errfunc,1},Uf=function(t,e,n){let a=nf(t,e);if(0===n)Sr.pushsvalue2s(t,a),$c(t,t.top<=t.ci.top,"stack overflow");else{for(let e=1;e<n;e++)delete t.stack[--t.top];Sr.setsvalue2s(t,t.top-1,a)}return zc},Rf=function(t,e){let n=t.top-e,a=t.ci;t.status===qc?pf(t,n-1,Bc)||In.luaV_execute(t):(tf(t.status===Yc),t.status=qc,a.funcOff=a.extra,a.func=t.stack[a.funcOff],a.callstatus&ca.CIST_LUA?In.luaV_execute(t):(null!==a.c_k&&(e=a.c_k(t,Yc,a.c_ctx),Bd.api_checknelems(t,e),n=t.top-e),hf(t,a,n,e)),mf(t,null))},Nf=function(t,e,n,a){let r=t.ci;return Bd.api_checknelems(t,e),t.nny>0&&(t!==t.l_G.mainthread?p_.luaG_runerror(t,Qc("attempt to yield across a JS-call boundary",!0)):p_.luaG_runerror(t,Qc("attempt to yield from outside a coroutine",!0))),t.status=Yc,r.extra=r.funcOff,r.callstatus&ca.CIST_LUA?$c(t,null===a,"hooks cannot continue after yielding"):(r.c_k=a,null!==a&&(r.c_ctx=n),r.funcOff=t.top-e-1,r.func=t.stack[r.funcOff],bf(t,Yc)),tf(r.callstatus&ca.CIST_HOOKED),0},yf=function(t,e,n,a,r){let u=t.ci,l=t.allowhook,s=t.nny,o=t.errfunc;t.errfunc=r;let i=Of(t,e,n);return i!==qc&&(Mr.luaF_close(t,a),lf(t,i,a),t.ci=u,t.allowhook=l,t.nny=s,_f(t)),t.errfunc=o,i},wf=function(t,e,n){t.nny++,vf(t,e,n),t.nny--};class Sf{constructor(t,e,n){this.z=t,this.buff=new rf,this.dyd=new $i.Dyndata,this.mode=n,this.name=e}}const If=function(t,e,n){e&&-1===Zc(e,n[0])&&(Sr.luaO_pushfstring(t,Qc("attempt to load a %s chunk (mode is '%s')"),n,e),bf(t,Jc))},Mf=function(t,e){let n,a=e.z.zgetc();a===Vc[0]?(If(t,e.mode,Qc("binary",!0)),n=wc.luaU_undump(t,e.z,e.name)):(If(t,e.mode,Qc("text",!0)),n=$i.luaY_parser(t,e.z,e.buff,e.dyd,e.name,a)),tf(n.nupvalues===n.p.upvalues.length),Mr.luaF_initupvals(t,n)};var Pf={adjust_top:uf,luaD_call:vf,luaD_callnoyield:wf,luaD_checkstack:ff,luaD_growstack:cf,luaD_hook:Lf,luaD_inctop:function(t){ff(t,1),t.stack[t.top++]=new Sr.TValue(jc,null)},luaD_pcall:yf,luaD_poscall:hf,luaD_precall:pf,luaD_protectedparser:function(t,e,n,a){let r=new Sf(e,n,a);t.nny++;let u=yf(t,Mf,r,t.top,t.errfunc);return t.nny--,u},luaD_rawrunprotected:Of,luaD_reallocstack:of,luaD_throw:bf,lua_isyieldable:function(t){return 0===t.nny},lua_resume:function(t,e,n){let a=t.nny;if(t.status===qc){if(t.ci!==t.base_ci)return Uf(t,"cannot resume non-suspended coroutine",n)}else if(t.status!==Yc)return Uf(t,"cannot resume dead coroutine",n);if(t.nCcalls=e?e.nCcalls+1:1,t.nCcalls>=ef)return Uf(t,"JS stack overflow",n);t.nny=0,Bd.api_checknelems(t,t.status===qc?n+1:n);let r=Of(t,Rf,n);if(-1===r)r=zc;else{for(;r>Yc&&Ef(t,r);)r=Of(t,mf,r);r>Yc?(t.status=r,lf(t,r,t.top),t.ci.top=t.top):tf(r===t.status)}return t.nny=a,t.nCcalls--,tf(t.nCcalls===(e?e.nCcalls:0)),r},lua_yield:function(t,e){Nf(t,e,0,null)},lua_yieldk:Nf};const{LUA_HOOKCOUNT:xf,LUA_HOOKLINE:Cf,LUA_MASKCOUNT:Df,LUA_MASKLINE:Bf,constant_types:{LUA_TBOOLEAN:Vf,LUA_TNIL:Gf,LUA_TTABLE:Kf},thread_status:{LUA_ERRRUN:Ff,LUA_YIELD:jf},from_userstring:Hf,luastring_eq:Xf,luastring_indexOf:zf,to_luastring:Jf}=V,{api_check:qf,lua_assert:Yf}=j,{LUA_IDSIZE:Wf}=g,Zf=function(t){return Yf(t.callstatus&ca.CIST_LUA),t.l_savedpc-1},Qf=function(t){return 0!==t.func.value.p.lineinfo.length?t.func.value.p.lineinfo[Zf(t)]:-1},$f=function(t){if(t.status===jf){let e=t.ci,n=e.funcOff;e.func=t.stack[e.extra],e.funcOff=e.extra,e.extra=n}},t_=function(t,e){Yf(e<t.upvalues.length);let n=t.upvalues[e].name;return null===n?Jf("?",!0):n.getstr()},e_=function(t,e,n){let a,r=null;if(e.callstatus&ca.CIST_LUA){if(n<0)return function(t,e){let n=t.func.value.p.numparams;return e>=t.l_base-t.funcOff-n?null:{pos:t.funcOff+n+e,name:Jf("(*vararg)",!0)}}(e,-n);a=e.l_base,r=Mr.luaF_getlocalname(e.func.value.p,n,Zf(e))}else a=e.funcOff+1;if(null===r){if(!((e===t.ci?t.top:e.next.funcOff)-a>=n&&n>0))return null;r=Jf("(*temporary)",!0)}return{pos:a+(n-1),name:r}},n_=function(t,e){if(null===e||e instanceof Sr.CClosure)t.source=Jf("=[JS]",!0),t.linedefined=-1,t.lastlinedefined=-1,t.what=Jf("J",!0);else{let n=e.p;t.source=n.source?n.source.getstr():Jf("=?",!0),t.linedefined=n.linedefined,t.lastlinedefined=n.lastlinedefined,t.what=0===t.linedefined?Jf("main",!0):Jf("Lua",!0)}t.short_src=Sr.luaO_chunkid(t.source,Wf)},a_=function(t,e){let n={name:null,funcname:null};return null===e?null:e.callstatus&ca.CIST_FIN?(n.name=Jf("__gc",!0),n.funcname=Jf("metamethod",!0),n):!(e.callstatus&ca.CIST_TAIL)&&e.previous.callstatus&ca.CIST_LUA?s_(t,e.previous):null},r_=function(t,e,n){let a={name:null,funcname:null};if(Pt.ISK(n)){let e=t.k[Pt.INDEXK(n)];if(e.ttisstring())return a.name=e.svalue(),a}else{let a=l_(t,e,n);if(a&&99===a.funcname[0])return a}return a.name=Jf("?",!0),a},u_=function(t,e){return t<e?-1:t},l_=function(t,e,n){let a={name:Mr.luaF_getlocalname(t,n+1,e),funcname:null};if(a.name)return a.funcname=Jf("local",!0),a;let r=function(t,e,n){let a=-1,r=0,u=Pt.OpCodesI;for(let l=0;l<e;l++){let s=t.code[l],o=s.A;switch(s.opcode){case u.OP_LOADNIL:{let t=s.B;o<=n&&n<=o+t&&(a=u_(l,r));break}case u.OP_TFORCALL:n>=o+2&&(a=u_(l,r));break;case u.OP_CALL:case u.OP_TAILCALL:n>=o&&(a=u_(l,r));break;case u.OP_JMP:{let t=l+1+s.sBx;l<t&&t<=e&&t>r&&(r=t);break}default:Pt.testAMode(s.opcode)&&n===o&&(a=u_(l,r))}}return a}(t,e,n),u=Pt.OpCodesI;if(-1!==r){let e=t.code[r];switch(e.opcode){case u.OP_MOVE:{let n=e.B;if(n<e.A)return l_(t,r,n);break}case u.OP_GETTABUP:case u.OP_GETTABLE:{let n=e.C,l=e.B,s=e.opcode===u.OP_GETTABLE?Mr.luaF_getlocalname(t,l+1,r):t_(t,l);return a.name=r_(t,r,n).name,a.funcname=s&&Xf(s,Su.LUA_ENV)?Jf("global",!0):Jf("field",!0),a}case u.OP_GETUPVAL:return a.name=t_(t,e.B),a.funcname=Jf("upvalue",!0),a;case u.OP_LOADK:case u.OP_LOADKX:{let n=e.opcode===u.OP_LOADK?e.Bx:t.code[r+1].Ax;if(t.k[n].ttisstring())return a.name=t.k[n].svalue(),a.funcname=Jf("constant",!0),a;break}case u.OP_SELF:{let n=e.C;return a.name=r_(t,r,n).name,a.funcname=Jf("method",!0),a}}}return null},s_=function(t,e){let n={name:null,funcname:null},a=0,r=e.func.value.p,u=Zf(e),l=r.code[u],s=Pt.OpCodesI;if(e.callstatus&ca.CIST_HOOKED)return n.name=Jf("?",!0),n.funcname=Jf("hook",!0),n;switch(l.opcode){case s.OP_CALL:case s.OP_TAILCALL:return l_(r,u,l.A);case s.OP_TFORCALL:return n.name=Jf("for iterator",!0),n.funcname=Jf("for iterator",!0),n;case s.OP_SELF:case s.OP_GETTABUP:case s.OP_GETTABLE:a=Jn.TMS.TM_INDEX;break;case s.OP_SETTABUP:case s.OP_SETTABLE:a=Jn.TMS.TM_NEWINDEX;break;case s.OP_ADD:a=Jn.TMS.TM_ADD;break;case s.OP_SUB:a=Jn.TMS.TM_SUB;break;case s.OP_MUL:a=Jn.TMS.TM_MUL;break;case s.OP_MOD:a=Jn.TMS.TM_MOD;break;case s.OP_POW:a=Jn.TMS.TM_POW;break;case s.OP_DIV:a=Jn.TMS.TM_DIV;break;case s.OP_IDIV:a=Jn.TMS.TM_IDIV;break;case s.OP_BAND:a=Jn.TMS.TM_BAND;break;case s.OP_BOR:a=Jn.TMS.TM_BOR;break;case s.OP_BXOR:a=Jn.TMS.TM_BXOR;break;case s.OP_SHL:a=Jn.TMS.TM_SHL;break;case s.OP_SHR:a=Jn.TMS.TM_SHR;break;case s.OP_UNM:a=Jn.TMS.TM_UNM;break;case s.OP_BNOT:a=Jn.TMS.TM_BNOT;break;case s.OP_LEN:a=Jn.TMS.TM_LEN;break;case s.OP_CONCAT:a=Jn.TMS.TM_CONCAT;break;case s.OP_EQ:a=Jn.TMS.TM_EQ;break;case s.OP_LT:a=Jn.TMS.TM_LT;break;case s.OP_LE:a=Jn.TMS.TM_LE;break;default:return null}return n.name=t.l_G.tmname[a].getstr(),n.funcname=Jf("metamethod",!0),n},o_=function(t,e){let n=t.ci,a=null;if(n.callstatus&ca.CIST_LUA){a=function(t,e,n){let a=e.func.value;for(let t=0;t<a.nupvalues;t++)if(a.upvals[t]===n)return{name:t_(a.p,t),funcname:Jf("upvalue",!0)};return null}(0,n,e);let r=function(t,e,n){for(let a=e.l_base;a<e.top;a++)if(t.stack[a]===n)return a;return!1}(t,n,e);!a&&r&&(a=l_(n.func.value.p,Zf(n),r-n.l_base))}return a?Sr.luaO_pushfstring(t,Jf(" (%s '%s')",!0),a.funcname,a.name):Jf("",!0)},i_=function(t,e,n){let a=Jn.luaT_objtypename(t,e);f_(t,Jf("attempt to %s a %s value%s",!0),n,a,o_(t,e))},c_=function(t,e,n,a){let r;return r=n?Sr.luaO_chunkid(n.getstr(),Wf):Jf("?",!0),Sr.luaO_pushfstring(t,Jf("%s:%d: %s",!0),r,a,e)},f_=function(t,e,...n){let a=t.ci,r=Sr.luaO_pushvfstring(t,e,n);a.callstatus&ca.CIST_LUA&&c_(t,r,a.func.value.p.source,Qf(a)),__(t)},__=function(t){if(0!==t.errfunc){let e=t.errfunc;Sr.pushobj2s(t,t.stack[t.top-1]),Sr.setobjs2s(t,t.top-2,e),Pf.luaD_callnoyield(t,t.top-2,1)}Pf.luaD_throw(t,Ff)};var p_={luaG_addinfo:c_,luaG_concaterror:function(t,e,n){(e.ttisstring()||In.cvt2str(e))&&(e=n),i_(t,e,Jf("concatenate",!0))},luaG_errormsg:__,luaG_opinterror:function(t,e,n,a){!1===In.tonumber(e)&&(n=e),i_(t,n,a)},luaG_ordererror:function(t,e,n){let a=Jn.luaT_objtypename(t,e),r=Jn.luaT_objtypename(t,n);Xf(a,r)?f_(t,Jf("attempt to compare two %s values",!0),a):f_(t,Jf("attempt to compare %s with %s",!0),a,r)},luaG_runerror:f_,luaG_tointerror:function(t,e,n){!1===In.tointeger(e)&&(n=e),f_(t,Jf("number%s has no integer representation",!0),o_(t,n))},luaG_traceexec:function(t){let e=t.ci,n=t.hookmask,a=0==--t.hookcount&&n&Df;if(a)t.hookcount=t.basehookcount;else if(!(n&Bf))return;if(e.callstatus&ca.CIST_HOOKYIELD)e.callstatus&=~ca.CIST_HOOKYIELD;else{if(a&&Pf.luaD_hook(t,xf,-1),n&Bf){let n=e.func.value.p,a=e.l_savedpc-1,r=0!==n.lineinfo.length?n.lineinfo[a]:-1;(0===a||e.l_savedpc<=t.oldpc||r!==(0!==n.lineinfo.length?n.lineinfo[t.oldpc-1]:-1))&&Pf.luaD_hook(t,Cf,r)}t.oldpc=e.l_savedpc,t.status===jf&&(a&&(t.hookcount=1),e.l_savedpc--,e.callstatus|=ca.CIST_HOOKYIELD,e.funcOff=t.top-1,e.func=t.stack[e.funcOff],Pf.luaD_throw(t,jf))}},luaG_typeerror:i_,lua_gethook:function(t){return t.hook},lua_gethookcount:function(t){return t.basehookcount},lua_gethookmask:function(t){return t.hookmask},lua_getinfo:function(t,e,n){let a,r,u,l;return e=Hf(e),$f(t),62===e[0]?(u=null,l=t.stack[t.top-1],qf(t,l.ttisfunction(),"function expected"),e=e.subarray(1),t.top--):(u=n.i_ci,l=u.func,Yf(u.func.ttisfunction())),r=l.ttisclosure()?l.value:null,a=function(t,e,n,a,r){let u=1;for(;e.length>0;e=e.subarray(1))switch(e[0]){case 83:n_(n,a);break;case 108:n.currentline=r&&r.callstatus&ca.CIST_LUA?Qf(r):-1;break;case 117:n.nups=null===a?0:a.nupvalues,null===a||a instanceof Sr.CClosure?(n.isvararg=!0,n.nparams=0):(n.isvararg=a.p.is_vararg,n.nparams=a.p.numparams);break;case 116:n.istailcall=r?r.callstatus&ca.CIST_TAIL:0;break;case 110:{let e=a_(t,r);null===e?(n.namewhat=Jf("",!0),n.name=null):(n.namewhat=e.funcname,n.name=e.name);break}case 76:case 102:break;default:u=0}return u}(t,e,n,r,u),zf(e,102)>=0&&(Sr.pushobj2s(t,l),qf(t,t.top<=t.ci.top,"stack overflow")),$f(t),zf(e,76)>=0&&function(t,e){if(null===e||e instanceof Sr.CClosure)t.stack[t.top]=new Sr.TValue(Gf,null),Bd.api_incr_top(t);else{let n=e.p.lineinfo,a=Rt.luaH_new(t);t.stack[t.top]=new Sr.TValue(Kf,a),Bd.api_incr_top(t);let r=new Sr.TValue(Vf,!0);for(let t=0;t<n.length;t++)Rt.luaH_setint(a,n[t],r)}}(t,r),a},lua_getlocal:function(t,e,n){let a;if($f(t),null===e)a=t.stack[t.top-1].ttisLclosure()?Mr.luaF_getlocalname(t.stack[t.top-1].value.p,n,0):null;else{let r=e_(t,e.i_ci,n);r?(a=r.name,Sr.pushobj2s(t,t.stack[r.pos]),qf(t,t.top<=t.ci.top,"stack overflow")):a=null}return $f(t),a},lua_getstack:function(t,e,n){let a,r;if(e<0)return 0;for(a=t.ci;e>0&&a!==t.base_ci;a=a.previous)e--;return 0===e&&a!==t.base_ci?(r=1,n.i_ci=a):r=0,r},lua_sethook:function(t,e,n,a){null!==e&&0!==n||(n=0,e=null),t.ci.callstatus&ca.CIST_LUA&&(t.oldpc=t.ci.l_savedpc),t.hook=e,t.basehookcount=a,t.hookcount=t.basehookcount,t.hookmask=n},lua_setlocal:function(t,e,n){let a;$f(t);let r=e_(t,e.i_ci,n);return r?(a=r.name,Sr.setobjs2s(t,r.pos,t.top-1),delete t.stack[--t.top]):a=null,$f(t),a}};const{LUA_SIGNATURE:h_,LUA_VERSION_MAJOR:d_,LUA_VERSION_MINOR:L_,constant_types:{LUA_TBOOLEAN:g_,LUA_TLNGSTR:A_,LUA_TNIL:T_,LUA_TNUMFLT:v_,LUA_TNUMINT:b_,LUA_TSHRSTR:O_},luastring_of:k_}=V,m_=k_(25,147,13,10,26,10),E_=16*Number(d_)+Number(L_);class U_{constructor(){this.L=null,this.write=null,this.data=null,this.strip=NaN,this.status=NaN}}const R_=function(t,e,n){0===n.status&&e>0&&(n.status=n.writer(n.L,t,e,n.data))},N_=function(t,e){R_(k_(t),1,e)},y_=function(t,e){let n=new ArrayBuffer(4);new DataView(n).setInt32(0,t,!0);let a=new Uint8Array(n);R_(a,4,e)},w_=function(t,e){let n=new ArrayBuffer(4);new DataView(n).setInt32(0,t,!0);let a=new Uint8Array(n);R_(a,4,e)},S_=function(t,e){let n=new ArrayBuffer(8);new DataView(n).setFloat64(0,t,!0);let a=new Uint8Array(n);R_(a,8,e)},I_=function(t,e){if(null===t)N_(0,e);else{let n=t.tsslen()+1,a=t.getstr();n<255?N_(n,e):(N_(255,e),w_(n,e)),R_(a,n-1,e)}},M_=function(t,e,n){n.strip||t.source===e?I_(null,n):I_(t.source,n),y_(t.linedefined,n),y_(t.lastlinedefined,n),N_(t.numparams,n),N_(t.is_vararg?1:0,n),N_(t.maxstacksize,n),function(t,e){let n=t.code.map(t=>t.code);y_(n.length,e);for(let t=0;t<n.length;t++)y_(n[t],e)}(t,n),function(t,e){let n=t.k.length;y_(n,e);for(let a=0;a<n;a++){let n=t.k[a];switch(N_(n.ttype(),e),n.ttype()){case T_:break;case g_:N_(n.value?1:0,e);break;case v_:S_(n.value,e);break;case b_:w_(n.value,e);break;case O_:case A_:I_(n.tsvalue(),e)}}}(t,n),function(t,e){let n=t.upvalues.length;y_(n,e);for(let a=0;a<n;a++)N_(t.upvalues[a].instack?1:0,e),N_(t.upvalues[a].idx,e)}(t,n),function(t,e){let n=t.p.length;y_(n,e);for(let a=0;a<n;a++)M_(t.p[a],t.source,e)}(t,n),function(t,e){let n=e.strip?0:t.lineinfo.length;y_(n,e);for(let a=0;a<n;a++)y_(t.lineinfo[a],e);n=e.strip?0:t.locvars.length,y_(n,e);for(let a=0;a<n;a++)I_(t.locvars[a].varname,e),y_(t.locvars[a].startpc,e),y_(t.locvars[a].endpc,e);n=e.strip?0:t.upvalues.length,y_(n,e);for(let a=0;a<n;a++)I_(t.upvalues[a].name,e)}(t,n)};var P_={luaU_dump:function(t,e,n,a,r){let u=new U_;return u.L=t,u.writer=n,u.data=a,u.strip=r,u.status=0,function(t){R_(h_,h_.length,t),N_(E_,t),N_(0,t),R_(m_,m_.length,t),N_(4,t),N_(4,t),N_(4,t),N_(4,t),N_(8,t),w_(22136,t),S_(370.5,t)}(u),N_(e.upvalues.length,u),M_(e,null,u),u.status}};const{LUA_MULTRET:x_,LUA_OPBNOT:C_,LUA_OPEQ:D_,LUA_OPLE:B_,LUA_OPLT:V_,LUA_OPUNM:G_,LUA_REGISTRYINDEX:K_,LUA_RIDX_GLOBALS:F_,LUA_VERSION_NUM:j_,constant_types:{LUA_NUMTAGS:H_,LUA_TBOOLEAN:X_,LUA_TCCL:z_,LUA_TFUNCTION:J_,LUA_TLCF:q_,LUA_TLCL:Y_,LUA_TLIGHTUSERDATA:W_,LUA_TLNGSTR:Z_,LUA_TNIL:Q_,LUA_TNONE:$_,LUA_TNUMFLT:tp,LUA_TNUMINT:ep,LUA_TSHRSTR:np,LUA_TTABLE:ap,LUA_TTHREAD:rp,LUA_TUSERDATA:up},thread_status:{LUA_OK:lp},from_userstring:sp,to_luastring:op}=V,{api_check:ip}=j,{luaU_dump:cp}=P_,{luaS_bless:fp,luaS_new:_p,luaS_newliteral:pp}=et,{LUAI_MAXSTACK:hp}=g,{ZIO:dp}=Cr,Lp=Sr.TValue,gp=Sr.CClosure,Ap=function(t){t.top++,ip(t,t.top<=t.ci.top,"stack overflow")},Tp=function(t,e){ip(t,e<t.top-t.ci.funcOff,"not enough elements in the stack")},vp=function(t){if(!t)throw TypeError("invalid argument")},bp=function(t){vp("number"==typeof t&&(0|t)===t)},Op=function(t){return t!==Sr.luaO_nilobject},kp=function(t,e){let n=t.ci;if(e>0){let a=n.funcOff+e;return ip(t,e<=n.top-(n.funcOff+1),"unacceptable index"),a>=t.top?Sr.luaO_nilobject:t.stack[a]}return e>K_?(ip(t,0!==e&&-e<=t.top,"invalid index"),t.stack[t.top+e]):e===K_?t.l_G.l_registry:(ip(t,(e=K_-e)<=Mr.MAXUPVAL+1,"upvalue index too large"),n.func.ttislcf()?Sr.luaO_nilobject:e<=n.func.value.nupvalues?n.func.value.upvalue[e-1]:Sr.luaO_nilobject)},mp=function(t,e){let n=t.ci;if(e>0){let a=n.funcOff+e;return ip(t,e<=n.top-(n.funcOff+1),"unacceptable index"),a>=t.top?null:a}if(e>K_)return ip(t,0!==e&&-e<=t.top,"invalid index"),t.top+e;throw Error("attempt to use pseudo-index")},Ep=function(t,e){let n,a=t.ci.funcOff;e>=0?(ip(t,e<=t.stack_last-(a+1),"new top too large"),n=a+1+e):(ip(t,-(e+1)<=t.top-(a+1),"invalid new top"),n=t.top+e+1),Pf.adjust_top(t,n)},Up=function(t,e){Ep(t,-e-1)},Rp=function(t,e,n){for(;e<n;e++,n--){let a=t.stack[e],r=new Lp(a.type,a.value);Sr.setobjs2s(t,e,n),Sr.setobj2s(t,n,r)}},Np=function(t,e,n){let a=t.top-1,r=mp(t,e),u=t.stack[r];ip(t,Op(u)&&e>K_,"index not in the stack"),ip(t,(n>=0?n:-n)<=a-r+1,"invalid 'n'");let l=n>=0?a-n:r-n-1;Rp(t,r,l),Rp(t,l+1,t.top-1),Rp(t,r,t.top-1)},yp=function(t,e,n){let a=kp(t,e);kp(t,n).setfrom(a)},wp=function(t,e,n){if(vp("function"==typeof e),bp(n),0===n)t.stack[t.top]=new Lp(q_,e);else{Tp(t,n),ip(t,n<=Mr.MAXUPVAL,"upvalue index too large");let a=new gp(t,e,n);for(let e=0;e<n;e++)a.upvalue[e].setfrom(t.stack[t.top-n+e]);for(let e=1;e<n;e++)delete t.stack[--t.top];n>0&&--t.top,t.stack[t.top].setclCvalue(a)}Ap(t)},Sp=wp,Ip=function(t,e){wp(t,e,0)},Mp=Ip,Pp=function(t,e,n){let a=_p(t,sp(n));Tp(t,1),Sr.pushsvalue2s(t,a),ip(t,t.top<=t.ci.top,"stack overflow"),In.settable(t,e,t.stack[t.top-1],t.stack[t.top-2]),delete t.stack[--t.top],delete t.stack[--t.top]},xp=function(t,e){Pp(t,Rt.luaH_getint(t.l_G.l_registry.value,F_),e)},Cp=function(t,e,n){let a=_p(t,sp(n));return Sr.pushsvalue2s(t,a),ip(t,t.top<=t.ci.top,"stack overflow"),In.luaV_gettable(t,e,t.stack[t.top-1],t.top-1),t.stack[t.top-1].ttnov()},Dp=function(t,e,n){let a=kp(t,e);return bp(n),ip(t,a.ttistable(),"table expected"),Sr.pushobj2s(t,Rt.luaH_getint(a.value,n)),ip(t,t.top<=t.ci.top,"stack overflow"),t.stack[t.top-1].ttnov()},Bp=function(t,e,n){let a=new Sr.TValue(ap,Rt.luaH_new(t));t.stack[t.top]=a,Ap(t)},Vp=function(t,e,n){switch(bp(n),e.ttype()){case z_:{let t=e.value;return 1<=n&&n<=t.nupvalues?{name:op("",!0),val:t.upvalue[n-1]}:null}case Y_:{let t=e.value,a=t.p;if(!(1<=n&&n<=a.upvalues.length))return null;let r=a.upvalues[n-1].name;return{name:r?r.getstr():op("(*no name)",!0),val:t.upvals[n-1]}}default:return null}},Gp=function(t,e){let n=kp(t,e);if(!n.ttisstring()){if(!In.cvt2str(n))return null;Sr.luaO_tostring(t,n)}return n.svalue()},Kp=Gp,Fp=function(t,e){return In.tointeger(kp(t,e))},jp=function(t,e){return In.tonumber(kp(t,e))},Hp=new WeakMap,Xp=function(t,e){Pf.luaD_callnoyield(t,e.funcOff,e.nresults)},zp=function(t,e){let n=kp(t,e);return Op(n)?n.ttnov():$_},Jp=op("?"),qp=function(t,e,n){ip(t,n===x_||t.ci.top-t.top>=n-e,"results from function overflow current stack size")},Yp=function(t,e,n,a,r){ip(t,null===r||!(t.ci.callstatus&ca.CIST_LUA),"cannot use continuations inside hooks"),Tp(t,e+1),ip(t,t.status===lp,"cannot do calls on non-normal thread"),qp(t,e,n);let u=t.top-(e+1);null!==r&&0===t.nny?(t.ci.c_k=r,t.ci.c_ctx=a,Pf.luaD_call(t,u,n)):Pf.luaD_callnoyield(t,u,n),n===x_&&t.ci.top<t.top&&(t.ci.top=t.top)},Wp=function(t,e,n,a,r,u){let l,s;ip(t,null===u||!(t.ci.callstatus&ca.CIST_LUA),"cannot use continuations inside hooks"),Tp(t,e+1),ip(t,t.status===lp,"cannot do calls on non-normal thread"),qp(t,e,n),s=0===a?0:mp(t,a);let o=t.top-(e+1);if(null===u||t.nny>0){let e={funcOff:o,nresults:n};l=Pf.luaD_pcall(t,Xp,e,o,s)}else{let e=t.ci;e.c_k=u,e.c_ctx=r,e.extra=o,e.c_old_errfunc=t.errfunc,t.errfunc=s,e.callstatus&=~ca.CIST_OAH|t.allowhook,e.callstatus|=ca.CIST_YPCALL,Pf.luaD_call(t,o,n),e.callstatus&=~ca.CIST_YPCALL,t.errfunc=e.c_old_errfunc,l=lp}return n===x_&&t.ci.top<t.top&&(t.ci.top=t.top),l},Zp=function(t,e,n){let a=kp(t,e);ip(t,a.ttisLclosure(),"Lua function expected");let r=a.value;return bp(n),ip(t,1<=n&&n<=r.p.upvalues.length,"invalid upvalue index"),{f:r,i:n-1}};var Qp=Ap,$p=Tp,th=function(t,e){return e>0||e<=K_?e:t.top-t.ci.funcOff+e},eh=function(t,e){e!==G_&&e!==C_?Tp(t,2):(Tp(t,1),Sr.pushobj2s(t,t.stack[t.top-1]),ip(t,t.top<=t.ci.top,"stack overflow")),Sr.luaO_arith(t,e,t.stack[t.top-2],t.stack[t.top-1],t.stack[t.top-2]),delete t.stack[--t.top]},nh=function(t,e){let n=t.l_G.panic;return t.l_G.panic=e,n},ah=function(t,e){let n=t.l_G.atnativeerror;return t.l_G.atnativeerror=e,n},rh=function(t,e,n){Yp(t,e,n,0,null)},uh=Yp,lh=function(t,e){let n,a=t.ci;if(ip(t,e>=0,"negative 'n'"),t.stack_last-t.top>e)n=!0;else{t.top+ca.EXTRA_STACK>hp-e?n=!1:(Pf.luaD_growstack(t,e),n=!0)}return n&&a.top<t.top+e&&(a.top=t.top+e),n},sh=function(t,e,n,a){let r=kp(t,e),u=kp(t,n),l=0;if(Op(r)&&Op(u))switch(a){case D_:l=In.luaV_equalobj(t,r,u);break;case V_:l=In.luaV_lessthan(t,r,u);break;case B_:l=In.luaV_lessequal(t,r,u);break;default:ip(t,!1,"invalid option")}return l},oh=function(t,e){Tp(t,e),e>=2?In.luaV_concat(t,e):0===e&&(Sr.pushsvalue2s(t,fp(t,op("",!0))),ip(t,t.top<=t.ci.top,"stack overflow"))},ih=yp,ch=Bp,fh=function(t,e,n,a){Tp(t,1);let r=t.stack[t.top-1];return r.ttisLclosure()?cp(t,r.value.p,e,n,a):1},_h=function(t){Tp(t,1),p_.luaG_errormsg(t)},ph=function(){},hh=function(){return console.warn("lua_getallocf is not available"),0},dh=function(){return console.warn("lua_getextraspace is not available"),0},Lh=function(t,e,n){return Cp(t,kp(t,e),n)},gh=function(t,e){return Cp(t,Rt.luaH_getint(t.l_G.l_registry.value,F_),e)},Ah=function(t,e,n){let a=kp(t,e);return bp(n),t.stack[t.top]=new Lp(ep,n),Ap(t),In.luaV_gettable(t,a,t.stack[t.top-1],t.top-1),t.stack[t.top-1].ttnov()},Th=function(t,e){let n,a=kp(t,e),r=!1;switch(a.ttnov()){case ap:case up:n=a.value.metatable;break;default:n=t.l_G.mt[a.ttnov()]}return null!=n&&(t.stack[t.top]=new Lp(ap,n),Ap(t),r=!0),r},vh=function(t,e){let n=kp(t,e);return In.luaV_gettable(t,n,t.stack[t.top-1],t.top-1),t.stack[t.top-1].ttnov()},bh=function(t){return t.top-(t.ci.funcOff+1)},Oh=function(t,e,n){let a=Vp(0,kp(t,e),n);if(a){let e=a.name,n=a.val;return Sr.pushobj2s(t,n),ip(t,t.top<=t.ci.top,"stack overflow"),e}return null},kh=function(t,e){let n=kp(t,e);ip(t,n.ttisfulluserdata(),"full userdata expected");let a=n.value.uservalue;return t.stack[t.top]=new Lp(a.type,a.value),Ap(t),t.stack[t.top-1].ttnov()},mh=function(t,e){Np(t,e,1)},Eh=function(t,e){return zp(t,e)===X_},Uh=function(t,e){let n=kp(t,e);return n.ttislcf(n)||n.ttisCclosure()},Rh=function(t,e){return zp(t,e)===J_},Nh=function(t,e){return kp(t,e).ttisinteger()},yh=function(t,e){return zp(t,e)===W_},wh=function(t,e){return zp(t,e)===Q_},Sh=function(t,e){return zp(t,e)===$_},Ih=function(t,e){return zp(t,e)<=0},Mh=function(t,e){return!1!==In.tonumber(kp(t,e))},Ph=function(t,e){let n=Hp.get(t);return!!n&&(null===e||e.l_G===n)},xh=function(t,e){let n=kp(t,e);return n.ttisstring()||In.cvt2str(n)},Ch=function(t,e){return kp(t,e).ttistable()},Dh=function(t,e){return zp(t,e)===rp},Bh=function(t,e){let n=kp(t,e);return n.ttisfulluserdata(n)||n.ttislightuserdata()},Vh=function(t,e){let n=kp(t,e),a=new Lp;In.luaV_objlen(t,a,n),t.stack[t.top]=a,Ap(t)},Gh=function(t,e,n,a,r){a=a?sp(a):Jp,null!==r&&(r=sp(r));let u=new dp(t,e,n),l=Pf.luaD_protectedparser(t,u,a,r);if(l===lp){let e=t.stack[t.top-1].value;if(e.nupvalues>=1){let n=Rt.luaH_getint(t.l_G.l_registry.value,F_);e.upvals[0].setfrom(n)}}return l},Kh=function(t){Bp(t)},Fh=function(t,e){let n=function(t,e){return new Sr.Udata(t,e)}(t,e);return t.stack[t.top]=new Sr.TValue(up,n),Ap(t),n.data},jh=function(t,e){let n=kp(t,e);return ip(t,n.ttistable(),"table expected"),t.stack[t.top]=new Lp,Rt.luaH_next(t,n.value,t.top-1)?(Ap(t),1):(delete t.stack[t.top],delete t.stack[--t.top],0)},Hh=function(t,e,n,a){return Wp(t,e,n,a,0,null)},Xh=Wp,zh=Up,Jh=function(t,e){t.stack[t.top]=new Lp(X_,!!e),Ap(t)},qh=wp,Yh=Ip,Wh=function(t,e,...n){return e=sp(e),Sr.luaO_pushvfstring(t,e,n)},Zh=function(t){Dp(t,K_,F_)},Qh=function(t,e){bp(e),t.stack[t.top]=new Lp(ep,e),Ap(t)},$h=Sp,td=Mp,ed=function(t,e){t.stack[t.top]=new Lp(W_,e),Ap(t)},nd=function(t,e){if(null==e)t.stack[t.top]=new Lp(Q_,null),t.top++;else{vp("string"==typeof e);let n=pp(t,e);Sr.pushsvalue2s(t,n),e=n.getstr()}return ip(t,t.top<=t.ci.top,"stack overflow"),e},ad=function(t,e,n){let a;return bp(n),0===n?(e=op("",!0),a=fp(t,e)):(e=sp(e),ip(t,e.length>=n,"invalid length to lua_pushlstring"),a=_p(t,e.subarray(0,n))),Sr.pushsvalue2s(t,a),ip(t,t.top<=t.ci.top,"stack overflow"),a.value},rd=function(t){t.stack[t.top]=new Lp(Q_,null),Ap(t)},ud=function(t,e){vp("number"==typeof e),t.stack[t.top]=new Lp(tp,e),Ap(t)},ld=function(t,e){if(null==e)t.stack[t.top]=new Lp(Q_,null),t.top++;else{let n=_p(t,sp(e));Sr.pushsvalue2s(t,n),e=n.getstr()}return ip(t,t.top<=t.ci.top,"stack overflow"),e},sd=function(t){return t.stack[t.top]=new Lp(rp,t),Ap(t),t.l_G.mainthread===t},od=function(t,e){Sr.pushobj2s(t,kp(t,e)),ip(t,t.top<=t.ci.top,"stack overflow")},id=function(t,e,n){return e=sp(e),Sr.luaO_pushvfstring(t,e,n)},cd=function(t,e,n){let a=kp(t,e),r=kp(t,n);return Op(a)&&Op(r)?In.luaV_equalobj(null,a,r):0},fd=function(t,e){let n=kp(t,e);return ip(t,n.ttistable(n),"table expected"),Sr.setobj2s(t,t.top-1,Rt.luaH_get(t,n.value,t.stack[t.top-1])),t.stack[t.top-1].ttnov()},_d=Dp,pd=function(t,e,n){let a=kp(t,e);ip(t,a.ttistable(),"table expected");let r=new Lp(W_,n);return Sr.pushobj2s(t,Rt.luaH_get(t,a.value,r)),ip(t,t.top<=t.ci.top,"stack overflow"),t.stack[t.top-1].ttnov()},hd=function(t,e){let n=kp(t,e);switch(n.ttype()){case np:case Z_:return n.vslen();case up:return n.value.len;case ap:return Rt.luaH_getn(n.value);default:return 0}},dd=function(t,e){Tp(t,2);let n=kp(t,e);ip(t,n.ttistable(),"table expected");let a=t.stack[t.top-2],r=t.stack[t.top-1];Rt.luaH_setfrom(t,n.value,a,r),Rt.invalidateTMcache(n.value),delete t.stack[--t.top],delete t.stack[--t.top]},Ld=function(t,e,n){bp(n),Tp(t,1);let a=kp(t,e);ip(t,a.ttistable(),"table expected"),Rt.luaH_setint(a.value,n,t.stack[t.top-1]),delete t.stack[--t.top]},gd=function(t,e,n){Tp(t,1);let a=kp(t,e);ip(t,a.ttistable(),"table expected");let r=new Lp(W_,n),u=t.stack[t.top-1];Rt.luaH_setfrom(t,a.value,r,u),delete t.stack[--t.top]},Ad=function(t,e,n){Ip(t,n),xp(t,e)},Td=function(t,e){Np(t,e,-1),Up(t,1)},vd=function(t,e){yp(t,-1,e),Up(t,1)},bd=Np,Od=function(){return console.warn("lua_setallocf is not available"),0},kd=function(t,e,n){Pp(t,kp(t,e),n)},md=xp,Ed=function(t,e,n){bp(n),Tp(t,1);let a=kp(t,e);t.stack[t.top]=new Lp(ep,n),Ap(t),In.settable(t,a,t.stack[t.top-1],t.stack[t.top-2]),delete t.stack[--t.top],delete t.stack[--t.top]},Ud=function(t,e){let n;Tp(t,1);let a=kp(t,e);switch(t.stack[t.top-1].ttisnil()?n=null:(ip(t,t.stack[t.top-1].ttistable(),"table expected"),n=t.stack[t.top-1].value),a.ttnov()){case up:case ap:a.value.metatable=n;break;default:t.l_G.mt[a.ttnov()]=n}return delete t.stack[--t.top],!0},Rd=function(t,e){Tp(t,2);let n=kp(t,e);In.settable(t,n,t.stack[t.top-2],t.stack[t.top-1]),delete t.stack[--t.top],delete t.stack[--t.top]},Nd=Ep,yd=function(t,e,n){let a=kp(t,e);Tp(t,1);let r=Vp(0,a,n);if(r){let e=r.name;return r.val.setfrom(t.stack[t.top-1]),delete t.stack[--t.top],e}return null},wd=function(t,e){Tp(t,1);let n=kp(t,e);ip(t,n.ttisfulluserdata(),"full userdata expected"),n.value.uservalue.setfrom(t.stack[t.top-1]),delete t.stack[--t.top]},Sd=function(t){return t.status},Id=function(t,e){let n=new Lp,a=Sr.luaO_str2num(e,n);return 0!==a&&(t.stack[t.top]=n,Ap(t)),a},Md=function(t,e){return!kp(t,e).l_isfalse()},Pd=function(t,e){let n=kp(t,e);return n.ttislcf()||n.ttisCclosure()?n.value:null},xd=function(t,e){let n=Gp(t,e);return new DataView(n.buffer,n.byteOffset,n.byteLength)},Cd=function(t,e){let n=Fp(t,e);return!1===n?0:n},Dd=Fp,Bd={api_incr_top:Qp,api_checknelems:$p,lua_absindex:th,lua_arith:eh,lua_atpanic:nh,lua_atnativeerror:ah,lua_call:rh,lua_callk:uh,lua_checkstack:lh,lua_compare:sh,lua_concat:oh,lua_copy:ih,lua_createtable:ch,lua_dump:fh,lua_error:_h,lua_gc:ph,lua_getallocf:hh,lua_getextraspace:dh,lua_getfield:Lh,lua_getglobal:gh,lua_geti:Ah,lua_getmetatable:Th,lua_gettable:vh,lua_gettop:bh,lua_getupvalue:Oh,lua_getuservalue:kh,lua_insert:mh,lua_isboolean:Eh,lua_iscfunction:Uh,lua_isfunction:Rh,lua_isinteger:Nh,lua_islightuserdata:yh,lua_isnil:wh,lua_isnone:Sh,lua_isnoneornil:Ih,lua_isnumber:Mh,lua_isproxy:Ph,lua_isstring:xh,lua_istable:Ch,lua_isthread:Dh,lua_isuserdata:Bh,lua_len:Vh,lua_load:Gh,lua_newtable:Kh,lua_newuserdata:Fh,lua_next:jh,lua_pcall:Hh,lua_pcallk:Xh,lua_pop:zh,lua_pushboolean:Jh,lua_pushcclosure:qh,lua_pushcfunction:Yh,lua_pushfstring:Wh,lua_pushglobaltable:Zh,lua_pushinteger:Qh,lua_pushjsclosure:$h,lua_pushjsfunction:td,lua_pushlightuserdata:ed,lua_pushliteral:nd,lua_pushlstring:ad,lua_pushnil:rd,lua_pushnumber:ud,lua_pushstring:ld,lua_pushthread:sd,lua_pushvalue:od,lua_pushvfstring:id,lua_rawequal:cd,lua_rawget:fd,lua_rawgeti:_d,lua_rawgetp:pd,lua_rawlen:hd,lua_rawset:dd,lua_rawseti:Ld,lua_rawsetp:gd,lua_register:Ad,lua_remove:Td,lua_replace:vd,lua_rotate:bd,lua_setallocf:Od,lua_setfield:kd,lua_setglobal:md,lua_seti:Ed,lua_setmetatable:Ud,lua_settable:Rd,lua_settop:Nd,lua_setupvalue:yd,lua_setuservalue:wd,lua_status:Sd,lua_stringtonumber:Id,lua_toboolean:Md,lua_tocfunction:Pd,lua_todataview:xd,lua_tointeger:Cd,lua_tointegerx:Dd,lua_tojsstring:function(t,e){let n=kp(t,e);if(!n.ttisstring()){if(!In.cvt2str(n))return null;Sr.luaO_tostring(t,n)}return n.jsstring()},lua_tolstring:Gp,lua_tonumber:function(t,e){let n=jp(t,e);return!1===n?0:n},lua_tonumberx:jp,lua_topointer:function(t,e){let n=kp(t,e);switch(n.ttype()){case ap:case Y_:case z_:case q_:case rp:case up:case W_:return n.value;default:return null}},lua_toproxy:function(t,e){let n=kp(t,e);return function(t,e,n){let a=function(a){ip(a,a instanceof ca.lua_State&&t===a.l_G,"must be from same global state"),a.stack[a.top]=new Lp(e,n),Ap(a)};return Hp.set(a,t),a}(t.l_G,n.type,n.value)},lua_tostring:Kp,lua_tothread:function(t,e){let n=kp(t,e);return n.ttisthread()?n.value:null},lua_touserdata:function(t,e){let n=kp(t,e);switch(n.ttnov()){case up:return n.value.data;case W_:return n.value;default:return null}},lua_type:zp,lua_typename:function(t,e){return ip(t,$_<=e&&e<H_,"invalid tag"),Jn.ttypename(e)},lua_upvalueid:function(t,e,n){let a=kp(t,e);switch(a.ttype()){case Y_:{let a=Zp(t,e,n);return a.f.upvals[a.i]}case z_:{let e=a.value;return ip(t,(0|n)===n&&n>0&&n<=e.nupvalues,"invalid upvalue index"),e.upvalue[n-1]}default:return ip(t,!1,"closure expected"),null}},lua_upvaluejoin:function(t,e,n,a,r){let u=Zp(t,e,n),l=Zp(t,a,r),s=l.f.upvals[l.i];u.f.upvals[u.i]=s},lua_version:function(t){return null===t?j_:t.l_G.version},lua_xmove:function(t,e,n){if(t!==e){Tp(t,n),ip(t,t.l_G===e.l_G,"moving among independent states"),ip(t,e.ci.top-e.top>=n,"stack overflow"),t.top-=n;for(let a=0;a<n;a++)e.stack[e.top]=new Sr.TValue,Sr.setobj2s(e,e.top,t.stack[t.top+a]),delete t.stack[t.top+a],e.top++}}},Vd={LUA_AUTHORS:V.LUA_AUTHORS,LUA_COPYRIGHT:V.LUA_COPYRIGHT,LUA_ERRERR:V.thread_status.LUA_ERRERR,LUA_ERRGCMM:V.thread_status.LUA_ERRGCMM,LUA_ERRMEM:V.thread_status.LUA_ERRMEM,LUA_ERRRUN:V.thread_status.LUA_ERRRUN,LUA_ERRSYNTAX:V.thread_status.LUA_ERRSYNTAX,LUA_HOOKCALL:V.LUA_HOOKCALL,LUA_HOOKCOUNT:V.LUA_HOOKCOUNT,LUA_HOOKLINE:V.LUA_HOOKLINE,LUA_HOOKRET:V.LUA_HOOKRET,LUA_HOOKTAILCALL:V.LUA_HOOKTAILCALL,LUA_MASKCALL:V.LUA_MASKCALL,LUA_MASKCOUNT:V.LUA_MASKCOUNT,LUA_MASKLINE:V.LUA_MASKLINE,LUA_MASKRET:V.LUA_MASKRET,LUA_MINSTACK:V.LUA_MINSTACK,LUA_MULTRET:V.LUA_MULTRET,LUA_NUMTAGS:V.constant_types.LUA_NUMTAGS,LUA_OK:V.thread_status.LUA_OK,LUA_OPADD:V.LUA_OPADD,LUA_OPBAND:V.LUA_OPBAND,LUA_OPBNOT:V.LUA_OPBNOT,LUA_OPBOR:V.LUA_OPBOR,LUA_OPBXOR:V.LUA_OPBXOR,LUA_OPDIV:V.LUA_OPDIV,LUA_OPEQ:V.LUA_OPEQ,LUA_OPIDIV:V.LUA_OPIDIV,LUA_OPLE:V.LUA_OPLE,LUA_OPLT:V.LUA_OPLT,LUA_OPMOD:V.LUA_OPMOD,LUA_OPMUL:V.LUA_OPMUL,LUA_OPPOW:V.LUA_OPPOW,LUA_OPSHL:V.LUA_OPSHL,LUA_OPSHR:V.LUA_OPSHR,LUA_OPSUB:V.LUA_OPSUB,LUA_OPUNM:V.LUA_OPUNM,LUA_REGISTRYINDEX:V.LUA_REGISTRYINDEX,LUA_RELEASE:V.LUA_RELEASE,LUA_RIDX_GLOBALS:V.LUA_RIDX_GLOBALS,LUA_RIDX_LAST:V.LUA_RIDX_LAST,LUA_RIDX_MAINTHREAD:V.LUA_RIDX_MAINTHREAD,LUA_SIGNATURE:V.LUA_SIGNATURE,LUA_TNONE:V.constant_types.LUA_TNONE,LUA_TNIL:V.constant_types.LUA_TNIL,LUA_TBOOLEAN:V.constant_types.LUA_TBOOLEAN,LUA_TLIGHTUSERDATA:V.constant_types.LUA_TLIGHTUSERDATA,LUA_TNUMBER:V.constant_types.LUA_TNUMBER,LUA_TSTRING:V.constant_types.LUA_TSTRING,LUA_TTABLE:V.constant_types.LUA_TTABLE,LUA_TFUNCTION:V.constant_types.LUA_TFUNCTION,LUA_TUSERDATA:V.constant_types.LUA_TUSERDATA,LUA_TTHREAD:V.constant_types.LUA_TTHREAD,LUA_VERSION:V.LUA_VERSION,LUA_VERSION_MAJOR:V.LUA_VERSION_MAJOR,LUA_VERSION_MINOR:V.LUA_VERSION_MINOR,LUA_VERSION_NUM:V.LUA_VERSION_NUM,LUA_VERSION_RELEASE:V.LUA_VERSION_RELEASE,LUA_YIELD:V.thread_status.LUA_YIELD,lua_Debug:V.lua_Debug,lua_upvalueindex:V.lua_upvalueindex,lua_absindex:Bd.lua_absindex,lua_arith:Bd.lua_arith,lua_atpanic:Bd.lua_atpanic,lua_atnativeerror:Bd.lua_atnativeerror,lua_call:Bd.lua_call,lua_callk:Bd.lua_callk,lua_checkstack:Bd.lua_checkstack,lua_close:ca.lua_close,lua_compare:Bd.lua_compare,lua_concat:Bd.lua_concat,lua_copy:Bd.lua_copy,lua_createtable:Bd.lua_createtable,lua_dump:Bd.lua_dump,lua_error:Bd.lua_error,lua_gc:Bd.lua_gc,lua_getallocf:Bd.lua_getallocf,lua_getextraspace:Bd.lua_getextraspace,lua_getfield:Bd.lua_getfield,lua_getglobal:Bd.lua_getglobal,lua_gethook:p_.lua_gethook,lua_gethookcount:p_.lua_gethookcount,lua_gethookmask:p_.lua_gethookmask,lua_geti:Bd.lua_geti,lua_getinfo:p_.lua_getinfo,lua_getlocal:p_.lua_getlocal,lua_getmetatable:Bd.lua_getmetatable,lua_getstack:p_.lua_getstack,lua_gettable:Bd.lua_gettable,lua_gettop:Bd.lua_gettop,lua_getupvalue:Bd.lua_getupvalue,lua_getuservalue:Bd.lua_getuservalue,lua_insert:Bd.lua_insert,lua_isboolean:Bd.lua_isboolean,lua_iscfunction:Bd.lua_iscfunction,lua_isfunction:Bd.lua_isfunction,lua_isinteger:Bd.lua_isinteger,lua_islightuserdata:Bd.lua_islightuserdata,lua_isnil:Bd.lua_isnil,lua_isnone:Bd.lua_isnone,lua_isnoneornil:Bd.lua_isnoneornil,lua_isnumber:Bd.lua_isnumber,lua_isproxy:Bd.lua_isproxy,lua_isstring:Bd.lua_isstring,lua_istable:Bd.lua_istable,lua_isthread:Bd.lua_isthread,lua_isuserdata:Bd.lua_isuserdata,lua_isyieldable:Pf.lua_isyieldable,lua_len:Bd.lua_len,lua_load:Bd.lua_load,lua_newstate:ca.lua_newstate,lua_newtable:Bd.lua_newtable,lua_newthread:ca.lua_newthread,lua_newuserdata:Bd.lua_newuserdata,lua_next:Bd.lua_next,lua_pcall:Bd.lua_pcall,lua_pcallk:Bd.lua_pcallk,lua_pop:Bd.lua_pop,lua_pushboolean:Bd.lua_pushboolean,lua_pushcclosure:Bd.lua_pushcclosure,lua_pushcfunction:Bd.lua_pushcfunction,lua_pushfstring:Bd.lua_pushfstring,lua_pushglobaltable:Bd.lua_pushglobaltable,lua_pushinteger:Bd.lua_pushinteger,lua_pushjsclosure:Bd.lua_pushjsclosure,lua_pushjsfunction:Bd.lua_pushjsfunction,lua_pushlightuserdata:Bd.lua_pushlightuserdata,lua_pushliteral:Bd.lua_pushliteral,lua_pushlstring:Bd.lua_pushlstring,lua_pushnil:Bd.lua_pushnil,lua_pushnumber:Bd.lua_pushnumber,lua_pushstring:Bd.lua_pushstring,lua_pushthread:Bd.lua_pushthread,lua_pushvalue:Bd.lua_pushvalue,lua_pushvfstring:Bd.lua_pushvfstring,lua_rawequal:Bd.lua_rawequal,lua_rawget:Bd.lua_rawget,lua_rawgeti:Bd.lua_rawgeti,lua_rawgetp:Bd.lua_rawgetp,lua_rawlen:Bd.lua_rawlen,lua_rawset:Bd.lua_rawset,lua_rawseti:Bd.lua_rawseti,lua_rawsetp:Bd.lua_rawsetp,lua_register:Bd.lua_register,lua_remove:Bd.lua_remove,lua_replace:Bd.lua_replace,lua_resume:Pf.lua_resume,lua_rotate:Bd.lua_rotate,lua_setallof:Pf.lua_setallof,lua_setfield:Bd.lua_setfield,lua_setglobal:Bd.lua_setglobal,lua_sethook:p_.lua_sethook,lua_seti:Bd.lua_seti,lua_setlocal:p_.lua_setlocal,lua_setmetatable:Bd.lua_setmetatable,lua_settable:Bd.lua_settable,lua_settop:Bd.lua_settop,lua_setupvalue:Bd.lua_setupvalue,lua_setuservalue:Bd.lua_setuservalue,lua_status:Bd.lua_status,lua_stringtonumber:Bd.lua_stringtonumber,lua_toboolean:Bd.lua_toboolean,lua_todataview:Bd.lua_todataview,lua_tointeger:Bd.lua_tointeger,lua_tointegerx:Bd.lua_tointegerx,lua_tojsstring:Bd.lua_tojsstring,lua_tolstring:Bd.lua_tolstring,lua_tonumber:Bd.lua_tonumber,lua_tonumberx:Bd.lua_tonumberx,lua_topointer:Bd.lua_topointer,lua_toproxy:Bd.lua_toproxy,lua_tostring:Bd.lua_tostring,lua_tothread:Bd.lua_tothread,lua_touserdata:Bd.lua_touserdata,lua_type:Bd.lua_type,lua_typename:Bd.lua_typename,lua_upvalueid:Bd.lua_upvalueid,lua_upvaluejoin:Bd.lua_upvaluejoin,lua_version:Bd.lua_version,lua_xmove:Bd.lua_xmove,lua_yield:Pf.lua_yield,lua_yieldk:Pf.lua_yieldk,lua_tocfunction:Bd.lua_tocfunction};const{LUAL_BUFFERSIZE:Gd}=g,{LUA_ERRERR:Kd,LUA_MULTRET:Fd,LUA_REGISTRYINDEX:jd,LUA_SIGNATURE:Hd,LUA_TBOOLEAN:Xd,LUA_TLIGHTUSERDATA:zd,LUA_TNIL:Jd,LUA_TNONE:qd,LUA_TNUMBER:Yd,LUA_TSTRING:Wd,LUA_TTABLE:Zd,LUA_VERSION_NUM:Qd,lua_Debug:$d,lua_absindex:tL,lua_atpanic:eL,lua_call:nL,lua_checkstack:aL,lua_concat:rL,lua_copy:uL,lua_createtable:lL,lua_error:sL,lua_getfield:oL,lua_getinfo:iL,lua_getmetatable:cL,lua_getstack:fL,lua_gettop:_L,lua_insert:pL,lua_isinteger:hL,lua_isnil:dL,lua_isnumber:LL,lua_isstring:gL,lua_istable:AL,lua_len:TL,lua_load:vL,lua_newstate:bL,lua_newtable:OL,lua_next:kL,lua_pcall:mL,lua_pop:EL,lua_pushboolean:UL,lua_pushcclosure:RL,lua_pushcfunction:NL,lua_pushfstring:yL,lua_pushinteger:wL,lua_pushliteral:SL,lua_pushlstring:IL,lua_pushnil:ML,lua_pushstring:PL,lua_pushvalue:xL,lua_pushvfstring:CL,lua_rawequal:DL,lua_rawget:BL,lua_rawgeti:VL,lua_rawlen:GL,lua_rawseti:KL,lua_remove:FL,lua_setfield:jL,lua_setglobal:HL,lua_setmetatable:XL,lua_settop:zL,lua_toboolean:JL,lua_tointeger:qL,lua_tointegerx:YL,lua_tojsstring:WL,lua_tolstring:ZL,lua_tonumber:QL,lua_tonumberx:$L,lua_topointer:tg,lua_tostring:eg,lua_touserdata:ng,lua_type:ag,lua_typename:rg,lua_version:ug}=Vd,{from_userstring:lg,luastring_eq:sg,to_luastring:og,to_uristring:ig}=G,cg=Kd+1,fg=og("_LOADED"),_g=og("_PRELOAD"),pg=og("FILE*"),hg=og("__name"),dg=og("__tostring"),Lg=new Uint8Array(0);class gg{constructor(){this.L=null,this.b=Lg,this.n=0}}const Ag=function(t,e,n){if(0===n||!AL(t,-1))return 0;for(ML(t);kL(t,-2);){if(ag(t,-2)===Wd){if(DL(t,e,-1))return EL(t,1),1;if(Ag(t,e,n-1))return FL(t,-2),SL(t,"."),pL(t,-2),rL(t,3),1}EL(t,1)}return 0},Tg=function(t,e){let n=_L(t);if(iL(t,og("f"),e),oL(t,jd,fg),Ag(t,n+1,2)){let e=eg(t,-1);return 95===e[0]&&71===e[1]&&46===e[2]&&(PL(t,e.subarray(3)),FL(t,-2)),uL(t,-1,n+1),EL(t,2),1}return zL(t,n),0},vg=function(t,e){Tg(t,e)?(yL(t,og("function '%s'"),eg(t,-1)),FL(t,-2)):0!==e.namewhat.length?yL(t,og("%s '%s'"),e.namewhat,e.name):e.what&&109===e.what[0]?SL(t,"main chunk"):e.what&&76===e.what[0]?yL(t,og("function <%s:%d>"),e.short_src,e.linedefined):SL(t,"?")},bg=function(t){let e="PANIC: unprotected error in call to Lua API ("+WL(t,-1)+")";throw new Error(e)},Og=function(t,e,n){let a=new $d;return fL(t,0,a)?(iL(t,og("n"),a),sg(a.namewhat,og("method"))&&0===--e?Eg(t,og("calling '%s' on bad self (%s)"),a.name,n):(null===a.name&&(a.name=Tg(t,a)?eg(t,-1):og("?")),Eg(t,og("bad argument #%d to '%s' (%s)"),e,a.name,n))):Eg(t,og("bad argument #%d (%s)"),e,n)},kg=function(t,e,n){let a;a=qg(t,e,hg)===Wd?eg(t,-1):ag(t,e)===zd?og("light userdata",!0):wg(t,e);let r=yL(t,og("%s expected, got %s"),n,a);return Og(t,e,r)},mg=function(t,e){let n=new $d;fL(t,e,n)&&(iL(t,og("Sl",!0),n),n.currentline>0)?yL(t,og("%s:%d: "),n.short_src,n.currentline):PL(t,og(""))},Eg=function(t,e,...n){return mg(t,1),CL(t,e,n),rL(t,2),sL(t)},Ug=function(t,e,n,a){if(e)return UL(t,1),1;{let e,r;return ML(t),a?(e=a.message,r=-a.errno):(e="Success",r=0),n?yL(t,og("%s: %s"),n,og(e)):PL(t,og(e)),wL(t,r),3}},Rg=function(t,e){return oL(t,jd,e)},Ng=function(t,e,n){let a=ng(t,e);return null!==a&&cL(t,e)?(Rg(t,n),DL(t,-1,-2)||(a=null),EL(t,2),a):null},yg=function(t,e,n){kg(t,e,rg(t,n))},wg=function(t,e){return rg(t,ag(t,e))},Sg=function(t,e){let n=ZL(t,e);return null==n&&yg(t,e,Wd),n},Ig=Sg,Mg=function(t,e,n){return ag(t,e)<=0?null===n?null:lg(n):Sg(t,e)},Pg=Mg,xg=function(t,e){let n=$L(t,e);return!1===n&&yg(t,e,Yd),n},Cg=function(t,e){let n=YL(t,e);return!1===n&&function(t,e){LL(t,e)?Og(t,e,og("number has no integer representation",!0)):yg(t,e,Yd)}(t,e),n},Dg=function(t,e){let n=t.n+e;if(t.b.length<n){let e=Math.max(2*t.b.length,n),a=new Uint8Array(e);a.set(t.b),t.b=a}return t.b.subarray(t.n,n)},Bg=function(t,e){e.L=t,e.b=Lg},Vg=function(t,e,n){if(n>0){e=lg(e),Dg(t,n).set(e.subarray(0,n)),Fg(t,n)}},Gg=function(t,e){e=lg(e),Vg(t,e,e.length)},Kg=function(t){IL(t.L,t.b,t.n),t.n=0,t.b=Lg},Fg=function(t,e){t.n+=e},jg=function(t,e,n,a){return ag(t,n)<=0?a:e(t,n)},Hg=function(t,e){let n=e.string;return e.string=null,n},Xg=function(t,e,n,a,r){return vL(t,Hg,{string:e},a,r)},zg=function(t,e,n,a){return Xg(t,e,0,a,null)},Jg=function(t,e){return zg(t,e,e.length,e)},qg=function(t,e,n){if(cL(t,e)){PL(t,n);let e=BL(t,-2);return e===Jd?EL(t,2):FL(t,-2),e}return Jd},Yg=function(t,e,n){return e=tL(t,e),qg(t,e,n)!==Jd&&(xL(t,e),nL(t,1,1),!0)},Wg=og("%I"),Zg=og("%f"),Qg=function(t,e,n){var a=n>>>0,r=e.length,u=t.length+1-r;t:for(;a<u;a++){for(let n=0;n<r;n++)if(t[a+n]!==e[n])continue t;return a}return-1},$g=function(t,e,n){return oL(t,e,n)===Zd||(EL(t,1),e=tL(t,e),OL(t),xL(t,-1),jL(t,e,n),!1)},tA=function(t,e,n){eA(t,n,og("too many upvalues",!0));for(let a in e){for(let e=0;e<n;e++)xL(t,-n);RL(t,e[a],n),jL(t,-(n+2),og(a))}EL(t,n)},eA=function(t,e,n){aL(t,e)||(n?Eg(t,og("stack overflow (%s)"),n):Eg(t,og("stack overflow",!0)))},nA=function(t,e,n,a){let r=a.message,u=eg(t,n).subarray(1);return yL(t,og("cannot %s %s: %s"),og(e),u,og(r)),FL(t,n),cg};let aA;const rA=[239,187,191],uA=function(t){let e=function(t){let e;t.n=0;let n=0;do{if(e=aA(t),null===e||e!==rA[n])return e;n++,t.buff[t.n++]=e}while(n<rA.length);return t.n=0,aA(t)}(t);if(35===e){do{e=aA(t)}while(e&&10!==e);return{skipped:!0,c:aA(t)}}return{skipped:!1,c:e}};let lA;{class t{constructor(){this.n=NaN,this.f=null,this.buff=new Uint8Array(1024),this.pos=0,this.err=void 0}}const e=function(t,e){let n=e;if(null!==n.f&&n.n>0){let t=n.n;return n.n=0,n.f=n.f.subarray(n.pos),n.buff.subarray(0,t)}let a=n.f;return n.f=null,a};aA=function(t){return t.pos<t.f.length?t.f[t.pos++]:null},lA=function(n,a,r){let u=new t,l=_L(n)+1;if(null===a)throw new Error("Can't read stdin in the browser");{yL(n,og("@%s"),a);let t=ig(a),e=new XMLHttpRequest;if(e.open("GET",t,!1),"undefined"==typeof window&&(e.responseType="arraybuffer"),e.send(),!(e.status>=200&&e.status<=299))return u.err=e.status,nA(n,"open",l,{message:`${e.status}: ${e.statusText}`});"string"==typeof e.response?u.f=og(e.response):u.f=new Uint8Array(e.response)}let s=uA(u);s.c===Hd[0]&&a||s.skipped&&(u.buff[u.n++]=10),null!==s.c&&(u.buff[u.n++]=s.c);let o=vL(n,e,u,eg(n,-1),r),i=u.err;return i?(zL(n,l),nA(n,"read",l,i)):(FL(n,l),o)}}const sA=function(t,e){return lA(t,e,null)},oA=function(t,e,n){let a=ug(t);72!=n&&Eg(t,og("core and library have incompatible numeric types")),a!=ug(null)?Eg(t,og("multiple Lua VMs detected")):a!==e&&Eg(t,og("version mismatch: app. needs %f, Lua core provides %f"),e,a)};var iA={LUA_ERRFILE:cg,LUA_FILEHANDLE:pg,LUA_LOADED_TABLE:fg,LUA_NOREF:-2,LUA_PRELOAD_TABLE:_g,LUA_REFNIL:-1,luaL_Buffer:gg,luaL_addchar:function(t,e){Dg(t,1),t.b[t.n++]=e},luaL_addlstring:Vg,luaL_addsize:Fg,luaL_addstring:Gg,luaL_addvalue:function(t){let e=t.L,n=eg(e,-1);Vg(t,n,n.length),EL(e,1)},luaL_argcheck:function(t,e,n,a){e||Og(t,n,a)},luaL_argerror:Og,luaL_buffinit:Bg,luaL_buffinitsize:function(t,e,n){return Bg(t,e),Dg(e,n)},luaL_callmeta:Yg,luaL_checkany:function(t,e){ag(t,e)===qd&&Og(t,e,og("value expected",!0))},luaL_checkinteger:Cg,luaL_checklstring:Sg,luaL_checknumber:xg,luaL_checkoption:function(t,e,n,a){let r=null!==n?Pg(t,e,n):Ig(t,e);for(let t=0;a[t];t++)if(sg(a[t],r))return t;return Og(t,e,yL(t,og("invalid option '%s'"),r))},luaL_checkstack:eA,luaL_checkstring:Ig,luaL_checktype:function(t,e,n){ag(t,e)!==n&&yg(t,e,n)},luaL_checkudata:function(t,e,n){let a=Ng(t,e,n);return null===a&&kg(t,e,n),a},luaL_checkversion:function(t){oA(t,Qd,72)},luaL_checkversion_:oA,luaL_dofile:function(t,e){return sA(t,e)||mL(t,0,Fd,0)},luaL_dostring:function(t,e){return Jg(t,e)||mL(t,0,Fd,0)},luaL_error:Eg,luaL_execresult:function(t,e){let n,a;if(null===e)return UL(t,1),SL(t,"exit"),wL(t,0),3;if(e.status)n="exit",a=e.status;else{if(!e.signal)return Ug(t,0,null,e);n="signal",a=e.signal}return ML(t),SL(t,n),wL(t,a),3},luaL_fileresult:Ug,luaL_getmetafield:qg,luaL_getmetatable:Rg,luaL_getsubtable:$g,luaL_gsub:function(t,e,n,a){let r,u=new gg;for(Bg(t,u);(r=Qg(e,n))>=0;)Vg(u,e,r),Gg(u,a),e=e.subarray(r+n.length);return Gg(u,e),Kg(u),eg(t,-1)},luaL_len:function(t,e){TL(t,e);let n=YL(t,-1);return!1===n&&Eg(t,og("object length is not an integer",!0)),EL(t,1),n},luaL_loadbuffer:zg,luaL_loadbufferx:Xg,luaL_loadfile:sA,luaL_loadfilex:lA,luaL_loadstring:Jg,luaL_newlib:function(t,e){lL(t),tA(t,e,0)},luaL_newlibtable:function(t){lL(t)},luaL_newmetatable:function(t,e){return Rg(t,e)!==Jd?0:(EL(t,1),lL(t,0,2),PL(t,e),jL(t,-2,hg),xL(t,-1),jL(t,jd,e),1)},luaL_newstate:function(){let t=bL();return t&&eL(t,bg),t},luaL_opt:jg,luaL_optinteger:function(t,e,n){return jg(t,Cg,e,n)},luaL_optlstring:Mg,luaL_optnumber:function(t,e,n){return jg(t,xg,e,n)},luaL_optstring:Pg,luaL_prepbuffer:function(t){return Dg(t,Gd)},luaL_prepbuffsize:Dg,luaL_pushresult:Kg,luaL_pushresultsize:function(t,e){Fg(t,e),Kg(t)},luaL_ref:function(t,e){let n;return dL(t,-1)?(EL(t,1),-1):(e=tL(t,e),VL(t,e,0),n=qL(t,-1),EL(t,1),0!==n?(VL(t,e,n),KL(t,e,0)):n=GL(t,e)+1,KL(t,e,n),n)},luaL_requiref:function(t,e,n,a){$g(t,jd,fg),oL(t,-1,e),JL(t,-1)||(EL(t,1),NL(t,n),PL(t,e),nL(t,1,1),xL(t,-1),jL(t,-3,e)),FL(t,-2),a&&(xL(t,-1),HL(t,e))},luaL_setfuncs:tA,luaL_setmetatable:function(t,e){Rg(t,e),XL(t,-2)},luaL_testudata:Ng,luaL_tolstring:function(t,e){if(Yg(t,e,dg))gL(t,-1)||Eg(t,og("'__tostring' must return a string"));else{switch(ag(t,e)){case Yd:hL(t,e)?yL(t,Wg,qL(t,e)):yL(t,Zg,QL(t,e));break;case Wd:xL(t,e);break;case Xd:SL(t,JL(t,e)?"true":"false");break;case Jd:SL(t,"nil");break;default:{let n=qg(t,e,hg),a=n===Wd?eg(t,-1):wg(t,e);yL(t,og("%s: %p"),a,tg(t,e)),n!==Jd&&FL(t,-2);break}}}return ZL(t,-1)},luaL_traceback:function(t,e,n,a){let r=new $d,u=_L(t),l=function(t){let e=new $d,n=1,a=1;for(;fL(t,a,e);)n=a,a*=2;for(;n<a;){let r=Math.floor((n+a)/2);fL(t,r,e)?n=r+1:a=r}return a-1}(e),s=l-a>21?10:-1;for(n&&yL(t,og("%s\n"),n),eA(t,10,null),SL(t,"stack traceback:");fL(e,a++,r);)0==s--?(SL(t,"\n\t..."),a=l-11+1):(iL(e,og("Slnt",!0),r),yL(t,og("\n\t%s:"),r.short_src),r.currentline>0&&SL(t,`${r.currentline}:`),SL(t," in "),vg(t,r),r.istailcall&&SL(t,"\n\t(...tail calls..)"),rL(t,_L(t)-u));rL(t,_L(t)-u)},luaL_typename:wg,luaL_unref:function(t,e,n){n>=0&&(e=tL(t,e),VL(t,e,0),KL(t,e,n),wL(t,n),KL(t,e,0))},luaL_where:mg,lua_writestringerror:function(){for(let t=0;t<arguments.length;t++){let e=arguments[t];do{let t=/([^\n]*)\n?([\d\D]*)/.exec(e);console.error(t[1]),e=t[2]}while(""!==e)}}};const{LUA_MULTRET:cA,LUA_OK:fA,LUA_TFUNCTION:_A,LUA_TNIL:pA,LUA_TNONE:hA,LUA_TNUMBER:dA,LUA_TSTRING:LA,LUA_TTABLE:gA,LUA_VERSION:AA,LUA_YIELD:TA,lua_call:vA,lua_callk:bA,lua_concat:OA,lua_error:kA,lua_getglobal:mA,lua_geti:EA,lua_getmetatable:UA,lua_gettop:RA,lua_insert:NA,lua_isnil:yA,lua_isnone:wA,lua_isstring:SA,lua_load:IA,lua_next:MA,lua_pcallk:PA,lua_pop:xA,lua_pushboolean:CA,lua_pushcfunction:DA,lua_pushglobaltable:BA,lua_pushinteger:VA,lua_pushliteral:GA,lua_pushnil:KA,lua_pushstring:FA,lua_pushvalue:jA,lua_rawequal:HA,lua_rawget:XA,lua_rawlen:zA,lua_rawset:JA,lua_remove:qA,lua_replace:YA,lua_rotate:WA,lua_setfield:ZA,lua_setmetatable:QA,lua_settop:$A,lua_setupvalue:tT,lua_stringtonumber:eT,lua_toboolean:nT,lua_tolstring:aT,lua_tostring:rT,lua_type:uT,lua_typename:lT}=Vd,{luaL_argcheck:sT,luaL_checkany:oT,luaL_checkinteger:iT,luaL_checkoption:cT,luaL_checkstack:fT,luaL_checktype:_T,luaL_error:pT,luaL_getmetafield:hT,luaL_loadbufferx:dT,luaL_loadfile:LT,luaL_loadfilex:gT,luaL_optinteger:AT,luaL_optstring:TT,luaL_setfuncs:vT,luaL_tolstring:bT,luaL_where:OT}=iA,{to_jsstring:kT,to_luastring:mT}=G;let ET,UT;if("function"==typeof TextDecoder){let t="",e=new TextDecoder("utf-8");ET=function(n){t+=e.decode(n,{stream:!0})};let n=new Uint8Array(0);UT=function(){t+=e.decode(n),console.log(t),t=""}}else{let t=[];ET=function(e){try{e=kT(e)}catch(t){let n=new Uint8Array(e.length);n.set(e),e=n}t.push(e)},UT=function(){console.log.apply(console.log,t),t=[]}}const RT=["stop","restart","collect","count","step","setpause","setstepmul","isrunning"].map(t=>mT(t)),NT=function(t){return _T(t,1,gA),$A(t,2),MA(t,1)?2:(KA(t),1)},yT=function(t){let e=iT(t,2)+1;return VA(t,e),EA(t,1,e)===pA?1:2},wT=function(t){let e=AT(t,2,1);return $A(t,1),uT(t,1)===LA&&e>0&&(OT(t,e),jA(t,1),OA(t,2)),kA(t)},ST=function(t,e,n){return e!==fA&&e!==TA?(CA(t,0),jA(t,-2),2):RA(t)-n},IT=function(t,e,n){return e===fA?(0!==n&&(jA(t,n),tT(t,-2,1)||xA(t,1)),1):(KA(t),NA(t,-2),2)},MT=function(t,e){return fT(t,2,"too many nested functions"),jA(t,1),vA(t,0,1),yA(t,-1)?(xA(t,1),null):(SA(t,-1)||pT(t,mT("reader function must return a string")),YA(t,5),rT(t,5))},PT=function(t,e,n){return RA(t)-1},xT={assert:function(t){return nT(t,1)?RA(t):(oT(t,1),qA(t,1),GA(t,"assertion failed!"),$A(t,1),wT(t))},collectgarbage:function(t){cT(t,1,"collect",RT),AT(t,2,0),pT(t,mT("lua_gc not implemented"))},dofile:function(t){let e=TT(t,1,null);return $A(t,1),LT(t,e)!==fA?kA(t):(bA(t,0,cA,0,PT),PT(t))},error:wT,getmetatable:function(t){return oT(t,1),UA(t,1)?(hT(t,1,mT("__metatable",!0)),1):(KA(t),1)},ipairs:function(t){return oT(t,1),DA(t,yT),jA(t,1),VA(t,0),3},load:function(t){let e,n=rT(t,1),a=TT(t,3,"bt"),r=wA(t,4)?0:4;if(null!==n){let r=TT(t,2,n);e=dT(t,n,n.length,r,a)}else{let n=TT(t,2,"=(load)");_T(t,1,_A),$A(t,5),e=IA(t,MT,null,n,a)}return IT(t,e,r)},loadfile:function(t){let e=TT(t,1,null),n=TT(t,2,null),a=wA(t,3)?0:3,r=gT(t,e,n);return IT(t,r,a)},next:NT,pairs:function(t){return function(t,e,n,a){return oT(t,1),hT(t,1,e)===pA?(DA(t,a),jA(t,1),n?VA(t,0):KA(t)):(jA(t,1),vA(t,1,3)),3}(t,mT("__pairs",!0),0,NT)},pcall:function(t){oT(t,1),CA(t,1),NA(t,1);let e=PA(t,RA(t)-2,cA,0,0,ST);return ST(t,e,0)},print:function(t){let e=RA(t);mA(t,mT("tostring",!0));for(let n=1;n<=e;n++){jA(t,-1),jA(t,n),vA(t,1,1);let e=aT(t,-1);if(null===e)return pT(t,mT("'tostring' must return a string to 'print'"));n>1&&ET(mT("\t")),ET(e),xA(t,1)}return UT(),0},rawequal:function(t){return oT(t,1),oT(t,2),CA(t,HA(t,1,2)),1},rawget:function(t){return _T(t,1,gA),oT(t,2),$A(t,2),XA(t,1),1},rawlen:function(t){let e=uT(t,1);return sT(t,e===gA||e===LA,1,"table or string expected"),VA(t,zA(t,1)),1},rawset:function(t){return _T(t,1,gA),oT(t,2),oT(t,3),$A(t,3),JA(t,1),1},select:function(t){let e=RA(t);if(uT(t,1)===LA&&35===rT(t,1)[0])return VA(t,e-1),1;{let n=iT(t,1);return n<0?n=e+n:n>e&&(n=e),sT(t,1<=n,1,"index out of range"),e-n}},setmetatable:function(t){let e=uT(t,2);return _T(t,1,gA),sT(t,e===pA||e===gA,2,"nil or table expected"),hT(t,1,mT("__metatable",!0))!==pA?pT(t,mT("cannot change a protected metatable")):($A(t,2),QA(t,1),1)},tonumber:function(t){if(uT(t,2)<=0){if(oT(t,1),uT(t,1)===dA)return $A(t,1),1;{let e=rT(t,1);if(null!==e&&eT(t,e)===e.length+1)return 1}}else{let e=iT(t,2);_T(t,1,LA);let n=rT(t,1);sT(t,2<=e&&e<=36,2,"base out of range");let a=function(t,e){try{t=kT(t)}catch(t){return null}let n=/^[\t\v\f \n\r]*([+-]?)0*([0-9A-Za-z]+)[\t\v\f \n\r]*$/.exec(t);if(!n)return null;let a=parseInt(n[1]+n[2],e);return isNaN(a)?null:0|a}(n,e);if(null!==a)return VA(t,a),1}return KA(t),1},tostring:function(t){return oT(t,1),bT(t,1),1},type:function(t){let e=uT(t,1);return sT(t,e!==hA,1,"value expected"),FA(t,lT(t,e)),1},xpcall:function(t){let e=RA(t);_T(t,2,_A),CA(t,1),jA(t,1),WA(t,3,2);let n=PA(t,e-2,cA,2,2,ST);return ST(t,n,2)}};var CT={luaopen_base:function(t){return BA(t),vT(t,xT,0),jA(t,-1),ZA(t,-2,mT("_G")),GA(t,AA),ZA(t,-2,mT("_VERSION")),1}};const{LUA_OK:DT,LUA_TFUNCTION:BT,LUA_TSTRING:VT,LUA_YIELD:GT,lua_Debug:KT,lua_checkstack:FT,lua_concat:jT,lua_error:HT,lua_getstack:XT,lua_gettop:zT,lua_insert:JT,lua_isyieldable:qT,lua_newthread:YT,lua_pop:WT,lua_pushboolean:ZT,lua_pushcclosure:QT,lua_pushliteral:$T,lua_pushthread:tv,lua_pushvalue:ev,lua_resume:nv,lua_status:av,lua_tothread:rv,lua_type:uv,lua_upvalueindex:lv,lua_xmove:sv,lua_yield:ov}=Vd,{luaL_argcheck:iv,luaL_checktype:cv,luaL_newlib:fv,luaL_where:_v}=iA,pv=function(t){let e=rv(t,1);return iv(t,e,1,"thread expected"),e},hv=function(t,e,n){if(!FT(e,n))return $T(t,"too many arguments to resume"),-1;if(av(e)===DT&&0===zT(e))return $T(t,"cannot resume dead coroutine"),-1;sv(t,e,n);let a=nv(e,t,n);if(a===DT||a===GT){let n=zT(e);return FT(t,n+1)?(sv(e,t,n),n):(WT(e,n),$T(t,"too many results to resume"),-1)}return sv(e,t,1),-1},dv=function(t){let e=rv(t,lv(1)),n=hv(t,e,zT(t));return n<0?(uv(t,-1)===VT&&(_v(t,1),JT(t,-2),jT(t,2)),HT(t)):n},Lv=function(t){cv(t,1,BT);let e=YT(t);return ev(t,1),sv(t,e,1),1},gv={create:Lv,isyieldable:function(t){return ZT(t,qT(t)),1},resume:function(t){let e=pv(t),n=hv(t,e,zT(t)-1);return n<0?(ZT(t,0),JT(t,-2),2):(ZT(t,1),JT(t,-(n+1)),n+1)},running:function(t){return ZT(t,tv(t)),2},status:function(t){let e=pv(t);if(t===e)$T(t,"running");else switch(av(e)){case GT:$T(t,"suspended");break;case DT:{let n=new KT;XT(e,0,n)>0?$T(t,"normal"):0===zT(e)?$T(t,"dead"):$T(t,"suspended");break}default:$T(t,"dead")}return 1},wrap:function(t){return Lv(t),QT(t,dv,1),1},yield:function(t){return ov(t,zT(t))}};var Av={luaopen_coroutine:function(t){return fv(t,gv),1}};const{LUA_MAXINTEGER:Tv}=g,{LUA_OPEQ:vv,LUA_OPLT:bv,LUA_TFUNCTION:Ov,LUA_TNIL:kv,LUA_TTABLE:mv,lua_call:Ev,lua_checkstack:Uv,lua_compare:Rv,lua_createtable:Nv,lua_geti:yv,lua_getmetatable:wv,lua_gettop:Sv,lua_insert:Iv,lua_isnil:Mv,lua_isnoneornil:Pv,lua_isstring:xv,lua_pop:Cv,lua_pushinteger:Dv,lua_pushnil:Bv,lua_pushstring:Vv,lua_pushvalue:Gv,lua_rawget:Kv,lua_setfield:Fv,lua_seti:jv,lua_settop:Hv,lua_toboolean:Xv,lua_type:zv}=Vd,{luaL_Buffer:Jv,luaL_addlstring:qv,luaL_addvalue:Yv,luaL_argcheck:Wv,luaL_buffinit:Zv,luaL_checkinteger:Qv,luaL_checktype:$v,luaL_error:tb,luaL_len:eb,luaL_newlib:nb,luaL_opt:ab,luaL_optinteger:rb,luaL_optlstring:ub,luaL_pushresult:lb,luaL_typename:sb}=iA,{to_luastring:ob}=G,ib=function(t,e,n){return Vv(t,e),Kv(t,-n)!==kv},cb=function(t,e,n){if(zv(t,e)!==mv){let a=1;!wv(t,e)||1&n&&!ib(t,ob("__index",!0),++a)||2&n&&!ib(t,ob("__newindex",!0),++a)||4&n&&!ib(t,ob("__len",!0),++a)?$v(t,e,mv):Cv(t,a)}},fb=function(t,e,n){return cb(t,e,4|n),eb(t,e)},_b=function(t,e,n){yv(t,1,n),xv(t,-1)||tb(t,ob("invalid value (%s) at index %d in table for 'concat'"),sb(t,-1),n),Yv(e)},pb=function(t,e,n){jv(t,1,e),jv(t,1,n)},hb=function(t,e,n){if(Mv(t,2))return Rv(t,e,n,bv);{Gv(t,2),Gv(t,e-1),Gv(t,n-2),Ev(t,2,1);let a=Xv(t,-1);return Cv(t,1),a}},db=function(t,e,n){let a=e,r=n-1;for(;;){for(;yv(t,1,++a),hb(t,-1,-2);)a==n-1&&tb(t,ob("invalid order function for sorting")),Cv(t,1);for(;yv(t,1,--r),hb(t,-3,-1);)r<a&&tb(t,ob("invalid order function for sorting")),Cv(t,1);if(r<a)return Cv(t,1),pb(t,n-1,a),a;pb(t,a,r)}},Lb=function(t,e,n){let a=Math.floor((e-t)/4),r=n%(2*a)+(t+a);return xy.lua_assert(t+a<=r&&r<=e-a),r},gb=function(t,e,n,a){for(;e<n;){if(yv(t,1,e),yv(t,1,n),hb(t,-1,-2)?pb(t,e,n):Cv(t,2),n-e==1)return;let r,u;if(r=n-e<100||0===a?Math.floor((e+n)/2):Lb(e,n,a),yv(t,1,r),yv(t,1,e),hb(t,-2,-1)?pb(t,r,e):(Cv(t,1),yv(t,1,n),hb(t,-1,-2)?pb(t,r,n):Cv(t,2)),n-e==2)return;yv(t,1,r),Gv(t,-1),yv(t,1,n-1),pb(t,r,n-1),r=db(t,e,n),r-e<n-r?(gb(t,e,r-1,a),u=r-e,e=r+1):(gb(t,r+1,n,a),u=n-r,n=r-1),(n-e)/128>u&&(a=Math.floor(4294967296*Math.random()))}},Ab={concat:function(t){let e=fb(t,1,1),n=ub(t,2,""),a=n.length,r=rb(t,3,1);e=rb(t,4,e);let u=new Jv;for(Zv(t,u);r<e;r++)_b(t,u,r),qv(u,n,a);return r===e&&_b(t,u,r),lb(u),1},insert:function(t){let e,n=fb(t,1,3)+1;switch(Sv(t)){case 2:e=n;break;case 3:e=Qv(t,2),Wv(t,1<=e&&e<=n,2,"position out of bounds");for(let a=n;a>e;a--)yv(t,1,a-1),jv(t,1,a);break;default:return tb(t,"wrong number of arguments to 'insert'")}return jv(t,1,e),0},move:function(t){let e=Qv(t,2),n=Qv(t,3),a=Qv(t,4),r=Pv(t,5)?1:5;if(cb(t,1,1),cb(t,r,2),n>=e){Wv(t,e>0||n<Tv+e,3,"too many elements to move");let u=n-e+1;if(Wv(t,a<=Tv-u+1,4,"destination wrap around"),a>n||a<=e||1!==r&&1!==Rv(t,1,r,vv))for(let n=0;n<u;n++)yv(t,1,e+n),jv(t,r,a+n);else for(let n=u-1;n>=0;n--)yv(t,1,e+n),jv(t,r,a+n)}return Gv(t,r),1},pack:function(t){let e=Sv(t);Nv(t,e,1),Iv(t,1);for(let n=e;n>=1;n--)jv(t,1,n);return Dv(t,e),Fv(t,1,ob("n")),1},remove:function(t){let e=fb(t,1,3),n=rb(t,2,e);for(n!==e&&Wv(t,1<=n&&n<=e+1,1,"position out of bounds"),yv(t,1,n);n<e;n++)yv(t,1,n+1),jv(t,1,n);return Bv(t),jv(t,1,n),1},sort:function(t){let e=fb(t,1,3);return e>1&&(Wv(t,e<Tv,1,"array too big"),Pv(t,2)||$v(t,2,Ov),Hv(t,2),gb(t,1,e,0)),0},unpack:function(t){let e=rb(t,2,1),n=ab(t,Qv,3,eb(t,1));if(e>n)return 0;let a=n-e;if(a>=Number.MAX_SAFE_INTEGER||!Uv(t,++a))return tb(t,ob("too many results to unpack"));for(;e<n;e++)yv(t,1,e);return yv(t,1,n),a}};var Tb={luaopen_table:function(t){return nb(t,Ab),1}};const{LUA_TNIL:vb,LUA_TTABLE:bb,lua_close:Ob,lua_createtable:kb,lua_getfield:mb,lua_isboolean:Eb,lua_isnoneornil:Ub,lua_pop:Rb,lua_pushboolean:Nb,lua_pushfstring:yb,lua_pushinteger:wb,lua_pushliteral:Sb,lua_pushnil:Ib,lua_pushnumber:Mb,lua_pushstring:Pb,lua_setfield:xb,lua_settop:Cb,lua_toboolean:Db,lua_tointegerx:Bb}=Vd,{luaL_Buffer:Vb,luaL_addchar:Gb,luaL_addstring:Kb,luaL_argerror:Fb,luaL_buffinit:jb,luaL_checkinteger:Hb,luaL_checkstring:Xb,luaL_checktype:zb,luaL_error:Jb,luaL_execresult:qb,luaL_fileresult:Yb,luaL_newlib:Wb,luaL_optinteger:Zb,luaL_optlstring:Qb,luaL_optstring:$b,luaL_pushresult:tO}=iA,{luastring_eq:eO,to_jsstring:nO,to_luastring:aO}=G,rO=aO("aAbBcCdDeFhHIjklmMnpPrRStTuUwWxXyYzZ%"),uO=function(t,e,n){wb(t,n),xb(t,-2,aO(e,!0))},lO=function(t,e,n){uO(t,"sec",n?e.getUTCSeconds():e.getSeconds()),uO(t,"min",n?e.getUTCMinutes():e.getMinutes()),uO(t,"hour",n?e.getUTCHours():e.getHours()),uO(t,"day",n?e.getUTCDate():e.getDate()),uO(t,"month",(n?e.getUTCMonth():e.getMonth())+1),uO(t,"year",n?e.getUTCFullYear():e.getFullYear()),uO(t,"wday",(n?e.getUTCDay():e.getDay())+1),uO(t,"yday",Math.floor((e-new Date(e.getFullYear(),0,0))/864e5))},sO=Number.MAX_SAFE_INTEGER/2,oO=function(t,e,n,a){let r=mb(t,-1,aO(e,!0)),u=Bb(t,-1);if(!1===u){if(r!==vb)return Jb(t,aO("field '%s' is not an integer"),e);if(n<0)return Jb(t,aO("field '%s' missing in date table"),e);u=n}else{if(!(-sO<=u&&u<=sO))return Jb(t,aO("field '%s' is out-of-bound"),e);u-=a}return Rb(t,1),u},iO={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map(t=>aO(t)),shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>aO(t)),months:["January","February","March","April","May","June","July","August","September","October","November","December"].map(t=>aO(t)),shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(t=>aO(t)),AM:aO("AM"),PM:aO("PM"),am:aO("am"),pm:aO("pm"),formats:{c:aO("%a %b %e %H:%M:%S %Y"),D:aO("%m/%d/%y"),F:aO("%Y-%m-%d"),R:aO("%H:%M"),r:aO("%I:%M:%S %p"),T:aO("%H:%M:%S"),X:aO("%T"),x:aO("%D")}},cO=function(t,e){let n=t.getDay();"monday"===e&&(0===n?n=6:n--);let a=(t-new Date(t.getFullYear(),0,1))/864e5;return Math.floor((a+7-n)/7)},fO=function(t,e,n){e<10&&Gb(t,n),Kb(t,aO(String(e)))},_O=function(t,e,n,a){let r=0;for(;r<n.length;)if(37!==n[r])Gb(e,n[r++]);else{r++;let u=pO(t,n,r);switch(n[r]){case 37:Gb(e,37);break;case 65:Kb(e,iO.days[a.getDay()]);break;case 66:Kb(e,iO.months[a.getMonth()]);break;case 67:fO(e,Math.floor(a.getFullYear()/100),48);break;case 68:_O(t,e,iO.formats.D,a);break;case 70:_O(t,e,iO.formats.F,a);break;case 72:fO(e,a.getHours(),48);break;case 73:fO(e,(a.getHours()+11)%12+1,48);break;case 77:fO(e,a.getMinutes(),48);break;case 80:Kb(e,a.getHours()<12?iO.am:iO.pm);break;case 82:_O(t,e,iO.formats.R,a);break;case 83:fO(e,a.getSeconds(),48);break;case 84:_O(t,e,iO.formats.T,a);break;case 85:fO(e,cO(a,"sunday"),48);break;case 87:fO(e,cO(a,"monday"),48);break;case 88:_O(t,e,iO.formats.X,a);break;case 89:Kb(e,aO(String(a.getFullYear())));break;case 90:{let t=a.toString().match(/\(([\w\s]+)\)/);t&&Kb(e,aO(t[1]));break}case 97:Kb(e,iO.shortDays[a.getDay()]);break;case 98:case 104:Kb(e,iO.shortMonths[a.getMonth()]);break;case 99:_O(t,e,iO.formats.c,a);break;case 100:fO(e,a.getDate(),48);break;case 101:fO(e,a.getDate(),32);break;case 106:{let t=Math.floor((a-new Date(a.getFullYear(),0,1))/864e5);t<100&&(t<10&&Gb(e,48),Gb(e,48)),Kb(e,aO(String(t)));break}case 107:fO(e,a.getHours(),32);break;case 108:fO(e,(a.getHours()+11)%12+1,32);break;case 109:fO(e,a.getMonth()+1,48);break;case 110:Gb(e,10);break;case 112:Kb(e,a.getHours()<12?iO.AM:iO.PM);break;case 114:_O(t,e,iO.formats.r,a);break;case 115:Kb(e,aO(String(Math.floor(a/1e3))));break;case 116:Gb(e,8);break;case 117:{let t=a.getDay();Kb(e,aO(String(0===t?7:t)));break}case 119:Kb(e,aO(String(a.getDay())));break;case 120:_O(t,e,iO.formats.x,a);break;case 121:fO(e,a.getFullYear()%100,48);break;case 122:{let t=a.getTimezoneOffset();t>0?Gb(e,45):(t=-t,Gb(e,43)),fO(e,Math.floor(t/60),48),fO(e,t%60,48);break}}r+=u}},pO=function(t,e,n){let a=rO,r=0,u=1;for(;r<a.length&&u<=e.length-n;r+=u)if(a[r]==="|".charCodeAt(0))u++;else if(eO(e.subarray(n,n+u),a.subarray(r,r+u)))return u;Fb(t,1,yb(t,aO("invalid conversion specifier '%%%s'"),e))},hO=function(t,e){return Hb(t,e)},dO={date:function(t){let e=Qb(t,1,"%c"),n=Ub(t,2)?new Date:new Date(1e3*hO(t,2)),a=!1,r=0;if(e[r]==="!".charCodeAt(0)&&(a=!0,r++),e[r]==="*".charCodeAt(0)&&e[r+1]==="t".charCodeAt(0))kb(t,0,9),lO(t,n,a);else{new Uint8Array(4)[0]="%".charCodeAt(0);let a=new Vb;jb(t,a),_O(t,a,e,n),tO(a)}return 1},difftime:function(t){let e=hO(t,1),n=hO(t,2);return Mb(t,e-n),1},time:function(t){let e;return Ub(t,1)?e=new Date:(zb(t,1,bb),Cb(t,1),e=new Date(oO(t,"year",-1,0),oO(t,"month",-1,1),oO(t,"day",-1,0),oO(t,"hour",12,0),oO(t,"min",0,0),oO(t,"sec",0,0)),lO(t,e)),wb(t,Math.floor(e/1e3)),1},clock:function(t){return Mb(t,performance.now()/1e3),1}};var LO={luaopen_os:function(t){return Wb(t,dO),1}},gO=L((function(t,e){!function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(t){return r(l(t),arguments)}function a(t,e){return n.apply(null,[t].concat(e||[]))}function r(e,a){var r,u,l,s,o,i,c,f,_,p=1,h=e.length,d="";for(u=0;u<h;u++)if("string"==typeof e[u])d+=e[u];else if("object"==typeof e[u]){if((s=e[u]).keys)for(r=a[p],l=0;l<s.keys.length;l++){if(null==r)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[l],s.keys[l-1]));r=r[s.keys[l]]}else r=s.param_no?a[s.param_no]:a[p++];if(t.not_type.test(s.type)&&t.not_primitive.test(s.type)&&r instanceof Function&&(r=r()),t.numeric_arg.test(s.type)&&"number"!=typeof r&&isNaN(r))throw new TypeError(n("[sprintf] expecting number but found %T",r));switch(t.number.test(s.type)&&(f=r>=0),s.type){case"b":r=parseInt(r,10).toString(2);break;case"c":r=String.fromCharCode(parseInt(r,10));break;case"d":case"i":r=parseInt(r,10);break;case"j":r=JSON.stringify(r,null,s.width?parseInt(s.width):0);break;case"e":r=s.precision?parseFloat(r).toExponential(s.precision):parseFloat(r).toExponential();break;case"f":r=s.precision?parseFloat(r).toFixed(s.precision):parseFloat(r);break;case"g":r=s.precision?String(Number(r.toPrecision(s.precision))):parseFloat(r);break;case"o":r=(parseInt(r,10)>>>0).toString(8);break;case"s":r=String(r),r=s.precision?r.substring(0,s.precision):r;break;case"t":r=String(!!r),r=s.precision?r.substring(0,s.precision):r;break;case"T":r=Object.prototype.toString.call(r).slice(8,-1).toLowerCase(),r=s.precision?r.substring(0,s.precision):r;break;case"u":r=parseInt(r,10)>>>0;break;case"v":r=r.valueOf(),r=s.precision?r.substring(0,s.precision):r;break;case"x":r=(parseInt(r,10)>>>0).toString(16);break;case"X":r=(parseInt(r,10)>>>0).toString(16).toUpperCase()}t.json.test(s.type)?d+=r:(!t.number.test(s.type)||f&&!s.sign?_="":(_=f?"+":"-",r=r.toString().replace(t.sign,"")),i=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",c=s.width-(_+r).length,o=s.width&&c>0?i.repeat(c):"",d+=s.align?_+r+o:"0"===i?_+o+r:o+_+r)}return d}var u=Object.create(null);function l(e){if(u[e])return u[e];for(var n,a=e,r=[],l=0;a;){if(null!==(n=t.text.exec(a)))r.push(n[0]);else if(null!==(n=t.modulo.exec(a)))r.push("%");else{if(null===(n=t.placeholder.exec(a)))throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){l|=1;var s=[],o=n[2],i=[];if(null===(i=t.key.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(s.push(i[1]);""!==(o=o.substring(i[0].length));)if(null!==(i=t.key_access.exec(o)))s.push(i[1]);else{if(null===(i=t.index_access.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");s.push(i[1])}n[2]=s}else l|=2;if(3===l)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:n[0],param_no:n[1],keys:n[2],sign:n[3],pad_char:n[4],align:n[5],width:n[6],precision:n[7],type:n[8]})}a=a.substring(n[0].length)}return u[e]=r}e.sprintf=n,e.vsprintf=a,"undefined"!=typeof window&&(window.sprintf=n,window.vsprintf=a)}()}));const{sprintf:AO}=gO,{LUA_INTEGER_FMT:TO,LUA_INTEGER_FRMLEN:vO,LUA_MININTEGER:bO,LUA_NUMBER_FMT:OO,LUA_NUMBER_FRMLEN:kO,frexp:mO,lua_getlocaledecpoint:EO}=g,{LUA_TBOOLEAN:UO,LUA_TFUNCTION:RO,LUA_TNIL:NO,LUA_TNUMBER:yO,LUA_TSTRING:wO,LUA_TTABLE:SO,lua_call:IO,lua_createtable:MO,lua_dump:PO,lua_gettable:xO,lua_gettop:CO,lua_isinteger:DO,lua_isstring:BO,lua_pop:VO,lua_pushcclosure:GO,lua_pushinteger:KO,lua_pushlightuserdata:FO,lua_pushliteral:jO,lua_pushlstring:HO,lua_pushnil:XO,lua_pushnumber:zO,lua_pushstring:JO,lua_pushvalue:qO,lua_remove:YO,lua_setfield:WO,lua_setmetatable:ZO,lua_settop:QO,lua_toboolean:$O,lua_tointeger:tk,lua_tonumber:ek,lua_tostring:nk,lua_touserdata:ak,lua_type:rk,lua_upvalueindex:uk}=Vd,{luaL_Buffer:lk,luaL_addchar:sk,luaL_addlstring:ok,luaL_addsize:ik,luaL_addstring:ck,luaL_addvalue:fk,luaL_argcheck:_k,luaL_argerror:pk,luaL_buffinit:hk,luaL_buffinitsize:dk,luaL_checkinteger:Lk,luaL_checknumber:gk,luaL_checkstack:Ak,luaL_checkstring:Tk,luaL_checktype:vk,luaL_error:bk,luaL_newlib:Ok,luaL_optinteger:kk,luaL_optstring:mk,luaL_prepbuffsize:Ek,luaL_pushresult:Uk,luaL_pushresultsize:Rk,luaL_tolstring:Nk,luaL_typename:yk}=iA,{luastring_eq:wk,luastring_indexOf:Sk,to_jsstring:Ik,to_luastring:Mk}=G,Pk="%".charCodeAt(0),xk=function(t){let e=Sk(t,0);return e>-1?e:t.length},Ck=function(t,e){return t>=0?t:0-t>e?0:e+t+1},Dk=function(t,e,n,a){return ok(a,e,n),0},Bk=kO.length+1,Vk=function(t,e,n){let a=function(t){if(Object.is(t,1/0))return Mk("inf");if(Object.is(t,-1/0))return Mk("-inf");if(Number.isNaN(t))return Mk("nan");if(0===t){let e=AO(OO+"x0p+0",t);return Object.is(t,-0)&&(e="-"+e),Mk(e)}{let e="",n=mO(t),a=n[0],r=n[1];return a<0&&(e+="-",a=-a),e+="0x",e+=(2*a).toString(16),r-=1,e+=AO("p%+d",r),Mk(e)}}(n);if(65===e[Bk])for(let t=0;t<a.length;t++){let e=a[t];e>=97&&(a[t]=223&e)}else 97!==e[Bk]&&bk(t,Mk("modifiers for format '%%a'/'%%A' not implemented"));return a},Gk=Mk("-+ #0"),Kk=t=>97<=t&&t<=122||65<=t&&t<=90,Fk=t=>48<=t&&t<=57,jk=t=>0<=t&&t<=31||127===t,Hk=t=>33<=t&&t<=126,Xk=t=>97<=t&&t<=122,zk=t=>65<=t&&t<=90,Jk=t=>97<=t&&t<=122||65<=t&&t<=90||48<=t&&t<=57,qk=t=>Hk(t)&&!Jk(t),Yk=t=>32===t||t>=9&&t<=13,Wk=t=>48<=t&&t<=57||65<=t&&t<=70||97<=t&&t<=102,Zk=function(t,e,n){switch(rk(t,n)){case wO:{let a=nk(t,n);!function(t,e,n){sk(t,34);let a=0;for(;n--;){if(34===e[a]||92===e[a]||10===e[a])sk(t,92),sk(t,e[a]);else if(jk(e[a])){let n=""+e[a];Fk(e[a+1])&&(n="0".repeat(3-n.length)+n),ck(t,Mk("\\"+n))}else sk(t,e[a]);a++}sk(t,34)}(e,a,a.length);break}case yO:{let a;if(DO(t,n)){let e=tk(t,n);a=Mk(AO(e===bO?"0x%"+vO+"x":TO,e))}else{let e=ek(t,n);a=Vk(t,Mk(`%${vO}a`),e),function(t){if(Sk(t,46)<0){let e=EO(),n=Sk(t,e);n&&(t[n]=46)}}(a)}ck(e,a);break}case NO:case UO:Nk(t,n),fk(e);break;default:pk(t,n,Mk("value has no literal form"))}},Qk=function(t,e,n,a){let r=n;for(;0!==e[r]&&Sk(Gk,e[r])>=0;)r++;r-n>=Gk.length&&bk(t,Mk("invalid format (repeated flags)")),Fk(e[r])&&r++,Fk(e[r])&&r++,46===e[r]&&(r++,Fk(e[r])&&r++,Fk(e[r])&&r++),Fk(e[r])&&bk(t,Mk("invalid format (width or precision too long)")),a[0]=37;for(let t=0;t<r-n+1;t++)a[t+1]=e[n+t];return r},$k=function(t,e){let n=t.length,a=e.length,r=t[n-1];for(let r=0;r<a;r++)t[r+n-1]=e[r];t[n+a-1]=r};class tm{constructor(t){this.L=t,this.islittle=!0,this.maxalign=1}}const em=Fk,nm=function(t,e){if(t.off>=t.s.length||!em(t.s[t.off]))return e;{let e=0;do{e=10*e+(t.s[t.off++]-48)}while(t.off<t.s.length&&em(t.s[t.off])&&e<=214748363.8);return e}},am=function(t,e,n){let a=nm(e,n);return(a>16||a<=0)&&bk(t.L,Mk("integral size (%d) out of limits [1,%d]"),a,16),a},rm=function(t,e){let n={opt:e.s[e.off++],size:0};switch(n.opt){case 98:return n.size=1,n.opt=0,n;case 66:return n.size=1,n.opt=1,n;case 104:return n.size=2,n.opt=0,n;case 72:return n.size=2,n.opt=1,n;case 108:return n.size=4,n.opt=0,n;case 76:return n.size=4,n.opt=1,n;case 106:return n.size=4,n.opt=0,n;case 74:case 84:return n.size=4,n.opt=1,n;case 102:return n.size=4,n.opt=2,n;case 100:case 110:return n.size=8,n.opt=2,n;case 105:return n.size=am(t,e,4),n.opt=0,n;case 73:return n.size=am(t,e,4),n.opt=1,n;case 115:return n.size=am(t,e,4),n.opt=4,n;case 99:return n.size=nm(e,-1),-1===n.size&&bk(t.L,Mk("missing size for format option 'c'")),n.opt=3,n;case 122:return n.opt=5,n;case 120:return n.size=1,n.opt=6,n;case 88:return n.opt=7,n;case 32:break;case 60:t.islittle=!0;break;case 62:t.islittle=!1;break;case 61:t.islittle=!0;break;case 33:t.maxalign=am(t,e,8);break;default:bk(t.L,Mk("invalid format option '%c'"),n.opt)}return n.opt=8,n},um=function(t,e,n){let a={opt:NaN,size:NaN,ntoalign:NaN},r=rm(t,n);a.size=r.size,a.opt=r.opt;let u=a.size;if(7===a.opt)if(n.off>=n.s.length||0===n.s[n.off])pk(t.L,1,Mk("invalid next option for option 'X'"));else{let e=rm(t,n);u=e.size,e=e.opt,3!==e&&0!==u||pk(t.L,1,Mk("invalid next option for option 'X'"))}return u<=1||3===a.opt?a.ntoalign=0:(u>t.maxalign&&(u=t.maxalign),0!=(u&u-1)&&pk(t.L,1,Mk("format asks for alignment not power of 2")),a.ntoalign=u-(e&u-1)&u-1),a},lm=function(t,e,n,a,r){let u=Ek(t,a);u[n?0:a-1]=255&e;for(let t=1;t<a;t++)e>>=8,u[n?t:a-1-t]=255&e;if(r&&a>4)for(let t=4;t<a;t++)u[n?t:a-1-t]=255;ik(t,a)},sm=function(t,e,n,a,r){let u=0,l=a<=4?a:4;for(let t=l-1;t>=0;t--)u<<=8,u|=e[n?t:a-1-t];if(a<4){if(r){let t=1<<8*a-1;u=(u^t)-t}}else if(a>4){let s=!r||u>=0?0:255;for(let r=l;r<a;r++)e[n?r:a-1-r]!==s&&bk(t,Mk("%d-byte integer does not fit into Lua Integer"),a)}return u},om=function(t,e,n,a){xy.lua_assert(e.length>=a);let r=new DataView(new ArrayBuffer(a));for(let t=0;t<a;t++)r.setUint8(t,e[t],n);return 4==a?r.getFloat32(0,n):r.getFloat64(0,n)},im=Mk("^$*+?.([%-");class cm{constructor(t){this.src=null,this.src_init=null,this.src_end=null,this.p=null,this.p_end=null,this.L=t,this.matchdepth=NaN,this.level=NaN,this.capture=[]}}const fm=function(t,e){switch(t.p[e++]){case Pk:return e===t.p_end&&bk(t.L,Mk("malformed pattern (ends with '%%')")),e+1;case 91:94===t.p[e]&&e++;do{e===t.p_end&&bk(t.L,Mk("malformed pattern (missing ']')")),t.p[e++]===Pk&&e<t.p_end&&e++}while(93!==t.p[e]);return e+1;default:return e}},_m=function(t,e){switch(e){case 97:return Kk(t);case 65:return!Kk(t);case 99:return jk(t);case 67:return!jk(t);case 100:return Fk(t);case 68:return!Fk(t);case 103:return Hk(t);case 71:return!Hk(t);case 108:return Xk(t);case 76:return!Xk(t);case 112:return qk(t);case 80:return!qk(t);case 115:return Yk(t);case 83:return!Yk(t);case 117:return zk(t);case 85:return!zk(t);case 119:return Jk(t);case 87:return!Jk(t);case 120:return Wk(t);case 88:return!Wk(t);case 122:return 0===t;case 90:return 0!==t;default:return e===t}},pm=function(t,e,n,a){let r=!0;for(94===t.p[n+1]&&(r=!1,n++);++n<a;)if(t.p[n]===Pk){if(n++,_m(e,t.p[n]))return r}else if(45===t.p[n+1]&&n+2<a){if(n+=2,t.p[n-2]<=e&&e<=t.p[n])return r}else if(t.p[n]===e)return r;return!r},hm=function(t,e,n,a){if(e>=t.src_end)return!1;{let r=t.src[e];switch(t.p[n]){case 46:return!0;case Pk:return _m(r,t.p[n+1]);case 91:return pm(t,r,n,a-1);default:return t.p[n]===r}}},dm=function(t,e,n){if(n>=t.p_end-1&&bk(t.L,Mk("malformed pattern (missing arguments to '%%b'")),t.src[e]!==t.p[n])return null;{let a=t.p[n],r=t.p[n+1],u=1;for(;++e<t.src_end;)if(t.src[e]===r){if(0==--u)return e+1}else t.src[e]===a&&u++}return null},Lm=function(t,e,n,a){let r=0;for(;hm(t,e+r,n,a);)r++;for(;r>=0;){let n=bm(t,e+r,a+1);if(n)return n;r--}return null},gm=function(t,e,n,a){for(;;){let r=bm(t,e,a+1);if(null!==r)return r;if(!hm(t,e,n,a))return null;e++}},Am=function(t,e,n,a){let r,u=t.level;return u>=32&&bk(t.L,Mk("too many captures")),t.capture[u]=t.capture[u]?t.capture[u]:{},t.capture[u].init=e,t.capture[u].len=a,t.level=u+1,null===(r=bm(t,e,n))&&t.level--,r},Tm=function(t,e,n){let a,r=function(t){let e=t.level;for(e--;e>=0;e--)if(-1===t.capture[e].len)return e;return bk(t.L,Mk("invalid pattern capture"))}(t);return t.capture[r].len=e-t.capture[r].init,null===(a=bm(t,e,n))&&(t.capture[r].len=-1),a},vm=function(t,e,n){n=function(t,e){return(e-=49)<0||e>=t.level||-1===t.capture[e].len?bk(t.L,Mk("invalid capture index %%%d"),e+1):e}(t,n);let a=t.capture[n].len;return t.src_end-e>=a&&function(t,e,n,a,r){return wk(t.subarray(e,e+r),n.subarray(a,a+r))}(t.src,t.capture[n].init,t.src,e,a)?e+a:null},bm=function(t,e,n){let a=!1,r=!0;for(0==t.matchdepth--&&bk(t.L,Mk("pattern too complex"));r||a;)if(r=!1,n!==t.p_end)switch(a?void 0:t.p[n]){case 40:e=41===t.p[n+1]?Am(t,e,n+2,-2):Am(t,e,n+1,-1);break;case 41:e=Tm(t,e,n+1);break;case 36:if(n+1!==t.p_end){a=!0;break}e=t.src.length-e==0?e:null;break;case Pk:switch(t.p[n+1]){case 98:null!==(e=dm(t,e,n+2))&&(n+=4,r=!0);break;case 102:{n+=2,91!==t.p[n]&&bk(t.L,Mk("missing '[' after '%%f' in pattern"));let a=fm(t,n),u=e===t.src_init?0:t.src[e-1];if(!pm(t,u,n,a-1)&&pm(t,e===t.src_end?0:t.src[e],n,a-1)){n=a,r=!0;break}e=null;break}case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:null!==(e=vm(t,e,t.p[n+1]))&&(n+=2,r=!0);break;default:a=!0}break;default:{a=!1;let u=fm(t,n);if(hm(t,e,n,u))switch(t.p[u]){case 63:{let a;null!==(a=bm(t,e+1,u+1))?e=a:(n=u+1,r=!0);break}case 43:e++;case 42:e=Lm(t,e,n,u);break;case 45:e=gm(t,e,n,u);break;default:e++,n=u,r=!0}else{if(42===t.p[u]||63===t.p[u]||45===t.p[u]){n=u+1,r=!0;break}e=null}break}}return t.matchdepth++,e},Om=function(t,e,n,a){if(e>=t.level)0===e?HO(t.L,t.src.subarray(n,a),a-n):bk(t.L,Mk("invalid capture index %%%d"),e+1);else{let n=t.capture[e].len;-1===n&&bk(t.L,Mk("unfinished capture")),-2===n?KO(t.L,t.capture[e].init-t.src_init+1):HO(t.L,t.src.subarray(t.capture[e].init),n)}},km=function(t,e,n){let a=0===t.level&&t.src.subarray(e)?1:t.level;Ak(t.L,a,"too many captures");for(let r=0;r<a;r++)Om(t,r,e,n);return a},mm=function(t,e,n,a,r,u){t.L=e,t.matchdepth=200,t.src=n,t.src_init=0,t.src_end=a,t.p=r,t.p_end=u},Em=function(t){t.level=0,xy.lua_assert(200===t.matchdepth)},Um=function(t,e){let n=Tk(t,1),a=Tk(t,2),r=n.length,u=a.length,l=Ck(kk(t,3,1),r);if(l<1)l=1;else if(l>r+1)return XO(t),1;if(e&&($O(t,4)||function(t,e){for(let n=0;n<e;n++)if(-1!==Sk(im,t[n]))return!1;return!0}(a,u))){let e=function(t,e,n){var a=n>>>0,r=e.length;if(0===r)return a;for(;-1!==(a=t.indexOf(e[0],a));a++)if(wk(t.subarray(a,a+r),e))return a;return-1}(n.subarray(l-1),a,0);if(e>-1)return KO(t,l+e),KO(t,l+e+u-1),2}else{let s=new cm(t),o=l-1,i=94===a[0];i&&(a=a.subarray(1),u--),mm(s,t,n,r,a,u);do{let n;if(Em(s),null!==(n=bm(s,o,0)))return e?(KO(t,o+1),KO(t,n),km(s,null,0)+2):km(s,o,n)}while(o++<s.src_end&&!i)}return XO(t),1};class Rm{constructor(){this.src=NaN,this.p=NaN,this.lastmatch=NaN,this.ms=new cm}}const Nm=function(t){let e=ak(t,uk(3));e.ms.L=t;for(let t=e.src;t<=e.ms.src_end;t++){let n;if(Em(e.ms),null!==(n=bm(e.ms,t,e.p))&&n!==e.lastmatch)return e.src=e.lastmatch=n,km(e.ms,t,n)}return 0},ym=function(t,e,n,a,r){let u=t.L;switch(r){case RO:{qO(u,3);let e=km(t,n,a);IO(u,e,1);break}case SO:Om(t,0,n,a),xO(u,3);break;default:return void function(t,e,n,a){let r=t.L,u=nk(r,3),l=u.length;for(let s=0;s<l;s++)u[s]!==Pk?sk(e,u[s]):(s++,Fk(u[s])?48===u[s]?ok(e,t.src.subarray(n,a),a-n):(Om(t,u[s]-49,n,a),Nk(r,-1),YO(r,-2),fk(e)):(u[s]!==Pk&&bk(r,Mk("invalid use of '%c' in replacement string"),Pk),sk(e,u[s])))}(t,e,n,a)}$O(u,-1)?BO(u,-1)||bk(u,Mk("invalid replacement value (a %s)"),yk(u,-1)):(VO(u,1),HO(u,t.src.subarray(n,a),a-n)),fk(e)},wm={byte:function(t){let e=Tk(t,1),n=e.length,a=Ck(kk(t,2,1),n),r=Ck(kk(t,3,a),n);if(a<1&&(a=1),r>n&&(r=n),a>r)return 0;if(r-a>=Number.MAX_SAFE_INTEGER)return bk(t,"string slice too long");let u=r-a+1;Ak(t,u,"string slice too long");for(let n=0;n<u;n++)KO(t,e[a+n-1]);return u},char:function(t){let e=CO(t),n=new lk,a=dk(t,n,e);for(let n=1;n<=e;n++){let e=Lk(t,n);_k(t,e>=0&&e<=255,"value out of range"),a[n-1]=e}return Rk(n,e),1},dump:function(t){let e=new lk,n=$O(t,2);return vk(t,1,RO),QO(t,1),hk(t,e),0!==PO(t,Dk,e,n)?bk(t,Mk("unable to dump given function")):(Uk(e),1)},find:function(t){return Um(t,1)},format:function(t){let e=CO(t),n=1,a=Tk(t,n),r=0,u=new lk;for(hk(t,u);r<a.length;)if(a[r]!==Pk)sk(u,a[r++]);else if(a[++r]===Pk)sk(u,a[r++]);else{let l=[];switch(++n>e&&pk(t,n,Mk("no value")),r=Qk(t,a,r,l),String.fromCharCode(a[r++])){case"c":sk(u,Lk(t,n));break;case"d":case"i":case"o":case"u":case"x":case"X":{let e=Lk(t,n);$k(l,Mk(vO,!0)),ck(u,Mk(AO(String.fromCharCode(...l),e)));break}case"a":case"A":$k(l,Mk(vO,!0)),ck(u,Vk(t,l,gk(t,n)));break;case"e":case"E":case"f":case"g":case"G":{let e=gk(t,n);$k(l,Mk(vO,!0)),ck(u,Mk(AO(String.fromCharCode(...l),e)));break}case"q":Zk(t,u,n);break;case"s":{let e=Nk(t,n);l.length<=2||0===l[2]?fk(u):(_k(t,e.length===xk(e),n,"string contains zeros"),Sk(l,46)<0&&e.length>=100?fk(u):(ck(u,Mk(AO(String.fromCharCode(...l),Ik(e)))),VO(t,1)));break}default:return bk(t,Mk("invalid option '%%%c' to 'format'"),a[r-1])}}return Uk(u),1},gmatch:function(t){let e=Tk(t,1),n=Tk(t,2),a=e.length,r=n.length;QO(t,2);let u=new Rm;return FO(t,u),mm(u.ms,t,e,a,n,r),u.src=0,u.p=0,u.lastmatch=null,GO(t,Nm,3),1},gsub:function(t){let e=Tk(t,1),n=e.length,a=Tk(t,2),r=a.length,u=null,l=rk(t,3),s=kk(t,4,n+1),o=94===a[0],i=0,c=new cm(t),f=new lk;for(_k(t,l===yO||l===wO||l===RO||l===SO,3,"string/function/table expected"),hk(t,f),o&&(a=a.subarray(1),r--),mm(c,t,e,n,a,r),e=0,a=0;i<s;){let t;if(Em(c),null!==(t=bm(c,e,a))&&t!==u)i++,ym(c,f,e,t,l),e=u=t;else{if(!(e<c.src_end))break;sk(f,c.src[e++])}if(o)break}return ok(f,c.src.subarray(e,c.src_end),c.src_end-e),Uk(f),KO(t,i),2},len:function(t){return KO(t,Tk(t,1).length),1},lower:function(t){let e=Tk(t,1),n=e.length,a=new Uint8Array(n);for(let t=0;t<n;t++){let n=e[t];zk(n)&&(n|=32),a[t]=n}return JO(t,a),1},match:function(t){return Um(t,0)},pack:function(t){let e=new lk,n=new tm(t),a={s:Tk(t,1),off:0},r=1,u=0;for(XO(t),hk(t,e);a.off<a.s.length;){let l=um(n,u,a),s=l.opt,o=l.size,i=l.ntoalign;for(u+=i+o;i-- >0;)sk(e,0);switch(r++,s){case 0:{let a=Lk(t,r);if(o<4){let e=1<<8*o-1;_k(t,-e<=a&&a<e,r,"integer overflow")}lm(e,a,n.islittle,o,a<0);break}case 1:{let a=Lk(t,r);o<4&&_k(t,a>>>0<1<<8*o,r,"unsigned overflow"),lm(e,a>>>0,n.islittle,o,!1);break}case 2:{let a=Ek(e,o),u=gk(t,r),l=new DataView(a.buffer,a.byteOffset,a.byteLength);4===o?l.setFloat32(0,u,n.islittle):l.setFloat64(0,u,n.islittle),ik(e,o);break}case 3:{let n=Tk(t,r),a=n.length;for(_k(t,a<=o,r,"string longer than given size"),ok(e,n,a);a++<o;)sk(e,0);break}case 4:{let a=Tk(t,r),l=a.length;_k(t,o>=4||l<1<<8*o,r,"string length does not fit in given size"),lm(e,l,n.islittle,o,0),ok(e,a,l),u+=l;break}case 5:{let n=Tk(t,r),a=n.length;_k(t,Sk(n,0)<0,r,"strings contains zeros"),ok(e,n,a),sk(e,0),u+=a+1;break}case 6:sk(e,0);case 7:case 8:r--}}return Uk(e),1},packsize:function(t){let e=new tm(t),n={s:Tk(t,1),off:0},a=0;for(;n.off<n.s.length;){let r=um(e,a,n),u=r.opt,l=r.size;switch(l+=r.ntoalign,_k(t,a<=2147483647-l,1,"format result too large"),a+=l,u){case 4:case 5:pk(t,1,"variable-length format")}}return KO(t,a),1},rep:function(t){let e=Tk(t,1),n=e.length,a=Lk(t,2),r=mk(t,3,""),u=r.length;if(a<=0)jO(t,"");else{if(n+u<n||n+u>2147483647/a)return bk(t,Mk("resulting string too large"));{let l=a*n+(a-1)*u,s=new lk,o=dk(t,s,l),i=0;for(;a-- >1;)o.set(e,i),i+=n,u>0&&(o.set(r,i),i+=u);o.set(e,i),Rk(s,l)}}return 1},reverse:function(t){let e=Tk(t,1),n=e.length,a=new Uint8Array(n);for(let t=0;t<n;t++)a[t]=e[n-1-t];return JO(t,a),1},sub:function(t){let e=Tk(t,1),n=e.length,a=Ck(Lk(t,2),n),r=Ck(kk(t,3,-1),n);return a<1&&(a=1),r>n&&(r=n),a<=r?JO(t,e.subarray(a-1,a-1+(r-a+1))):jO(t,""),1},unpack:function(t){let e=new tm(t),n={s:Tk(t,1),off:0},a=Tk(t,2),r=a.length,u=Ck(kk(t,3,1),r)-1,l=0;for(_k(t,u<=r&&u>=0,3,"initial position out of string");n.off<n.s.length;){let s=um(e,u,n),o=s.opt,i=s.size,c=s.ntoalign;switch(u+c+i>r&&pk(t,2,Mk("data string too short")),u+=c,Ak(t,2,"too many results"),l++,o){case 0:case 1:{let n=sm(t,a.subarray(u),e.islittle,i,0===o);KO(t,n);break}case 2:{let n=om(0,a.subarray(u),e.islittle,i);zO(t,n);break}case 3:JO(t,a.subarray(u,u+i));break;case 4:{let n=sm(t,a.subarray(u),e.islittle,i,0);_k(t,u+n+i<=r,2,"data string too short"),JO(t,a.subarray(u+i,u+i+n)),u+=n;break}case 5:{let e=Sk(a,0,u);-1===e&&(e=a.length-u),JO(t,a.subarray(u,e)),u=e+1;break}case 7:case 6:case 8:l--}u+=i}return KO(t,u+1),l+1},upper:function(t){let e=Tk(t,1),n=e.length,a=new Uint8Array(n);for(let t=0;t<n;t++){let n=e[t];Xk(n)&&(n&=223),a[t]=n}return JO(t,a),1}};var Sm={luaopen_string:function(t){return Ok(t,wm),function(t){MO(t,0,1),jO(t,""),qO(t,-2),ZO(t,-2),VO(t,1),qO(t,-2),WO(t,-2,Mk("__index",!0)),VO(t,1)}(t),1}};const{lua_gettop:Im,lua_pushcfunction:Mm,lua_pushfstring:Pm,lua_pushinteger:xm,lua_pushnil:Cm,lua_pushstring:Dm,lua_pushvalue:Bm,lua_setfield:Vm,lua_tointeger:Gm}=Vd,{luaL_Buffer:Km,luaL_addvalue:Fm,luaL_argcheck:jm,luaL_buffinit:Hm,luaL_checkinteger:Xm,luaL_checkstack:zm,luaL_checkstring:Jm,luaL_error:qm,luaL_newlib:Ym,luaL_optinteger:Wm,luaL_pushresult:Zm}=iA,{luastring_of:Qm,to_luastring:$m}=G,tE=function(t){return 128===(192&t)},eE=function(t,e){return t>=0?t:0-t>e?0:e+t+1},nE=[255,127,2047,65535],aE=function(t,e){let n=t[e],a=0;if(n<128)a=n;else{let r=0;for(;64&n;){let u=t[e+ ++r];if(128!=(192&u))return null;a=a<<6|63&u,n<<=1}if(a|=(127&n)<<5*r,r>3||a>1114111||a<=nE[r])return null;e+=r}return{code:a,pos:e+1}},rE=$m("%U"),uE=function(t,e){let n=Xm(t,e);jm(t,0<=n&&n<=1114111,e,"value out of range"),Pm(t,rE,n)},lE=function(t){let e=Jm(t,1),n=e.length,a=Gm(t,2)-1;if(a<0)a=0;else if(a<n)for(a++;tE(e[a]);)a++;if(a>=n)return 0;{let n=aE(e,a);return null===n||tE(e[n.pos])?qm(t,$m("invalid UTF-8 code")):(xm(t,a+1),xm(t,n.code),2)}},sE={char:function(t){let e=Im(t);if(1===e)uE(t,1);else{let n=new Km;Hm(t,n);for(let a=1;a<=e;a++)uE(t,a),Fm(n);Zm(n)}return 1},codepoint:function(t){let e=Jm(t,1),n=eE(Wm(t,2,1),e.length),a=eE(Wm(t,3,n),e.length);if(jm(t,n>=1,2,"out of range"),jm(t,a<=e.length,3,"out of range"),n>a)return 0;if(a-n>=Number.MAX_SAFE_INTEGER)return qm(t,"string slice too long");let r=a-n+1;for(zm(t,r,"string slice too long"),r=0,n-=1;n<a;){let a=aE(e,n);if(null===a)return qm(t,"invalid UTF-8 code");xm(t,a.code),n=a.pos,r++}return r},codes:function(t){return Jm(t,1),Mm(t,lE),Bm(t,1),xm(t,0),3},len:function(t){let e=0,n=Jm(t,1),a=n.length,r=eE(Wm(t,2,1),a),u=eE(Wm(t,3,-1),a);for(jm(t,1<=r&&--r<=a,2,"initial position out of string"),jm(t,--u<a,3,"final position out of string");r<=u;){let a=aE(n,r);if(null===a)return Cm(t),xm(t,r+1),2;r=a.pos,e++}return xm(t,e),1},offset:function(t){let e=Jm(t,1),n=Xm(t,2),a=n>=0?1:e.length+1;if(a=eE(Wm(t,3,a),e.length),jm(t,1<=a&&--a<=e.length,3,"position out of range"),0===n)for(;a>0&&tE(e[a]);)a--;else if(tE(e[a])&&qm(t,"initial position is a continuation byte"),n<0)for(;n<0&&a>0;){do{a--}while(a>0&&tE(e[a]));n++}else for(n--;n>0&&a<e.length;){do{a++}while(tE(e[a]));n--}return 0===n?xm(t,a+1):Cm(t),1}},oE=Qm(91,0,45,127,194,45,244,93,91,128,45,191,93,42);var iE={luaopen_utf8:function(t){return Ym(t,sE),Dm(t,oE),Vm(t,-2,$m("charpattern",!0)),1}};const{LUA_OPLT:cE,LUA_TNUMBER:fE,lua_compare:_E,lua_gettop:pE,lua_isinteger:hE,lua_isnoneornil:dE,lua_pushboolean:LE,lua_pushinteger:gE,lua_pushliteral:AE,lua_pushnil:TE,lua_pushnumber:vE,lua_pushvalue:bE,lua_setfield:OE,lua_settop:kE,lua_tointeger:mE,lua_tointegerx:EE,lua_type:UE}=Vd,{luaL_argcheck:RE,luaL_argerror:NE,luaL_checkany:yE,luaL_checkinteger:wE,luaL_checknumber:SE,luaL_error:IE,luaL_newlib:ME,luaL_optnumber:PE}=iA,{LUA_MAXINTEGER:xE,LUA_MININTEGER:CE,lua_numbertointeger:DE}=g,{to_luastring:BE}=G;let VE;const GE=function(){return VE=1103515245*VE+12345&2147483647,VE},KE=function(t,e){let n=DE(e);!1!==n?gE(t,n):vE(t,e)},FE={abs:function(t){if(hE(t,1)){let e=mE(t,1);e<0&&(e=0|-e),gE(t,e)}else vE(t,Math.abs(SE(t,1)));return 1},acos:function(t){return vE(t,Math.acos(SE(t,1))),1},asin:function(t){return vE(t,Math.asin(SE(t,1))),1},atan:function(t){let e=SE(t,1),n=PE(t,2,1);return vE(t,Math.atan2(e,n)),1},ceil:function(t){return hE(t,1)?kE(t,1):KE(t,Math.ceil(SE(t,1))),1},cos:function(t){return vE(t,Math.cos(SE(t,1))),1},deg:function(t){return vE(t,SE(t,1)*(180/Math.PI)),1},exp:function(t){return vE(t,Math.exp(SE(t,1))),1},floor:function(t){return hE(t,1)?kE(t,1):KE(t,Math.floor(SE(t,1))),1},fmod:function(t){if(hE(t,1)&&hE(t,2)){let e=mE(t,2);0===e?NE(t,2,"zero"):gE(t,mE(t,1)%e|0)}else{let e=SE(t,1),n=SE(t,2);vE(t,e%n)}return 1},log:function(t){let e,n=SE(t,1);if(dE(t,2))e=Math.log(n);else{let a=SE(t,2);e=2===a?Math.log2(n):10===a?Math.log10(n):Math.log(n)/Math.log(a)}return vE(t,e),1},max:function(t){let e=pE(t),n=1;RE(t,e>=1,1,"value expected");for(let a=2;a<=e;a++)_E(t,n,a,cE)&&(n=a);return bE(t,n),1},min:function(t){let e=pE(t),n=1;RE(t,e>=1,1,"value expected");for(let a=2;a<=e;a++)_E(t,a,n,cE)&&(n=a);return bE(t,n),1},modf:function(t){if(hE(t,1))kE(t,1),vE(t,0);else{let e=SE(t,1),n=e<0?Math.ceil(e):Math.floor(e);KE(t,n),vE(t,e===n?0:e-n)}return 2},rad:function(t){return vE(t,SE(t,1)*(Math.PI/180)),1},random:function(t){let e,n,a=void 0===VE?Math.random():GE()/2147483648;switch(pE(t)){case 0:return vE(t,a),1;case 1:e=1,n=wE(t,1);break;case 2:e=wE(t,1),n=wE(t,2);break;default:return IE(t,"wrong number of arguments")}return RE(t,e<=n,1,"interval is empty"),RE(t,e>=0||n<=xE+e,1,"interval too large"),a*=n-e+1,gE(t,Math.floor(a)+e),1},randomseed:function(t){var e;return e=SE(t,1),VE=0|e,0===VE&&(VE=1),GE(),0},sin:function(t){return vE(t,Math.sin(SE(t,1))),1},sqrt:function(t){return vE(t,Math.sqrt(SE(t,1))),1},tan:function(t){return vE(t,Math.tan(SE(t,1))),1},tointeger:function(t){let e=EE(t,1);return!1!==e?gE(t,e):(yE(t,1),TE(t)),1},type:function(t){return UE(t,1)===fE?hE(t,1)?AE(t,"integer"):AE(t,"float"):(yE(t,1),TE(t)),1},ult:function(t){let e=wE(t,1),n=wE(t,2);return LE(t,e>=0?n<0||e<n:n<0&&e<n),1}};var jE={luaopen_math:function(t){return ME(t,FE),vE(t,Math.PI),OE(t,-2,BE("pi",!0)),vE(t,1/0),OE(t,-2,BE("huge",!0)),gE(t,xE),OE(t,-2,BE("maxinteger",!0)),gE(t,CE),OE(t,-2,BE("mininteger",!0)),1}};const{LUA_MASKCALL:HE,LUA_MASKCOUNT:XE,LUA_MASKLINE:zE,LUA_MASKRET:JE,LUA_REGISTRYINDEX:qE,LUA_TFUNCTION:YE,LUA_TNIL:WE,LUA_TTABLE:ZE,LUA_TUSERDATA:QE,lua_Debug:$E,lua_call:tU,lua_checkstack:eU,lua_gethook:nU,lua_gethookcount:aU,lua_gethookmask:rU,lua_getinfo:uU,lua_getlocal:lU,lua_getmetatable:sU,lua_getstack:oU,lua_getupvalue:iU,lua_getuservalue:cU,lua_insert:fU,lua_iscfunction:_U,lua_isfunction:pU,lua_isnoneornil:hU,lua_isthread:dU,lua_newtable:LU,lua_pcall:gU,lua_pop:AU,lua_pushboolean:TU,lua_pushfstring:vU,lua_pushinteger:bU,lua_pushlightuserdata:OU,lua_pushliteral:kU,lua_pushnil:mU,lua_pushstring:EU,lua_pushvalue:UU,lua_rawgetp:RU,lua_rawsetp:NU,lua_rotate:yU,lua_setfield:wU,lua_sethook:SU,lua_setlocal:IU,lua_setmetatable:MU,lua_settop:PU,lua_setupvalue:xU,lua_setuservalue:CU,lua_tojsstring:DU,lua_toproxy:BU,lua_tostring:VU,lua_tothread:GU,lua_touserdata:KU,lua_type:FU,lua_upvalueid:jU,lua_upvaluejoin:HU,lua_xmove:XU}=Vd,{luaL_argcheck:zU,luaL_argerror:JU,luaL_checkany:qU,luaL_checkinteger:YU,luaL_checkstring:WU,luaL_checktype:ZU,luaL_error:QU,luaL_loadbuffer:$U,luaL_newlib:tR,luaL_optinteger:eR,luaL_optstring:nR,luaL_traceback:aR,lua_writestringerror:rR}=iA,{luastring_indexOf:uR,to_luastring:lR}=G,sR=function(t,e,n){t===e||eU(e,n)||QU(t,lR("stack overflow",!0))},oR=function(t){return dU(t,1)?{arg:1,thread:GU(t,1)}:{arg:0,thread:t}},iR=function(t,e,n){EU(t,n),wU(t,-2,e)},cR=function(t,e,n){bU(t,n),wU(t,-2,e)},fR=function(t,e,n){TU(t,n),wU(t,-2,e)},_R=function(t,e,n){t==e?yU(t,-2,1):XU(e,t,1),wU(t,-2,n)},pR=function(t,e){let n=YU(t,2);ZU(t,1,YE);let a=e?iU(t,1,n):xU(t,1,n);return null===a?0:(EU(t,a),fU(t,-(e+1)),e+1)},hR=function(t,e,n){let a=YU(t,n);return ZU(t,e,YE),zU(t,null!==iU(t,e,a),n,"invalid upvalue index"),a},dR=lR("__hooks__",!0),LR=["call","return","line","count","tail call"].map(t=>lR(t)),gR=function(t,e){RU(t,qE,dR);let n=KU(t,-1).get(t);n&&(n(t),EU(t,LR[e.event]),e.currentline>=0?bU(t,e.currentline):mU(t),xy.lua_assert(uU(t,lR("lS"),e)),tU(t,2,0))},AR={gethook:function(t){let e=oR(t).thread,n=new Uint8Array(5),a=rU(e),r=nU(e);if(null===r)mU(t);else if(r!==gR)kU(t,"external hook");else{RU(t,qE,dR),KU(t,-1).get(e)(t)}return EU(t,function(t,e){let n=0;return t&HE&&(e[n++]=99),t&JE&&(e[n++]=114),t&zE&&(e[n++]=108),e.subarray(0,n)}(a,n)),bU(t,aU(e)),3},getinfo:function(t){let e=new $E,n=oR(t),a=n.arg,r=n.thread,u=nR(t,a+2,"flnStu");if(sR(t,r,3),pU(t,a+1))u=vU(t,lR(">%s"),u),UU(t,a+1),XU(t,r,1);else if(!oU(r,YU(t,a+1),e))return mU(t),1;return uU(r,u,e)||JU(t,a+2,"invalid option"),LU(t),uR(u,83)>-1&&(iR(t,lR("source",!0),e.source),iR(t,lR("short_src",!0),e.short_src),cR(t,lR("linedefined",!0),e.linedefined),cR(t,lR("lastlinedefined",!0),e.lastlinedefined),iR(t,lR("what",!0),e.what)),uR(u,108)>-1&&cR(t,lR("currentline",!0),e.currentline),uR(u,117)>-1&&(cR(t,lR("nups",!0),e.nups),cR(t,lR("nparams",!0),e.nparams),fR(t,lR("isvararg",!0),e.isvararg)),uR(u,110)>-1&&(iR(t,lR("name",!0),e.name),iR(t,lR("namewhat",!0),e.namewhat)),uR(u,116)>-1&&fR(t,lR("istailcall",!0),e.istailcall),uR(u,76)>-1&&_R(t,r,lR("activelines",!0)),uR(u,102)>-1&&_R(t,r,lR("func",!0)),1},getlocal:function(t){let e=oR(t),n=e.thread,a=e.arg,r=new $E,u=YU(t,a+2);if(pU(t,a+1))return UU(t,a+1),EU(t,lU(t,null,u)),1;{let e=YU(t,a+1);if(!oU(n,e,r))return JU(t,a+1,"level out of range");sR(t,n,1);let l=lU(n,r,u);return l?(XU(n,t,1),EU(t,l),yU(t,-2,1),2):(mU(t),1)}},getmetatable:function(t){return qU(t,1),sU(t,1)||mU(t),1},getregistry:function(t){return UU(t,qE),1},getupvalue:function(t){return pR(t,1)},getuservalue:function(t){return FU(t,1)!==QE?mU(t):cU(t,1),1},sethook:function(t){let e,n,a,r,u=oR(t),l=u.thread,s=u.arg;if(hU(t,s+1))PU(t,s+1),a=null,e=0,n=0;else{const r=WU(t,s+2);ZU(t,s+1,YE),n=eR(t,s+3,0),a=gR,e=function(t,e){let n=0;return uR(t,99)>-1&&(n|=HE),uR(t,114)>-1&&(n|=JE),uR(t,108)>-1&&(n|=zE),e>0&&(n|=XE),n}(r,n)}RU(t,qE,dR)===WE?(r=new WeakMap,OU(t,r),NU(t,qE,dR)):r=KU(t,-1);let o=BU(t,s+1);return r.set(l,o),SU(l,a,e,n),0},setlocal:function(t){let e=oR(t),n=e.thread,a=e.arg,r=new $E,u=YU(t,a+1),l=YU(t,a+2);if(!oU(n,u,r))return JU(t,a+1,"level out of range");qU(t,a+3),PU(t,a+3),sR(t,n,1),XU(t,n,1);let s=IU(n,r,l);return null===s&&AU(n,1),EU(t,s),1},setmetatable:function(t){const e=FU(t,2);return zU(t,e==WE||e==ZE,2,"nil or table expected"),PU(t,2),MU(t,1),1},setupvalue:function(t){return qU(t,3),pR(t,0)},setuservalue:function(t){return ZU(t,1,QE),qU(t,2),PU(t,2),CU(t,1),1},traceback:function(t){let e=oR(t),n=e.thread,a=e.arg,r=VU(t,a+1);if(null!==r||hU(t,a+1)){let e=eR(t,a+2,t===n?1:0);aR(t,n,r,e)}else UU(t,a+1);return 1},upvalueid:function(t){let e=hR(t,1,2);return OU(t,jU(t,1,e)),1},upvaluejoin:function(t){let e=hR(t,1,2),n=hR(t,3,4);return zU(t,!_U(t,1),1,"Lua function expected"),zU(t,!_U(t,3),3,"Lua function expected"),HU(t,1,e,3,n),0}};let TR;"undefined"!=typeof window&&(TR=function(){let t=prompt("lua_debug>","");return null!==t?t:""}),TR&&(AR.debug=function(t){for(;;){let e=TR();if("cont"===e)return 0;if(0===e.length)continue;let n=lR(e);($U(t,n,n.length,lR("=(debug command)",!0))||gU(t,0,0,0))&&rR(DU(t,-1),"\n"),PU(t,0)}});var vR={luaopen_debug:function(t){return tR(t,AR),1}};const{LUA_DIRSEP:bR,LUA_EXEC_DIR:OR,LUA_JSPATH_DEFAULT:kR,LUA_PATH_DEFAULT:mR,LUA_PATH_MARK:ER,LUA_PATH_SEP:UR}=g,{LUA_OK:RR,LUA_REGISTRYINDEX:NR,LUA_TNIL:yR,LUA_TTABLE:wR,lua_callk:SR,lua_createtable:IR,lua_getfield:MR,lua_insert:PR,lua_isfunction:xR,lua_isnil:CR,lua_isstring:DR,lua_newtable:BR,lua_pop:VR,lua_pushboolean:GR,lua_pushcclosure:KR,lua_pushcfunction:FR,lua_pushfstring:jR,lua_pushglobaltable:HR,lua_pushlightuserdata:XR,lua_pushliteral:zR,lua_pushlstring:JR,lua_pushnil:qR,lua_pushstring:YR,lua_pushvalue:WR,lua_rawgeti:ZR,lua_rawgetp:QR,lua_rawseti:$R,lua_rawsetp:tN,lua_remove:eN,lua_setfield:nN,lua_setmetatable:aN,lua_settop:rN,lua_toboolean:uN,lua_tostring:lN,lua_touserdata:sN,lua_upvalueindex:oN}=Vd,{LUA_LOADED_TABLE:iN,LUA_PRELOAD_TABLE:cN,luaL_Buffer:fN,luaL_addvalue:_N,luaL_buffinit:pN,luaL_checkstring:hN,luaL_error:dN,luaL_getsubtable:LN,luaL_gsub:gN,luaL_len:AN,luaL_loadfile:TN,luaL_newlib:vN,luaL_optstring:bN,luaL_pushresult:ON,luaL_setfuncs:kN}=iA,{luastring_indexOf:mN,to_jsstring:EN,to_luastring:UN,to_uristring:RN}=G,NN="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:(0,eval)("this"),yN=UN("__JSLIBS__"),wN=bR,SN=bR,IN=UN("luaopen_"),MN=UN("_"),PN=UN("");let xN;xN=function(t,e,n){e=RN(e);let a=new XMLHttpRequest;if(a.open("GET",e,!1),a.send(),a.status<200||a.status>=300)return YR(t,UN(`${a.status}: ${a.statusText}`)),null;let r,u=a.response;/\/\/[#@] sourceURL=/.test(u)||(u+=" //# sourceURL="+e);try{r=Function("fengari",u)}catch(e){return YR(t,UN(`${e.name}: ${e.message}`)),null}let l=r(Cy);return"function"==typeof l||"object"==typeof l&&null!==l?l:void 0===l?NN:(YR(t,UN(`library returned unexpected type (${typeof l})`)),null)};let CN;CN=function(t){t=RN(t);let e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(),e.status>=200&&e.status<=299};const DN=function(t,e,n){let a=GN(t,e);if(null===a){if(a=xN(t,e,(n[0],"*".charCodeAt(0))),null===a)return 1;KN(t,e,a)}if(n[0]==="*".charCodeAt(0))return GR(t,1),0;{let e=function(t,e,n){let a=e[EN(n)];return a&&"function"==typeof a?a:(jR(t,UN("undefined symbol: %s"),n),null)}(t,a,n);return null===e?2:(FR(t,e),0)}},BN=NN,VN=function(t,e,n,a){let r=`${n}${xy.LUA_VERSUFFIX}`;YR(t,UN(r));let u=BN[r];void 0===u&&(u=BN[n]),void 0===u||function(t){MR(t,NR,UN("LUA_NOENV"));let e=uN(t,-1);return VR(t,1),e}(t)?YR(t,a):(u=gN(t,UN(u),UN(UR+UR,!0),UN(UR+EN(PN)+UR,!0)),gN(t,u,PN,a),eN(t,-2)),nN(t,-3,e),VR(t,1)},GN=function(t,e){QR(t,NR,yN),MR(t,-1,e);let n=sN(t,-1);return VR(t,2),n},KN=function(t,e,n){QR(t,NR,yN),XR(t,n),WR(t,-1),nN(t,-3,e),$R(t,-2,AN(t,-2)+1),VR(t,1)},FN=function(t,e){for(;e[0]===UR.charCodeAt(0);)e=e.subarray(1);if(0===e.length)return null;let n=mN(e,UR.charCodeAt(0));return n<0&&(n=e.length),JR(t,e,n),e.subarray(n)},jN=function(t,e,n,a,r){let u=new fN;for(pN(t,u),0!==a[0]&&(e=gN(t,e,a,r));null!==(n=FN(t,n));){let n=gN(t,lN(t,-1),UN(ER,!0),e);if(eN(t,-2),CN(n))return n;jR(t,UN("\n\tno file '%s'"),n),eN(t,-2),_N(u)}return ON(u),null},HN=function(t,e,n,a){MR(t,oN(1),n);let r=lN(t,-1);return null===r&&dN(t,UN("'package.%s' must be a string"),n),jN(t,e,r,UN("."),a)},XN=function(t,e,n){return e?(YR(t,n),2):dN(t,UN("error loading module '%s' from file '%s':\n\t%s"),lN(t,1),n,lN(t,-1))},zN=function(t){let e=hN(t,1),n=HN(t,e,UN("path",!0),UN(SN,!0));return null===n?1:XN(t,TN(t,n)===RR,n)},JN=function(t,e,n){let a;n=gN(t,n,UN("."),MN);let r=mN(n,"-".charCodeAt(0));if(r>=0){a=JR(t,n,r),a=jR(t,UN("%s%s"),IN,a);let u=DN(t,e,a);if(2!==u)return u;n=r+1}return a=jR(t,UN("%s%s"),IN,n),DN(t,e,a)},qN=function(t){let e=hN(t,1),n=HN(t,e,UN("jspath",!0),UN(wN,!0));return null===n?1:XN(t,0===JN(t,n,e),n)},YN=function(t){let e,n=hN(t,1),a=mN(n,".".charCodeAt(0));if(a<0)return 0;JR(t,n,a);let r=HN(t,lN(t,-1),UN("jspath",!0),UN(wN,!0));return null===r?1:0!==(e=JN(t,r,n))?2!=e?XN(t,0,r):(YR(t,UN("\n\tno module '%s' in file '%s'"),n,r),1):(YR(t,r),2)},WN=function(t){let e=hN(t,1);return MR(t,NR,cN),MR(t,-1,e)===yR&&jR(t,UN("\n\tno field package.preload['%s']"),e),1},ZN=function(t,e,n){for(;e===RR?(ZR(t,3,n.i)===yR&&(VR(t,1),ON(n.msg),dN(t,UN("module '%s' not found:%s"),n.name,lN(t,-1))),YR(t,n.name),SR(t,1,2,n,ZN)):e=RR,!xR(t,-2);n.i++)DR(t,-2)?(VR(t,1),_N(n.msg)):VR(t,2);return n.k(t,RR,n.ctx)},QN=function(t,e,n){return YR(t,n),PR(t,-2),SR(t,2,1,n,$N),$N(t,RR,n)},$N=function(t,e,n){let a=n;return CR(t,-1)||nN(t,2,a),MR(t,2,a)==yR&&(GR(t,1),WR(t,-1),nN(t,2,a)),1},ty={loadlib:function(t){let e=hN(t,1),n=hN(t,2),a=DN(t,e,n);return 0===a?1:(qR(t),PR(t,-2),zR(t,1===a?"open":"init"),3)},searchpath:function(t){return null!==jN(t,hN(t,1),hN(t,2),bN(t,3,"."),bN(t,4,bR))?1:(qR(t),PR(t,-2),2)}},ey={require:function(t){let e=hN(t,1);return rN(t,1),MR(t,NR,iN),MR(t,2,e),uN(t,-1)?1:(VR(t,1),function(t,e,n,a){let r=new fN;return pN(t,r),MR(t,oN(1),UN("searchers",!0))!==wR&&dN(t,UN("'package.searchers' must be a table")),ZN(t,RR,{name:e,i:1,msg:r,ctx:n,k:a})}(t,e,e,QN))}};var ny={luaopen_package:function(t){return function(t){BR(t),IR(t,0,1),aN(t,-2),tN(t,NR,yN)}(t),vN(t,ty),function(t){let e=[WN,zN,qN,YN,null];IR(t);for(let n=0;e[n];n++)WR(t,-2),KR(t,e[n],1),$R(t,-2,n+1);nN(t,-2,UN("searchers",!0))}(t),VN(t,UN("path",!0),"LUA_PATH",mR),VN(t,UN("jspath",!0),"LUA_JSPATH",kR),zR(t,bR+"\n"+UR+"\n"+ER+"\n"+OR+"\n-\n"),nN(t,-2,UN("config",!0)),LN(t,NR,iN),nN(t,-2,UN("loaded",!0)),LN(t,NR,cN),nN(t,-2,UN("preload",!0)),HR(t),WR(t,-2),kN(t,ey,1),VR(t,1),1}};const{lua_pushinteger:ay,lua_pushliteral:ry,lua_setfield:uy}=Vd,{luaL_newlib:ly}=iA,{FENGARI_AUTHORS:sy,FENGARI_COPYRIGHT:oy,FENGARI_RELEASE:iy,FENGARI_VERSION:cy,FENGARI_VERSION_MAJOR:fy,FENGARI_VERSION_MINOR:_y,FENGARI_VERSION_NUM:py,FENGARI_VERSION_RELEASE:hy,to_luastring:dy}=G;var Ly={luaopen_fengari:function(t){return ly(t,{}),ry(t,sy),uy(t,-2,dy("AUTHORS")),ry(t,oy),uy(t,-2,dy("COPYRIGHT")),ry(t,iy),uy(t,-2,dy("RELEASE")),ry(t,cy),uy(t,-2,dy("VERSION")),ry(t,fy),uy(t,-2,dy("VERSION_MAJOR")),ry(t,_y),uy(t,-2,dy("VERSION_MINOR")),ay(t,py),uy(t,-2,dy("VERSION_NUM")),ry(t,hy),uy(t,-2,dy("VERSION_RELEASE")),1}};const{lua_pop:gy}=Vd,{luaL_requiref:Ay}=iA,{to_luastring:Ty}=G,vy={};var by=function(t){for(let e in vy)Ay(t,Ty(e),vy[e],1),gy(t,1)};const{luaopen_base:Oy}=CT,{luaopen_coroutine:ky}=Av,{luaopen_debug:my}=vR,{luaopen_math:Ey}=jE,{luaopen_package:Uy}=ny,{luaopen_os:Ry}=LO,{luaopen_string:Ny}=Sm,{luaopen_table:yy}=Tb,{luaopen_utf8:wy}=iE;vy._G=Oy,vy[xy.LUA_LOADLIBNAME]=Uy,vy[xy.LUA_COLIBNAME]=ky,vy[xy.LUA_TABLIBNAME]=yy,vy[xy.LUA_OSLIBNAME]=Ry,vy[xy.LUA_STRLIBNAME]=Ny,vy[xy.LUA_MATHLIBNAME]=Ey,vy[xy.LUA_UTF8LIBNAME]=wy,vy[xy.LUA_DBLIBNAME]=my;const{luaopen_fengari:Sy}=Ly;vy[xy.LUA_FENGARILIBNAME]=Sy;var Iy={luaL_openlibs:by};const{LUA_VERSION_MAJOR:My,LUA_VERSION_MINOR:Py}=Vd;var xy={LUA_VERSUFFIX:"_"+My+"_"+Py,lua_assert:function(t){},luaopen_base:CT.luaopen_base,LUA_COLIBNAME:"coroutine",luaopen_coroutine:Av.luaopen_coroutine,LUA_TABLIBNAME:"table",luaopen_table:Tb.luaopen_table,LUA_OSLIBNAME:"os",luaopen_os:LO.luaopen_os,LUA_STRLIBNAME:"string",luaopen_string:Sm.luaopen_string,LUA_UTF8LIBNAME:"utf8",luaopen_utf8:iE.luaopen_utf8,LUA_BITLIBNAME:"bit32",LUA_MATHLIBNAME:"math",luaopen_math:jE.luaopen_math,LUA_DBLIBNAME:"debug",luaopen_debug:vR.luaopen_debug,LUA_LOADLIBNAME:"package",luaopen_package:ny.luaopen_package,LUA_FENGARILIBNAME:"fengari",luaopen_fengari:Ly.luaopen_fengari,luaL_openlibs:Iy.luaL_openlibs},Cy={FENGARI_AUTHORS:G.FENGARI_AUTHORS,FENGARI_COPYRIGHT:G.FENGARI_COPYRIGHT,FENGARI_RELEASE:G.FENGARI_RELEASE,FENGARI_VERSION:G.FENGARI_VERSION,FENGARI_VERSION_MAJOR:G.FENGARI_VERSION_MAJOR,FENGARI_VERSION_MINOR:G.FENGARI_VERSION_MINOR,FENGARI_VERSION_NUM:G.FENGARI_VERSION_NUM,FENGARI_VERSION_RELEASE:G.FENGARI_VERSION_RELEASE,luastring_eq:G.luastring_eq,luastring_indexOf:G.luastring_indexOf,luastring_of:G.luastring_of,to_jsstring:G.to_jsstring,to_luastring:G.to_luastring,to_uristring:G.to_uristring,luaconf:g,lua:Vd,lauxlib:iA,lualib:xy};const{lua:Dy,lauxlib:By,lualib:Vy,to_luastring:Gy}=Cy,{LUA_MULTRET:Ky,LUA_OK:Fy,LUA_REGISTRYINDEX:jy,LUA_RIDX_MAINTHREAD:Hy,LUA_TBOOLEAN:Xy,LUA_TFUNCTION:zy,LUA_TLIGHTUSERDATA:Jy,LUA_TNIL:qy,LUA_TNONE:Yy,LUA_TNUMBER:Wy,LUA_TSTRING:Zy,LUA_TTABLE:Qy,LUA_TTHREAD:$y,LUA_TUSERDATA:tw,lua_atnativeerror:ew,lua_call:nw,lua_getfield:aw,lua_gettable:rw,lua_gettop:uw,lua_isnil:lw,lua_isproxy:sw,lua_newuserdata:ow,lua_pcall:iw,lua_pop:cw,lua_pushboolean:fw,lua_pushcfunction:_w,lua_pushinteger:pw,lua_pushlightuserdata:hw,lua_pushliteral:dw,lua_pushnil:Lw,lua_pushnumber:gw,lua_pushstring:Aw,lua_pushvalue:Tw,lua_rawgeti:vw,lua_rawgetp:bw,lua_rawsetp:Ow,lua_rotate:kw,lua_setfield:mw,lua_settable:Ew,lua_settop:Uw,lua_toboolean:Rw,lua_tojsstring:Nw,lua_tonumber:yw,lua_toproxy:ww,lua_tothread:Sw,lua_touserdata:Iw,lua_type:Mw}=Dy,{luaL_argerror:Pw,luaL_checkany:xw,luaL_checkoption:Cw,luaL_checkstack:Dw,luaL_checkudata:Bw,luaL_error:Vw,luaL_getmetafield:Gw,luaL_newlib:Kw,luaL_newmetatable:Fw,luaL_requiref:jw,luaL_setfuncs:Hw,luaL_setmetatable:Xw,luaL_testudata:zw,luaL_tolstring:Jw}=By,{luaopen_base:qw}=Vy,Yw="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:(0,eval)("this");let Ww,Zw,Qw;if("undefined"!=typeof Reflect)Ww=Reflect.apply,Zw=Reflect.construct,Qw=Reflect.deleteProperty;else{const t=Function.apply,e=Function.bind;Ww=function(e,n,a){return t.call(e,n,a)},Zw=function(t,n){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}let a=[null];return a.push.apply(a,n),new(e.apply(t,a))},Qw=Function("t","k","delete t[k]")}const $w=String.prototype.concat.bind(""),tS=function(t){return"object"==typeof t?null!==t:"function"==typeof t},eS=Gy("js object"),nS=function(t,e){let n=zw(t,e,eS);return n?n.data:void 0},aS=function(t,e){return Bw(t,e,eS).data},rS=function(t,e){ow(t).data=e,Xw(t,eS)},uS=function(t){vw(t,jy,Hy);let e=Sw(t,-1);return cw(t,1),e},lS=new WeakMap,sS=function(t,e){switch(typeof e){case"undefined":Lw(t);break;case"number":gw(t,e);break;case"string":Aw(t,Gy(e));break;case"boolean":fw(t,e);break;case"symbol":hw(t,e);break;case"function":if(sw(e,t)){e(t);break}case"object":if(null===e){if(bw(t,jy,null)!==tw)throw Error("js library not loaded into lua_State");break}default:{let n=lS.get(uS(t));if(!n)throw Error("js library not loaded into lua_State");let a=n.get(e);a?a(t):(rS(t,e),a=ww(t,-1),n.set(e,a))}}},oS=function(t){let e=Iw(t,1);return sS(t,e),1},iS=function(t,e){switch(Mw(t,e)){case Yy:case qy:return;case Xy:return Rw(t,e);case Jy:return Iw(t,e);case Wy:return yw(t,e);case Zy:return Nw(t,e);case tw:{let n=nS(t,e);if(void 0!==n)return n}case Qy:case zy:case $y:default:return TS(t,ww(t,e))}},cS=function(t,e){let n=iw(t,e,1,0),a=iS(t,-1);switch(cw(t,1),n){case Fy:return a;default:throw a}},fS=function(t,e,n,a,r){if(!tS(a))throw new TypeError("`args` argument must be an object");let u=+a.length;u>=0||(u=0),Dw(t,2+u,null);let l=uw(t);e(t),sS(t,n);for(let e=0;e<u;e++)sS(t,a[e]);switch(iw(t,1+u,r,0)){case Fy:{let e=uw(t)-l,n=new Array(e);for(let a=0;a<e;a++)n[a]=iS(t,l+a+1);return Uw(t,l),n}default:{let e=iS(t,-1);throw Uw(t,l),e}}},_S=function(t){return rw(t,1),1},pS=function(t,e,n){return Dw(t,3,null),_w(t,_S),e(t),sS(t,n),cS(t,2)},hS=function(t,e,n){switch(Dw(t,3,null),_w(t,_S),e(t),sS(t,n),iw(t,2,1,0)){case Fy:{let e=lw(t,-1);return cw(t,1),!e}default:{let e=iS(t,-1);throw cw(t,1),e}}},dS=function(t,e,n,a){switch(Dw(t,4,null),_w(t,(function(t){return Ew(t,1),0})),e(t),sS(t,n),sS(t,a),iw(t,3,0,0)){case Fy:return;default:{let e=iS(t,-1);throw cw(t,1),e}}},LS=function(t,e,n){switch(Dw(t,4,null),_w(t,(function(t){return Ew(t,1),0})),e(t),sS(t,n),Lw(t),iw(t,3,0,0)){case Fy:return;default:{let e=iS(t,-1);throw cw(t,1),e}}},gS=function(t,e){return Dw(t,2,null),_w(t,(function(t){return Jw(t,1),1})),e(t),cS(t,1)},AS=function(){let t=this.L;Dw(t,3,null);let e=uw(t);switch(this.iter(t),this.state(t),this.last(t),iw(t,2,Ky,0)){case Fy:{let n;if(this.last=ww(t,e+1),lw(t,-1))n={done:!0,value:void 0};else{let a=uw(t)-e,r=new Array(a);for(let n=0;n<a;n++)r[n]=iS(t,e+n+1);n={done:!1,value:r}}return Uw(t,e),n}default:{let e=iS(t,-1);throw cw(t,1),e}}},TS=function(t,e){const n=uS(t);let a=function(){return fS(n,e,this,arguments,1)[0]};a.apply=function(t,a){return fS(n,e,t,a,1)[0]},a.invoke=function(t,a){return fS(n,e,t,a,Ky)},a.get=function(t){return pS(n,e,t)},a.has=function(t){return hS(n,e,t)},a.set=function(t,a){return dS(n,e,t,a)},a.delete=function(t){return LS(n,e,t)},a.toString=function(){return gS(n,e)},"function"==typeof Symbol&&(a[Symbol.toStringTag]="Fengari object",a[Symbol.iterator]=function(){return function(t,e){switch(Dw(t,1,null),_w(t,(function(t){return jw(t,Gy("_G"),qw,0),aw(t,-1,Gy("pairs")),e(t),nw(t,1,3),3})),iw(t,0,3,0)){case Fy:{let e=ww(t,-3),n=ww(t,-2),a=ww(t,-1);return cw(t,3),{L:t,iter:e,state:n,last:a,next:AS}}default:{let e=iS(t,-1);throw cw(t,1),e}}}(n,e)},Symbol.toPrimitive&&(a[Symbol.toPrimitive]=function(t){if("string"===t)return gS(n,e)}));let r=lS.get(n);if(!r)throw Error("js library not loaded into lua_State");return r.set(a,e),a},vS={new:function(t){let e=iS(t,1),n=uw(t)-1,a=new Array(n);for(let e=0;e<n;e++)a[e]=iS(t,e+2);return sS(t,Zw(e,a)),1},tonumber:function(t){let e=iS(t,1);return gw(t,+e),1},tostring:function(t){let e=iS(t,1);return dw(t,$w(e)),1},instanceof:function(t){let e=iS(t,1),n=iS(t,2);return fw(t,e instanceof n),1},typeof:function(t){let e=iS(t,1);return dw(t,typeof e),1}};if("function"==typeof Symbol&&Symbol.iterator){const t=function(t,e){let n=aS(t,e),a=n[Symbol.iterator];a||Pw(t,e,Gy("object not iterable"));let r=Ww(a,n,[]);return tS(r)||Pw(t,e,Gy("Result of the Symbol.iterator method is not an object")),r},e=function(t){let e=iS(t,1).next();return e.done?0:(sS(t,e.value),1)};vS.of=function(n){let a=t(n,1);return _w(n,e),sS(n,a),2}}if("function"==typeof Proxy&&"function"==typeof Symbol){const t=Symbol("lua_State"),e=Symbol("fengari-proxy"),n={apply:function(n,a,r){return fS(n[t],n[e],a,r,1)[0]},construct:function(n,a){let r=n[t],u=n[e],l=a.length;Dw(r,2+l,null),u(r);let s=uw(r);if(Gw(r,s,Gy("construct"))===qy)throw cw(r,1),new TypeError("not a constructor");kw(r,s,1);for(let t=0;t<l;t++)sS(r,a[t]);return cS(r,1+l)},defineProperty:function(n,a,r){let u=n[t],l=n[e];return Dw(u,4,null),l(u),Gw(u,-1,Gy("defineProperty"))===qy?(cw(u,1),!1):(kw(u,-2,1),sS(u,a),sS(u,r),cS(u,3))},deleteProperty:function(n,a){return LS(n[t],n[e],a)},get:function(n,a){return pS(n[t],n[e],a)},getOwnPropertyDescriptor:function(n,a){let r=n[t],u=n[e];if(Dw(r,3,null),u(r),Gw(r,-1,Gy("getOwnPropertyDescriptor"))!==qy)return kw(r,-2,1),sS(r,a),cS(r,2);cw(r,1)},getPrototypeOf:function(n){let a=n[t],r=n[e];return Dw(a,2,null),r(a),Gw(a,-1,Gy("getPrototypeOf"))===qy?(cw(a,1),null):(kw(a,-2,1),cS(a,1))},has:function(n,a){return hS(n[t],n[e],a)},ownKeys:function(n){let a=n[t],r=n[e];if(Dw(a,2,null),r(a),Gw(a,-1,Gy("ownKeys"))===qy)throw cw(a,1),Error("ownKeys unknown for fengari object");return kw(a,-2,1),cS(a,1)},set:function(n,a,r){return dS(n[t],n[e],a,r),!0},setPrototypeOf:function(n,a){let r=n[t],u=n[e];return Dw(r,3,null),u(r),Gw(r,-1,Gy("setPrototypeOf"))===qy?(cw(r,1),!1):(kw(r,-2,1),sS(r,a),cS(r,2))}},a=function(){let t=function(){}.bind();return delete t.length,delete t.name,t},r=Function("return ()=>void 0;"),u=function(){let t=r();return delete t.length,delete t.name,t},l=function(r,l,s){const o=uS(r);let i;switch(s){case"function":i=a();break;case"arrow_function":i=u();break;case"object":i={};break;default:throw TypeError("invalid type to createproxy")}return i[e]=l,i[t]=o,new Proxy(i,n)},s=["function","arrow_function","object"],o=s.map(t=>Gy(t));vS.createproxy=function(t){xw(t,1);let e=s[Cw(t,2,o[0],o)],n=l(t,ww(t,1),e);return sS(t,n),1}}let bS={__index:function(t){let e=aS(t,1),n=iS(t,2);return sS(t,e[n]),1},__newindex:function(t){let e=aS(t,1),n=iS(t,2),a=iS(t,3);return void 0===a?Qw(e,n):e[n]=a,0},__tostring:function(t){let e=aS(t,1),n=$w(e);return Aw(t,Gy(n)),1},__call:function(t){let e,n=aS(t,1),a=uw(t)-1,r=new Array(Math.max(0,a-1));if(a>0&&(e=iS(t,2),a-- >0))for(let e=0;e<a;e++)r[e]=iS(t,e+3);return sS(t,Ww(n,e,r)),1},__pairs:function(t){let e,n,a,r,u=aS(t,1);if("function"!=typeof Symbol||void 0===(e=u[Symbol.for("__pairs")]))n=function(t){if(this.index>=this.keys.length)return;let e=this.keys[this.index++];return[e,this.object[e]]},a={object:u,keys:Object.keys(u),index:0};else{let l=Ww(e,u,[]);void 0===l&&Vw(t,Gy("bad '__pairs' result (object with keys 'iter', 'state', 'first' expected)")),n=l.iter,void 0===n&&Vw(t,Gy("bad '__pairs' result (object.iter is missing)")),a=l.state,r=l.first}return _w(t,(function(){let e=iS(t,1),a=iS(t,2),r=Ww(n,e,[a]);if(void 0===r)return 0;Array.isArray(r)||Vw(t,Gy("bad iterator result (Array or undefined expected)")),Dw(t,r.length,null);for(let e=0;e<r.length;e++)sS(t,r[e]);return r.length})),sS(t,a),sS(t,r),3},__len:function(t){let e,n,a=aS(t,1);return n="function"!=typeof Symbol||void 0===(e=a[Symbol.for("__len")])?a.length:Ww(e,a,[]),sS(t,n),1}};var OS={FENGARI_INTEROP_VERSION:"0.1",FENGARI_INTEROP_VERSION_NUM:1,FENGARI_INTEROP_RELEASE:"0.1.2",checkjs:aS,testjs:nS,pushjs:rS,push:sS,tojs:iS,luaopen_js:function(t){return lS.set(uS(t),new WeakMap),ew(t,oS),Kw(t,vS),dw(t,"0.1"),mw(t,-2,Gy("_VERSION")),pw(t,1),mw(t,-2,Gy("_VERSION_NUM")),dw(t,"0.1.2"),mw(t,-2,Gy("_RELEASE")),Fw(t,eS),Hw(t,bS,0),cw(t,1),rS(t,null),Tw(t,-1),Ow(t,jy,null),mw(t,-2,Gy("null")),sS(t,Yw),mw(t,-2,Gy("global")),1}};var kS=function(t){for(var e=unescape(encodeURIComponent(e)),n="",a=0;a<e.length;a++)n+=e.charCodeAt(a).toString(16);return n},mS=function(t){return window.atob(t)},ES=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t),this.ref=e.ref,this.params=e.params||[],this.op=e.op,this.index=e.index,this.dataIndex=e.dataIndex}return u(t,[{key:"exec",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.index&&t.set("ctx.cell_index",this.index),this.dataIndex&&t.set("ctx.data_index",this.dataIndex);var n=t.eval(this.op,{decode:!0}),a=n.apply(void 0,[e.state].concat(h(this.params)));return e.decode?t.decode(a):a}},{key:"isValid",get:function(){var t=this;return["ref","op"].every((function(e){return t[e]&&t[e].length}))}}],[{key:"fromBPU",value:function(t){var e=this,n=t.cell,a=t.i,r=n.shift();return new this({ref:this._decodeRef(r),params:n.map((function(t){return e._normalizeParam(t)})),index:a,dataIndex:r.ii})}},{key:"_decodeRef",value:function(t){var e=t.b,n=mS(e);return h(n).some((function(t){return t.charCodeAt(0)>127}))?kS(n):n}},{key:"_normalizeParam",value:function(t){var e=t.b;return e?mS(e):null}}]),t}(),US=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t),this.tx=e.tx,this.index=e.index,this.cells=e.cells||[],this.result=null,this.error=null}return u(t,[{key:"run",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.state,r=void 0===n.strict||n.strict;t.set("ctx.tx",this.tx||null),t.set("ctx.tape_index",this.index||0);var u=t.decode(this.cells.reduce((function(n,a){try{return a.exec(t,{state:n})}catch(t){if(r)throw e.error=t,t;return n}}),a));return this.result=u,u}},{key:"setCellOps",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.forEach((function(t){var a=Object.keys(n).filter((function(e){return n[e]===t.ref}));return a.length||a.push(t.ref),e.cells.forEach((function(e){a.includes(e.ref)&&(e.op=t.fn)})),e}))}},{key:"getOpRefs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.cells.map((function(t){return t.ref})).filter((function(t,e,n){return n.indexOf(t)===e})).map((function(e){return t[e]||e}))}},{key:"isValid",get:function(){return this.cells.every((function(t){return t.isValid}))}}],[{key:"fromBPU",value:function(t,e){var n,a=this;if(void 0===e){var r=t.out.findIndex((function(t){return a._isOpReturnOutput(t)}));return this.fromBPU(t,r)}if(!(e>-1&&t.out[e]&&this._isOpReturnOutput(t.out[e])))throw new Error("No tape found in transaction.");return n=t.out[e].tape.filter((function(t){return!a._isOpReturnCell(t)})).map((function(t){return ES.fromBPU(t)})),new this({tx:t,index:e,cells:n})}},{key:"_isOpReturnOutput",value:function(t){var e=t.tape;return this._isOpReturnCell(e[0])}},{key:"_isOpReturnCell",value:function(t){return t.cell.some((function(t){return 106===t.op}))}}]),t}(),RS=Cy.lua,NS=Cy.lauxlib,yS=Cy.lualib,wS=Cy.to_luastring,SS=["./vm/extension/agent","./vm/extension/base","./vm/extension/context","./vm/extension/crypto","./vm/extension/json"].map((function(t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()})),IS=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.agent=n.agent;var r=n.extensions||[];this._vm=NS.luaL_newstate(),yS.luaL_openlibs(this._vm),OS.luaopen_js(this._vm),SS.concat(r).forEach((function(e){return t.extend(e)}))}return u(e,[{key:"extend",value:function(t){var e=this;return Array.isArray(t)&&t.forEach((function(t){return e.extend(t)})),t.extend(this),this}},{key:"get",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t)return this.get(t.split("."),n);t.forEach((function(t,n){(0===n?RS.lua_getglobal(e._vm,wS(t)):RS.lua_getfield(e._vm,-1,wS(t)))<=0&&e._throwError()}));var a=OS.tojs(this._vm,-1);return this.normalize(a,n)}},{key:"set",value:function(e,n){var a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.force?this.setDeep(e,n):"string"==typeof e?this.set(e.split("."),n):(e.forEach((function(r,u){var l;if(u===e.length-1&&(n&&"object"===t(n)&&0===Object.keys(n).length?RS.lua_createtable(a._vm,0,0):OS.push(a._vm,n)),0===u?1===e.length?RS.lua_setglobal(a._vm,wS(r)):l=RS.lua_getglobal(a._vm,wS(r)):u===e.length-1?RS.lua_setfield(a._vm,-2,wS(r)):l=RS.lua_getfield(a._vm,-1,wS(r)),u<e.length-1&&![5,7].includes(l))throw new Error("Invalid Lua path.");l<=0&&a._throwError()})),RS.lua_settop(this._vm,0),this)}},{key:"setDeep",value:function(t,e){if("string"==typeof t)return this.setDeep(t.split("."),e);var n=!0,a=!1,r=void 0;try{for(var u,l=t.entries()[Symbol.iterator]();!(n=(u=l.next()).done);n=!0){var s=p(u.value,2),o=s[0],i=s[1],c=void 0;if(o===t.length-1)return this.set(t,e);RS.lua_createtable(this._vm,0,0),0===o?(RS.lua_setglobal(this._vm,wS(i)),c=RS.lua_getglobal(this._vm,wS(i))):o<t.length-1&&(RS.lua_setfield(this._vm,-2,wS(i)),c=RS.lua_getfield(this._vm,-1,wS(i))),c<=0&&this._throwError()}}catch(t){a=!0,r=t}finally{try{n||null==l.return||l.return()}finally{if(a)throw r}}}},{key:"setFunction",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.set(t,(function(){return e.bind(void 0,this).apply(void 0,arguments)}),n),this}},{key:"eval",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};0!==NS.luaL_dostring(this._vm,wS(t))&&this._throwError();var n=OS.tojs(this._vm,-1);return this.normalize(n,e)}},{key:"exec",value:function(t){return 0!==NS.luaL_dostring(this._vm,wS(t))&&this._throwError(),this}},{key:"call",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof t)return this.call(t.split("."),n);t.forEach((function(t,n){var a=wS(t);(0===n?RS.lua_getglobal(e._vm,a):RS.lua_getfield(e._vm,-1,a))<=0&&e._throwError()})),n.forEach((function(t){return OS.push(e._vm,t)})),0!==RS.lua_pcall(this._vm,n.length,1,0)&&this._throwError();var r=OS.tojs(this._vm,-1);return this.normalize(r,a)}},{key:"normalize",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Array.isArray(t)&&1===t.length?this.normalize(t[0],e):e.decode?this.decode(t):t}},{key:"decode",value:function(t){var e=this;if("function"!=typeof t)return t;var n=t.toString();if(/^function/.test(n))return function(){try{for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];var u=a.shift(),l=t.invoke(u,a);return e.normalize(l)}catch(t){throw new Error("Lua Error: ".concat(t))}};if(/^table/.test(n)){var a=new Map,r=!0,u=!1,l=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var i=p(s.value,2),c=i[0],f=i[1];a.set(c,this.decode(f))}}catch(t){u=!0,l=t}finally{try{r||null==o.return||o.return()}finally{if(u)throw l}}return Array.from(a.keys()).every(Number.isInteger)?Array.from(a.values()).reverse():a}}},{key:"_throwError",value:function(){var t=RS.lua_tojsstring(this._vm,-1);throw new Error("Lua Error: ".concat(t))}}]),e}(),MS=function(t,e){return function(){for(var n=new Array(arguments.length),a=0;a<n.length;a++)n[a]=arguments[a];return t.apply(e,n)}},PS=Object.prototype.toString;function xS(t){return"[object Array]"===PS.call(t)}function CS(t){return null!==t&&"object"==typeof t}function DS(t){return"[object Function]"===PS.call(t)}function BS(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),xS(t))for(var n=0,a=t.length;n<a;n++)e.call(null,t[n],n,t);else for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.call(null,t[r],r,t)}var VS={isArray:xS,isArrayBuffer:function(t){return"[object ArrayBuffer]"===PS.call(t)},isBuffer:function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:CS,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===PS.call(t)},isFile:function(t){return"[object File]"===PS.call(t)},isBlob:function(t){return"[object Blob]"===PS.call(t)},isFunction:DS,isStream:function(t){return CS(t)&&DS(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:BS,merge:function t(){var e={};function n(n,a){"object"==typeof e[a]&&"object"==typeof n?e[a]=t(e[a],n):e[a]=n}for(var a=0,r=arguments.length;a<r;a++)BS(arguments[a],n);return e},deepMerge:function t(){var e={};function n(n,a){"object"==typeof e[a]&&"object"==typeof n?e[a]=t(e[a],n):e[a]="object"==typeof n?t({},n):n}for(var a=0,r=arguments.length;a<r;a++)BS(arguments[a],n);return e},extend:function(t,e,n){return BS(e,(function(e,a){t[a]=n&&"function"==typeof e?MS(e,n):e})),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}};function GS(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var KS=function(t,e,n){if(!e)return t;var a;if(n)a=n(e);else if(VS.isURLSearchParams(e))a=e.toString();else{var r=[];VS.forEach(e,(function(t,e){null!=t&&(VS.isArray(t)?e+="[]":t=[t],VS.forEach(t,(function(t){VS.isDate(t)?t=t.toISOString():VS.isObject(t)&&(t=JSON.stringify(t)),r.push(GS(e)+"="+GS(t))})))})),a=r.join("&")}if(a){var u=t.indexOf("#");-1!==u&&(t=t.slice(0,u)),t+=(-1===t.indexOf("?")?"?":"&")+a}return t};function FS(){this.handlers=[]}FS.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},FS.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},FS.prototype.forEach=function(t){VS.forEach(this.handlers,(function(e){null!==e&&t(e)}))};var jS=FS,HS=function(t,e,n){return VS.forEach(n,(function(n){t=n(t,e)})),t},XS=function(t){return!(!t||!t.__CANCEL__)},zS=function(t,e){VS.forEach(t,(function(n,a){a!==e&&a.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[a])}))},JS=function(t,e,n,a,r){return function(t,e,n,a,r){return t.config=e,n&&(t.code=n),t.request=a,t.response=r,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}(new Error(t),e,n,a,r)},qS=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],YS=VS.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function a(t){var a=t;return e&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=a(window.location.href),function(e){var n=VS.isString(e)?a(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0},WS=VS.isStandardBrowserEnv()?{write:function(t,e,n,a,r,u){var l=[];l.push(t+"="+encodeURIComponent(e)),VS.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),VS.isString(a)&&l.push("path="+a),VS.isString(r)&&l.push("domain="+r),!0===u&&l.push("secure"),document.cookie=l.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},ZS=function(t){return new Promise((function(e,n){var a=t.data,r=t.headers;VS.isFormData(a)&&delete r["Content-Type"];var u=new XMLHttpRequest;if(t.auth){var l=t.auth.username||"",s=t.auth.password||"";r.Authorization="Basic "+btoa(l+":"+s)}if(u.open(t.method.toUpperCase(),KS(t.url,t.params,t.paramsSerializer),!0),u.timeout=t.timeout,u.onreadystatechange=function(){if(u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))){var a,r,l,s,o,i="getAllResponseHeaders"in u?(a=u.getAllResponseHeaders(),o={},a?(VS.forEach(a.split("\n"),(function(t){if(s=t.indexOf(":"),r=VS.trim(t.substr(0,s)).toLowerCase(),l=VS.trim(t.substr(s+1)),r){if(o[r]&&qS.indexOf(r)>=0)return;o[r]="set-cookie"===r?(o[r]?o[r]:[]).concat([l]):o[r]?o[r]+", "+l:l}})),o):o):null,c={data:t.responseType&&"text"!==t.responseType?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:i,config:t,request:u};!function(t,e,n){var a=n.config.validateStatus;!a||a(n.status)?t(n):e(JS("Request failed with status code "+n.status,n.config,null,n.request,n))}(e,n,c),u=null}},u.onabort=function(){u&&(n(JS("Request aborted",t,"ECONNABORTED",u)),u=null)},u.onerror=function(){n(JS("Network Error",t,null,u)),u=null},u.ontimeout=function(){n(JS("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",u)),u=null},VS.isStandardBrowserEnv()){var o=WS,i=(t.withCredentials||YS(t.url))&&t.xsrfCookieName?o.read(t.xsrfCookieName):void 0;i&&(r[t.xsrfHeaderName]=i)}if("setRequestHeader"in u&&VS.forEach(r,(function(t,e){void 0===a&&"content-type"===e.toLowerCase()?delete r[e]:u.setRequestHeader(e,t)})),t.withCredentials&&(u.withCredentials=!0),t.responseType)try{u.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&u.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){u&&(u.abort(),n(t),u=null)})),void 0===a&&(a=null),u.send(a)}))},QS={"Content-Type":"application/x-www-form-urlencoded"};function $S(t,e){!VS.isUndefined(t)&&VS.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var tI={adapter:function(){var t;return"undefined"!=typeof XMLHttpRequest&&(t=ZS),t}(),transformRequest:[function(t,e){return zS(e,"Accept"),zS(e,"Content-Type"),VS.isFormData(t)||VS.isArrayBuffer(t)||VS.isBuffer(t)||VS.isStream(t)||VS.isFile(t)||VS.isBlob(t)?t:VS.isArrayBufferView(t)?t.buffer:VS.isURLSearchParams(t)?($S(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):VS.isObject(t)?($S(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};VS.forEach(["delete","get","head"],(function(t){tI.headers[t]={}})),VS.forEach(["post","put","patch"],(function(t){tI.headers[t]=VS.merge(QS)}));var eI=tI;function nI(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var aI=function(t){var e,n,a;return nI(t),t.baseURL&&(a=t.url,!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(a))&&(t.url=(e=t.baseURL,(n=t.url)?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e)),t.headers=t.headers||{},t.data=HS(t.data,t.headers,t.transformRequest),t.headers=VS.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),VS.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||eI.adapter)(t).then((function(e){return nI(t),e.data=HS(e.data,e.headers,t.transformResponse),e}),(function(e){return XS(e)||(nI(t),e&&e.response&&(e.response.data=HS(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))},rI=function(t,e){e=e||{};var n={};return VS.forEach(["url","method","params","data"],(function(t){void 0!==e[t]&&(n[t]=e[t])})),VS.forEach(["headers","auth","proxy"],(function(a){VS.isObject(e[a])?n[a]=VS.deepMerge(t[a],e[a]):void 0!==e[a]?n[a]=e[a]:VS.isObject(t[a])?n[a]=VS.deepMerge(t[a]):void 0!==t[a]&&(n[a]=t[a])})),VS.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],(function(a){void 0!==e[a]?n[a]=e[a]:void 0!==t[a]&&(n[a]=t[a])})),n};function uI(t){this.defaults=t,this.interceptors={request:new jS,response:new jS}}uI.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=rI(this.defaults,t)).method=t.method?t.method.toLowerCase():"get";var e=[aI,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach((function(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function(t){e.push(t.fulfilled,t.rejected)}));e.length;)n=n.then(e.shift(),e.shift());return n},uI.prototype.getUri=function(t){return t=rI(this.defaults,t),KS(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},VS.forEach(["delete","get","head","options"],(function(t){uI.prototype[t]=function(e,n){return this.request(VS.merge(n||{},{method:t,url:e}))}})),VS.forEach(["post","put","patch"],(function(t){uI.prototype[t]=function(e,n,a){return this.request(VS.merge(a||{},{method:t,url:e,data:n}))}}));var lI=uI;function sI(t){this.message=t}sI.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},sI.prototype.__CANCEL__=!0;var oI=sI;function iI(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var n=this;t((function(t){n.reason||(n.reason=new oI(t),e(n.reason))}))}iI.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},iI.source=function(){var t;return{token:new iI((function(e){t=e})),cancel:t}};var cI=iI;function fI(t){var e=new lI(t),n=MS(lI.prototype.request,e);return VS.extend(n,lI.prototype,e),VS.extend(n,e),n}var _I=fI(eI);_I.Axios=lI,_I.create=function(t){return fI(rI(_I.defaults,t))},_I.Cancel=oI,_I.CancelToken=cI,_I.isCancel=XS,_I.all=function(t){return Promise.all(t)},_I.spread=function(t){return function(e){return t.apply(null,e)}};var pI=_I,hI=_I;pI.default=hI;var dI=pI,LI=dI.create({baseURL:"https://bob.planaria.network/q/1GgmC7Cg782YtQ6R9QkM58voyWeQJmJJzG/"}),gI=function(t){function e(){return a(this,e),_(this,c(e).apply(this,arguments))}return i(e,t),u(e,null,[{key:"fetchTx",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n=o({apiKey:""},n);var a=this._encodeQuery({v:"3",q:{find:{"tx.h":t,"out.tape":{$elemMatch:{i:0,"cell.op":106}}},limit:1}}),r={key:n.apiKey};return this.client.get(a,{headers:r}).then((function(t){return e._toBPU(t.data)[0]}))}},{key:"fetchTxBy",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n=o({apiKey:""},n),delete t.project;var a=this._encodeQuery({v:"3",q:o({limit:10},t)}),r={key:n.apiKey};return this.client.get(a,{headers:r}).then((function(t){return e._toBPU(t.data)}))}},{key:"_toBPU",value:function(t){return t.c.concat(t.u).map((function(t){return t.txid=t.tx.h,delete t.tx,t.out.forEach((function(t){"false"===t.e.a&&(t.e.a=null)})),t}))}},{key:"_encodeQuery",value:function(t){return btoa(JSON.stringify(t))}},{key:"client",get:function(){return LI}}]),e}(d),AI=dI.create({baseURL:"https://api.operatebsv.org/"}),TI=["tape_adapter","op_adapter","cache","extensions","aliases","strict"],vI={tape_adapter:gI,op_adapter:function(t){function e(){return a(this,e),_(this,c(e).apply(this,arguments))}return i(e,t),u(e,null,[{key:"fetchOps",value:function(t){var e=this,n={refs:t,fn:!0};return this.client.get("/ops",{params:n}).then((function(t){return t.data.data.map(e._toOp)}))}},{key:"_toOp",value:function(t){return{ref:t.ref,hash:t.hash,name:t.name,fn:t.fn}}},{key:"client",get:function(){return AI}}]),e}(d),cache:function(t){function e(){return a(this,e),_(this,c(e).apply(this,arguments))}return i(e,t),e}(function(){function t(){a(this,t)}return u(t,null,[{key:"fetchTx",value:function(t){var e=arguments.length>2?arguments[2]:void 0,n=p(e,2),a=n[0],r=n[1];return a.fetchTx(t,r)}},{key:"fetchTxBy",value:function(t){var e=arguments.length>2?arguments[2]:void 0,n=p(e,2),a=n[0],r=n[1];return a.fetchTxBy(t,r)}},{key:"fetchOps",value:function(t){var e=arguments.length>2?arguments[2]:void 0,n=p(e,2),a=n[0],r=n[1];return a.fetchOps(t,r)}}]),t}()),extensions:[],aliases:{},strict:!0,set:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).filter((function(t){return TI.includes(t)})).forEach((function(n){t[n]=e[n]}))}},bI=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t),this.config=o({},vI,{},e)}var e,r,l;return u(t,[{key:"loadTape",value:(l=n(regeneratorRuntime.mark((function t(e){var n,a,r,u,l,s,i,c,f=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},a=o({},this.config,{},n),r=this._adapterWithOpts(a.cache),u=p(r,2),l=u[0],s=u[1],i=this._adapterWithOpts(a.tape_adapter),t.next=6,l.fetchTx(e,s,i);case 6:return c=t.sent,t.next=9,this._prepTape(c,a);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"loadTapesBy",value:(r=n(regeneratorRuntime.mark((function t(e){var n,a,r,u,l,s,i,c,f=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},a=o({},this.config,{},n),r=this._adapterWithOpts(a.cache),u=p(r,2),l=u[0],s=u[1],i=this._adapterWithOpts(a.tape_adapter),t.next=6,l.fetchTxBy(e,s,i);case 6:return c=t.sent,t.next=9,this._prepTape(c,a);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"runTape",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o({},this.config,{},e),a=new IS({agent:this,extensions:n.extensions}),r=n.state,u={state:r,strict:n.strict};return t.run(a,u)}},{key:"_prepTape",value:(e=n(regeneratorRuntime.mark((function t(e){var a,r,u,l,s,i,c,f,_,h,d,L=this,g=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=g.length>2&&void 0!==g[2]?g[2]:{},r=o({},this.config,{},a),!Array.isArray(e)){t.next=8;break}return t.next=6,Promise.all(e.map(function(){var t=n(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",L._prepTape(e,a));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 6:return u=t.sent,t.abrupt("return",u.filter((function(t){return t})));case 8:return t.prev=8,l=US.fromBPU(e),s=l.getOpRefs(r.aliases),i=this._adapterWithOpts(r.cache),c=p(i,2),f=c[0],_=c[1],h=this._adapterWithOpts(r.op_adapter),t.next=15,f.fetchOps(s,_,h);case 15:d=t.sent,l.setCellOps(d,r.aliases),t.next=23;break;case 19:if(t.prev=19,t.t0=t.catch(8),!this.config.strict){t.next=23;break}throw t.t0;case 23:return t.abrupt("return",l);case 24:case"end":return t.stop()}}),t,this,[[8,19]])}))),function(t){return e.apply(this,arguments)})},{key:"_adapterWithOpts",value:function(t){return Array.isArray(t)?t:[t,{}]}}]),t}();return function(){function t(){a(this,t)}return u(t,null,[{key:"loadTape",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new bI(e).loadTape(t)}},{key:"loadTapesBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new bI(e).loadTapesBy(t)}},{key:"runTape",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new bI(e).runTape(t,e)}},{key:"Agent",get:function(){return bI}},{key:"config",get:function(){return vI}}]),t}()}));
